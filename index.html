<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω Ph∆∞·ªõc An 2025-2026</title>
    <style>
        :root { --p: #1a73e8; --s: #34a853; --a: #d93025; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; color: #3c4043; }
        .navbar { display: flex; background: #fff; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; justify-content: center; gap: 10px; }
        .nav-item { padding: 10px 15px; border-radius: 20px; font-weight: 600; cursor: pointer; color: #5f6368; }
        .nav-item.active { background: #e8f0fe; color: var(--p); }
        .container { padding: 15px; max-width: 600px; margin: auto; }
        .card { background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .scroll-list { max-height: 450px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; margin: 10px 0; }
        .group-title { background: #f1f3f4; padding: 8px; font-size: 0.75rem; font-weight: bold; color: #5f6368; position: sticky; top: 0; }
        .loi-item { padding: 12px; border-bottom: 1px solid #f1f3f4; cursor: pointer; transition: 0.2s; }
        .loi-item:active { background: #f8f9fa; }
        .loi-item.active { background: #eef6ff; border-left: 4px solid var(--p); }
        .input-name { width: 100%; margin-top: 10px; padding: 12px; border: 1px solid #dadce0; border-radius: 8px; display: none; box-sizing: border-box; }
        .loi-item.active .input-name { display: block; }
        .btn-main { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; background: var(--p); color: #fff; margin-top: 10px; }
        .rank-table { width: 100%; border-collapse: collapse; }
        .rank-table td, .rank-table th { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        #login-screen { position: fixed; inset: 0; background: #fff; display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; }
        .plus { background: #e6f4ea; color: var(--s); }
        .minus { background: #fce8e6; color: var(--a); }
    </style>
</head>
<body>

<div id="login-screen">
    <h3 id="login-label">NH·∫¨P M√É PIN</h3>
    <input type="password" id="pin-input" style="padding:15px; font-size:2rem; text-align:center; width:180px; border:2px solid #ddd; border-radius:12px; margin-bottom:20px;" maxlength="4" inputmode="numeric">
    <button class="btn-main" style="width:180px" onclick="verifyPin()">X√ÅC NH·∫¨N</button>
</div>

<nav class="navbar">
    <div class="nav-item active" id="m-saodo" onclick="switchTab('saodo')">SAO ƒê·ªé</div>
    <div class="nav-item" id="m-daubai" onclick="switchTab('daubai')">S·ªî ƒê·∫¶U B√ÄI</div>
</nav>

<div class="container">
    <div id="tab-saodo">
        <div class="card">
            <button class="btn-main" style="background:#ff9800; margin-bottom:15px" onclick="syncFromCloud()">üîÑ T·ªîNG K·∫æT & ƒê·ªíNG B·ªò TO√ÄN TR∆Ø·ªúNG</button>
            <table class="rank-table">
                <thead><tr><th>H·∫°ng</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody id="bxh-body"></tbody>
            </table>
            <button class="btn-main" style="background:#666" onclick="openLogin('SAODO')">üîê ƒêƒÇNG NH·∫¨P SAO ƒê·ªé</button>
        </div>
        <div id="saodo-panel" class="card" style="display:none">
            <h3 id="sd-label" style="margin:0; color:var(--p)"></h3>
            <div id="list-sd" class="scroll-list"></div>
            <button class="btn-main" onclick="saveData('sd')">L∆ØU K·∫æT QU·∫¢ CH·∫§M</button>
        </div>
    </div>

    <div id="tab-daubai" style="display:none">
        <div class="card" id="db-select">
            <h3 style="text-align:center">CH·ªåN L·ªöP C·ª¶A B·∫†N</h3>
            <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;" id="class-grid"></div>
        </div>
        <div id="daubai-panel" class="card" style="display:none">
            <h3 id="db-label" style="margin:0; color:var(--s)"></h3>
            <div id="list-db" class="scroll-list"></div>
            <button class="btn-main" style="background:var(--s)" onclick="saveData('db')">GHI V√ÄO S·ªî ƒê·∫¶U B√ÄI</button>
            <button class="btn-main" style="background:#eee; color:#333" onclick="location.reload()">QUAY L·∫†I</button>
        </div>
    </div>
</div>

<script>
    // THAY LINK GOOGLE APPS SCRIPT C·ª¶A B·∫†N V√ÄO ƒê√ÇY
    const SCRIPT_URL = "D√ÅN_LINK_C·ª¶A_B·∫†N_·ªû_ƒê√ÇY";
    
    const LOP_LIST = ["6A1","6A2","6A3","7A1","7A2","8A1","8A2","9A1","9A2"];
    const PIN_SAODO = "1234", PIN_LOP = "2025";

    // Danh m·ª•c l·ªói chi ti·∫øt t·ª´ file TI√äU CH√ç THI ƒêUA THCS 
    const CRITERIA = [
        { g: "T√°c phong - ƒê·ªìng ph·ª•c (-5ƒë)", i: [
            {n:"Kh√¥ng khƒÉn qu√†ng/huy hi·ªáu",d:-5}, {n:"Kh√¥ng b·ªè √°o v√†o qu·∫ßn",d:-5},
            {n:"M·∫∑c √°o kho√°c trong tr∆∞·ªùng",d:-5}, {n:"ƒê·ªìng ph·ª•c sai quy ƒë·ªãnh",d:-5},
            {n:"ƒêi ch√¢n tr·∫ßn ra s√¢n/WC",d:-5}, {n:"ƒê·ªÉ xe kh√¥ng ngay h√†ng",d:-5},
            {n:"Kh√¥ng n√≥n b·∫£o hi·ªÉm",d:-5}, {n:"ƒê·ªÉ t√≥c d√†i (Nam)",d:-5}
        ]},
        { g: "K·ª∑ lu·∫≠t & ƒê·∫°o ƒë·ª©c (-10ƒë ƒë·∫øn -30ƒë)", i: [
            {n:"Nhu·ªôm t√≥c/Son ph·∫•n/S∆°n m√≥ng",d:-10}, {n:"N√≥i t·ª•c, ch·ª≠i th·ªÅ",d:-10},
            {n:"ƒê√°nh nhau",d:-10}, {n:"Ch·ªëng ƒë·ªëi sao ƒë·ªè",d:-10},
            {n:"B·ªè r√°c sai quy ƒë·ªãnh",d:-20}, {n:"V·∫Ω b·∫≠y t∆∞·ªùng/b√†n gh·∫ø",d:-10},
            {n:"Chui r√†o, ph√° h√†ng r√†o",d:-30}, {n:"ƒÇn u·ªëng sai quy ƒë·ªãnh",d:-10}
        ]},
        { g: "Chuy√™n c·∫ßn", i: [
            {n:"ƒêi tr·ªÖ",d:-2}, {n:"V·∫Øng kh√¥ng ph√©p",d:-5}, {n:"Tr·ªën ti·∫øt",d:-10},
            {n:"N√≥i chuy·ªán ri√™ng",d:-5}, {n:"Kh√¥ng sinh ho·∫°t 15'",d:-5}
        ]},
        { g: "H·ªçc t·∫≠p", i: [
            {n:"ƒêi·ªÉm 10",d:10}, {n:"ƒêi·ªÉm 8, 9",d:9}, {n:"ƒêi·ªÉm 7",d:5},
            {n:"ƒêi·ªÉm 4",d:-5}, {n:"ƒêi·ªÉm 0,1,2,3",d:-10}, {n:"Kh√¥ng thu·ªôc b√†i/L√†m BT",d:-10},
            {n:"Nh·∫∑t ƒë∆∞·ª£c c·ªßa r∆°i tr·∫£ l·∫°i",d:5}
        ]},
        { g: "X·∫øp lo·∫°i ti·∫øt h·ªçc (S·ªï ƒë·∫ßu b√†i)", i: [
            {n:"Ti·∫øt h·ªçc lo·∫°i A",d:10}, {n:"Ti·∫øt h·ªçc lo·∫°i B",d:5},
            {n:"Ti·∫øt h·ªçc lo·∫°i C",d:-5}, {n:"Ti·∫øt h·ªçc lo·∫°i D",d:-10}
        ]}
    ];

    let db = {}, activeClass = "", loginType = "";

    function init() {
        LOP_LIST.forEach(l => db[l] = { score: 100, logs: [] });
        const grid = document.getElementById('class-grid');
        LOP_LIST.forEach(l => {
            grid.innerHTML += `<button style="padding:15px; border:1px solid #ddd; border-radius:8px; background:#fff; font-weight:bold; color:var(--p);" onclick="openLogin('LOP', '${l}')">${l}</button>`;
        });
        buildList('sd'); buildList('db'); renderBXH();
    }

    function buildList(type) {
        const container = document.getElementById('list-' + type);
        CRITERIA.forEach(group => {
            container.innerHTML += `<div class="group-title">${group.g}</div>`;
            group.i.forEach(item => {
                const id = type + Math.random().toString(36).substr(2, 5);
                container.innerHTML += `
                    <div class="loi-item" id="item-${id}" onclick="toggle('${id}')">
                        <div style="display:flex; justify-content:space-between; align-items:center">
                            <span>${item.n}</span>
                            <span class="badge ${item.d > 0 ? 'plus' : 'minus'}">${item.d > 0 ? '+' : ''}${item.d}</span>
                        </div>
                        <input type="text" class="input-name" id="name-${id}" placeholder="T√™n HS (VD: An x2)..." onclick="event.stopPropagation()">
                        <input type="checkbox" id="cb-${id}" data-n="${item.n}" data-d="${item.d}" style="display:none">
                    </div>`;
            });
        });
    }

    async function saveData(type) {
        const activeItems = document.querySelectorAll(`#list-${type} .loi-item.active`);
        if (activeItems.length === 0) return alert("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt m·ª•c!");

        for (let item of activeItems) {
            const id = item.id.replace('item-', '');
            const cb = document.getElementById('cb-' + id);
            const name = document.getElementById('name-' + id).value || "T·∫≠p th·ªÉ";
            const points = parseInt(cb.dataset.d);

            const payload = {
                lop: activeClass,
                noiDung: cb.dataset.n,
                tenHS: name,
                diem: points,
                loai: type === 'sd' ? 'Sao ƒê·ªè' : 'S·ªï ƒê·∫ßu B√†i'
            };

            // G·ª≠i l√™n Cloud
            try {
                await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
            } catch (e) { console.error("Cloud Sync Error"); }

            db[activeClass].score += points;
        }

        alert("ƒê√£ l∆∞u v√† ƒë·ªìng b·ªô th√†nh c√¥ng!");
        location.reload(); 
    }

    async function syncFromCloud() {
        try {
            const response = await fetch(SCRIPT_URL);
            const data = await response.json();
            // Reset ƒëi·ªÉm v·ªÅ 100 tr∆∞·ªõc khi t√≠nh to√°n l·∫°i t·ª´ Cloud
            LOP_LIST.forEach(l => db[l].score = 100);
            data.forEach(row => {
                const lop = row[1];
                const diem = parseInt(row[4]);
                if (db[lop]) db[lop].score += diem;
            });
            renderBXH();
            alert("B·∫£ng x·∫øp h·∫°ng ƒë√£ c·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´ gi√°o vi√™n!");
        } catch (e) { alert("L·ªói t·∫£i d·ªØ li·ªáu!"); }
    }

    function toggle(id) { document.getElementById('item-' + id).classList.toggle('active'); }

    function openLogin(type, lop = "") {
        loginType = type; activeClass = lop;
        document.getElementById('login-label').innerText = type === 'SAODO' ? "M√É PIN SAO ƒê·ªé" : "PIN L·ªöP " + lop;
        document.getElementById('login-screen').style.display = 'flex';
    }

    function verifyPin() {
        const pin = document.getElementById('pin-input').value;
        if ((loginType === 'SAODO' && pin === PIN_SAODO) || (loginType === 'LOP' && pin === PIN_LOP)) {
            document.getElementById('login-screen').style.display = 'none';
            if (loginType === 'SAODO') {
                alert("Ch√†o Sao ƒê·ªè! H√£y ch·ªçn m·ªôt l·ªõp ·ªü b·∫£ng x·∫øp h·∫°ng ƒë·ªÉ b·∫Øt ƒë·∫ßu ch·∫•m.");
            } else {
                document.getElementById('db-select').style.display = 'none';
                document.getElementById('daubai-panel').style.display = 'block';
                document.getElementById('db-label').innerText = "S·ªî ƒê·∫¶U B√ÄI L·ªöP " + activeClass;
            }
        } else { alert("M√£ PIN kh√¥ng ƒë√∫ng!"); }
        document.getElementById('pin-input').value = "";
    }

    function switchTab(t) {
        document.getElementById('tab-saodo').style.display = t === 'saodo' ? 'block' : 'none';
        document.getElementById('tab-daubai').style.display = t === 'daubai' ? 'block' : 'none';
        document.getElementById('m-saodo').classList.toggle('active', t === 'saodo');
        document.getElementById('m-daubai').classList.toggle('active', t === 'daubai');
    }

    function renderBXH() {
        const body = document.getElementById('bxh-body'); body.innerHTML = "";
        const sorted = [...LOP_LIST].sort((a, b) => db[b].score - db[a].score);
        sorted.forEach((l, i) => {
            body.innerHTML += `<tr onclick="selectSD('${l}')">
                <td>${i + 1}</td>
                <td><b>${l}</b></td>
                <td style="color:${db[l].score < 100 ? 'red' : 'green'}"><b>${db[l].score}</b></td>
            </tr>`;
        });
    }

    function selectSD(l) {
        if (loginType !== 'SAODO') return;
        activeClass = l;
        document.getElementById('saodo-panel').style.display = 'block';
        document.getElementById('sd-label').innerText = "CH·∫§M ƒêI·ªÇM L·ªöP " + l;
        window.scrollTo(0, document.body.scrollHeight);
    }

    init();
</script>
</body>
</html>
