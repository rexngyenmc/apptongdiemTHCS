<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªá Th·ªëng Qu·∫£n L√Ω Ph∆∞·ªõc An</title>
    <style>
        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --danger: #d93025;
            --warning: #f9ab00;
            --bg: #f8f9fa;
            --text: #3c4043;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text);
            -webkit-tap-highlight-color: transparent;
        }

        /* Menu thanh l·ªãch */
        .navbar {
            display: flex;
            background: #fff;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            justify-content: center;
            gap: 15px;
        }

        .nav-item {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
            color: #5f6368;
        }

        .nav-item.active {
            background-color: #e8f0fe;
            color: var(--primary);
            border: 1px solid #d2e3fc;
        }

        /* Container & Cards */
        .container { padding: 15px; max-width: 500px; margin: auto; }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
        }

        h2, h3 { margin-top: 0; color: #202124; font-size: 1.1rem; }

        /* Login Screen */
        #login-screen {
            position: fixed; inset: 0; background: white;
            display: none; flex-direction: column; align-items: center;
            justify-content: center; z-index: 1000;
        }

        .pin-box {
            text-align: center; width: 85%;
        }

        .pin-input {
            width: 100%; padding: 15px; font-size: 2rem;
            border-radius: 12px; border: 2px solid #e0e0e0;
            text-align: center; margin: 20px 0; outline: none;
            background: #f1f3f4;
        }

        /* Danh s√°ch l·ªõp */
        .class-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
        }

        .class-btn {
            background: white; border: 1px solid #dadce0;
            padding: 15px 5px; border-radius: 12px;
            font-weight: bold; color: var(--primary);
            cursor: pointer; transition: 0.2s;
        }

        .class-btn:hover { background: #f8f9fa; border-color: var(--primary); }

        /* Danh s√°ch l·ªói chuy√™n nghi·ªáp */
        .scroll-list {
            max-height: 400px; overflow-y: auto;
            border: 1px solid #dadce0; border-radius: 12px; margin: 15px 0;
        }

        .group-title {
            background: #f1f3f4; padding: 10px; font-size: 0.75rem;
            font-weight: bold; color: #5f6368; text-transform: uppercase;
            position: sticky; top: 0; z-index: 10;
        }

        .loi-item {
            padding: 15px; border-bottom: 1px solid #f1f3f4;
            transition: background 0.2s;
        }

        .loi-item:active { background: #f8f9fa; }

        .loi-row { display: flex; justify-content: space-between; align-items: center; }

        .score-badge {
            font-weight: bold; padding: 4px 8px; border-radius: 6px;
            font-size: 0.85rem; min-width: 35px; text-align: center;
        }

        .plus { background: #e6f4ea; color: var(--secondary); }
        .minus { background: #fce8e6; color: var(--danger); }

        .input-name {
            width: 100%; margin-top: 12px; padding: 12px;
            border: 1.5px solid #dadce0; border-radius: 8px;
            display: none; box-sizing: border-box; outline-color: var(--primary);
        }

        .loi-item.active { background: #f7f9ff; }
        .loi-item.active .input-name { display: block; border-color: var(--primary); }

        /* Button Styles */
        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 12px;
            font-weight: 600; cursor: pointer; font-size: 1rem;
            transition: transform 0.1s, opacity 0.2s;
        }

        .btn:active { transform: scale(0.97); opacity: 0.9; }

        .btn-primary { background-color: var(--primary); color: white; }
        .btn-success { background-color: var(--secondary); color: white; }
        .btn-outline { background-color: transparent; color: #5f6368; border: 1px solid #dadce0; }
        
        .btn-summary { 
            background: linear-gradient(135deg, #1a73e8, #1557b0);
            color: white; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(26,115,232,0.3);
        }

        /* Table X·∫øp h·∫°ng */
        .modern-table { width: 100%; border-collapse: collapse; }
        .modern-table td, .modern-table th { padding: 15px 10px; border-bottom: 1px solid #f1f3f4; text-align: center; }
        .modern-table th { font-size: 0.8rem; color: #5f6368; font-weight: 500; }
        .top-row { background: #fffcf0; }
        .rank-circle {
            width: 28px; height: 28px; background: #f1f3f4;
            display: inline-flex; align-items: center; justify-content: center;
            border-radius: 50%; font-size: 0.8rem; font-weight: bold;
        }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="pin-box">
        <h3 id="login-title">Nh·∫≠p m√£ PIN</h3>
        <input type="password" id="pin-input" class="pin-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" inputmode="numeric">
        <button class="btn btn-primary" onclick="verifyPin()">X√°c nh·∫≠n</button>
        <button class="btn btn-outline" style="margin-top:10px" onclick="closeLogin()">H·ªßy b·ªè</button>
    </div>
</div>

<nav class="navbar">
    <div class="nav-item active" id="m-saodo" onclick="switchTab('saodo')">S·ªï Sao ƒê·ªè</div>
    <div class="nav-item" id="m-daubai" onclick="switchTab('daubai')">S·ªï ƒê·∫ßu B√†i</div>
</nav>

<div class="container">
    <div id="tab-saodo">
        <div class="card">
            <button class="btn btn-summary" onclick="tongKetTuan()">üìä T·ªïng K·∫øt & X·∫øp H·∫°ng</button>
            <table class="modern-table">
                <thead><tr><th>H·∫°ng</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody id="bxh-body"></tbody>
            </table>
            <button class="btn btn-outline" onclick="openLogin('SAODO')" style="margin-top:20px">üîê ƒêƒÉng nh·∫≠p Sao ƒë·ªè</button>
        </div>

        <div id="saodo-panel" class="card" style="display:none; border-top: 4px solid var(--primary);">
            <h3 id="sd-label"></h3>
            <div id="list-sd" class="scroll-list"></div>
            <button class="btn btn-primary" onclick="saveData('sd')">L∆∞u k·∫øt qu·∫£ ch·∫•m</button>
        </div>
    </div>

    <div id="tab-daubai" style="display:none">
        <div class="card" id="db-select">
            <h3 style="text-align:center; margin-bottom:20px">Ch·ªçn l·ªõp c·ªßa b·∫°n</h3>
            <div class="class-grid" id="class-grid-list"></div>
        </div>

        <div id="daubai-panel" class="card" style="display:none; border-top: 4px solid var(--secondary);">
            <h3 id="db-label"></h3>
            <div id="list-db" class="scroll-list"></div>
            <button class="btn btn-success" onclick="saveData('db')">C·∫≠p nh·∫≠t s·ªï ƒë·∫ßu b√†i</button>
            <button class="btn btn-outline" style="margin-top:10px" onclick="exitClass()">Quay l·∫°i danh s√°ch</button>
        </div>
    </div>

    <div class="card" id="history-card" style="display:none">
        <h3 style="font-size:0.9rem">Nh·∫≠t k√Ω: <span id="active-class-name" style="color:var(--primary)"></span></h3>
        <table class="modern-table" style="font-size:0.8rem">
            <tbody id="log-body"></tbody>
        </table>
    </div>
</div>

<script>
    const LOP_LIST = ["6A", "6B", "6C", "7A", "7B", "7C", "8A", "8B", "8C", "9A", "9B"];
    const PIN_SAODO = "1234";
    const PIN_LOP = "2025";

    const CRITERIA = [
        { g: "X·∫øp lo·∫°i ti·∫øt h·ªçc", i: [{n:"Ti·∫øt h·ªçc lo·∫°i A",d:10}, {n:"Ti·∫øt h·ªçc lo·∫°i B",d:5}, {n:"Ti·∫øt h·ªçc lo·∫°i C",d:-5}, {n:"Ti·∫øt h·ªçc lo·∫°i D",d:-10}] },
        { g: "T√°c phong & ƒê·ªìng ph·ª•c", i: [{n:"Kh√¥ng khƒÉn qu√†ng/huy hi·ªáu",d:-5}, {n:"Kh√¥ng s∆° vin",d:-5}, {n:"M·∫∑c √°o kho√°c",d:-5}, {n:"ƒê·ªìng ph·ª•c sai",d:-5}] },
        { g: "Chuy√™n c·∫ßn", i: [{n:"ƒêi tr·ªÖ",d:-2}, {n:"V·∫Øng kh√¥ng ph√©p",d:-5}, {n:"Tr·ªën ti·∫øt",d:-10}] },
        { g: "H·ªçc t·∫≠p", i: [{n:"ƒêi·ªÉm 10",d:10}, {n:"ƒêi·ªÉm 8,9",d:9}, {n:"ƒêi·ªÉm 0-3",d:-10}, {n:"Kh√¥ng b√†i t·∫≠p",d:-10}] }
    ];

    let db = JSON.parse(localStorage.getItem('PHUOC_AN_V4')) || {};
    let activeClass = "";
    let loginType = "";

    function init() {
        LOP_LIST.forEach(l => { if(!db[l]) db[l] = { score: 100, logs: [] }; });
        renderBXH();
        const grid = document.getElementById('class-grid-list');
        LOP_LIST.forEach(l => grid.innerHTML += `<div class="class-btn" onclick="openLogin('LOP', '${l}')">${l}</div>`);
        buildCriteria('sd');
        buildCriteria('db');
    }

    function buildCriteria(type) {
        const container = document.getElementById('list-' + type);
        CRITERIA.forEach(group => {
            container.innerHTML += `<div class="group-title">${group.g}</div>`;
            group.i.forEach(item => {
                const id = type + Math.random().toString(36).substr(2, 5);
                container.innerHTML += `
                    <div class="loi-item" id="item-${id}">
                        <div class="loi-row" onclick="toggleItem('${id}')">
                            <span style="font-weight:500">${item.n}</span>
                            <span class="score-badge ${item.d<0?'minus':'plus'}">${item.d>0?'+':''}${item.d}</span>
                            <input type="checkbox" id="cb-${id}" data-n="${item.n}" data-d="${item.d}" style="display:none">
                        </div>
                        <input type="text" class="input-name" id="name-${id}" placeholder="Nh·∫≠p t√™n HS ho·∫∑c ghi ch√∫...">
                    </div>`;
            });
        });
    }

    function renderBXH() {
        const sorted = [...LOP_LIST].sort((a,b) => db[b].score - db[a].score);
        const body = document.getElementById('bxh-body');
        body.innerHTML = "";
        sorted.forEach((l, i) => {
            body.innerHTML += `<tr class="${i===0?'top-row':''}" onclick="selectClassSD('${l}')">
                <td><span class="rank-circle" style="${i===0?'background:#fbbc04;color:white':''}">${i+1}</span></td>
                <td style="font-weight:600">L·ªõp ${l}</td>
                <td style="color:${db[l].score<100?'var(--danger)':'var(--secondary)'}">${db[l].score}</td>
            </tr>`;
        });
    }

    function verifyPin() {
        const pin = document.getElementById('pin-input').value;
        if ((loginType === "SAODO" && pin === PIN_SAODO) || (loginType === "LOP" && pin === PIN_LOP)) {
            closeLogin();
            if (loginType === "LOP") {
                document.getElementById('db-select').style.display = 'none';
                document.getElementById('daubai-panel').style.display = 'block';
                document.getElementById('history-card').style.display = 'block';
                document.getElementById('db-label').innerText = "Ghi s·ªï l·ªõp " + activeClass;
                renderLogs();
            }
        } else { alert("M√£ PIN kh√¥ng ƒë√∫ng!"); }
        document.getElementById('pin-input').value = "";
    }

    function openLogin(type, lop = "") {
        loginType = type; activeClass = lop;
        document.getElementById('login-title').innerText = type === "SAODO" ? "M√£ PIN Sao ƒë·ªè" : "PIN L·ªõp " + lop;
        document.getElementById('login-screen').style.display = 'flex';
    }

    function switchTab(tab) {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('m-'+tab).classList.add('active');
        document.getElementById('tab-saodo').style.display = tab === 'saodo' ? 'block' : 'none';
        document.getElementById('tab-daubai').style.display = tab === 'daubai' ? 'block' : 'none';
        document.getElementById('history-card').style.display = 'none';
    }

    function selectClassSD(lop) {
        if(loginType !== "SAODO") return;
        activeClass = lop;
        document.getElementById('saodo-panel').style.display = 'block';
        document.getElementById('history-card').style.display = 'block';
        document.getElementById('sd-label').innerText = "ƒêang ch·∫•m l·ªõp " + lop;
        renderLogs();
    }

    function saveData(type) {
        const selected = document.querySelectorAll(`#list-${type} input[type="checkbox"]:checked`);
        selected.forEach(cb => {
            const id = cb.id.replace('cb-', '');
            const name = document.getElementById('name-'+id).value || "T·∫≠p th·ªÉ";
            const points = parseInt(cb.dataset.d);
            let t = 1; const m = name.match(/x(\d+)/); if(m) t = parseInt(m[1]);
            db[activeClass].logs.unshift({id: Date.now()+Math.random(), content: cb.dataset.n, total: points*t, who: name});
            db[activeClass].score += (points*t);
            cb.checked = false; document.getElementById('item-'+id).classList.remove('active');
            document.getElementById('name-'+id).value = "";
        });
        localStorage.setItem('PHUOC_AN_V4', JSON.stringify(db));
        renderLogs(); renderBXH(); alert("ƒê√£ l∆∞u!");
    }

    function renderLogs() {
        const body = document.getElementById('log-body'); body.innerHTML = "";
        document.getElementById('active-class-name').innerText = activeClass;
        db[activeClass].logs.forEach(log => {
            body.innerHTML += `<tr>
                <td style="text-align:left">${log.content}<br><small style="color:#888">${log.who}</small></td>
                <td class="${log.total<0?'minus':'plus'}" style="background:none;font-weight:bold">${log.total}</td>
                <td><button onclick="deleteLog(${log.id})" style="border:none;background:none;color:#dadce0">‚úï</button></td>
            </tr>`;
        });
    }

    function deleteLog(id) {
        if(!confirm("X√≥a m·ª•c n√†y?")) return;
        const idx = db[activeClass].logs.findIndex(l => l.id === id);
        db[activeClass].score -= db[activeClass].logs[idx].total;
        db[activeClass].logs.splice(idx, 1);
        localStorage.setItem('PHUOC_AN_V4', JSON.stringify(db));
        renderLogs(); renderBXH();
    }

    function toggleItem(id) {
        const cb = document.getElementById('cb-'+id);
        const item = document.getElementById('item-'+id);
        cb.checked = !cb.checked; item.classList.toggle('active', cb.checked);
        if(cb.checked) document.getElementById('name-'+id).focus();
    }

    function closeLogin() { document.getElementById('login-screen').style.display = 'none'; }
    function exitClass() { location.reload(); }
    function tongKetTuan() { renderBXH(); alert("B·∫£ng x·∫øp h·∫°ng ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!"); }

    init();
</script>
</body>
</html>
