<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAO ƒê·ªé PH∆Ø·ªöC AN</title>
    <style>
        :root { --p: #007bff; --bg: #f4f7f6; --text: #333; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; }

        /* HEADER & CARD */
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; overflow: hidden; border: 1px solid #e1e4e8; }
        .card-header { padding: 15px; border-bottom: 1px solid #eee; font-weight: bold; color: var(--p); display: flex; align-items: center; gap: 8px; }

        /* --- PH·∫¶N DANH S√ÅCH L·ªñI GI·ªêNG ·∫¢NH M·∫™U --- */
        .error-container { max-height: 450px; overflow-y: auto; background: #fff; }
        
        /* Ti√™u ƒë·ªÅ nh√≥m (K·ª∂ LU·∫¨T - ƒê·∫†O ƒê·ª®C) */
        .group-header { 
            background: #f1f3f8; /* M√†u n·ªÅn x√°m xanh nh·∫°t nh∆∞ ·∫£nh */
            padding: 10px 15px; 
            font-size: 0.75rem; 
            font-weight: 800; 
            color: #5a6d80; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky; top: 0; z-index: 5;
            border-bottom: 1px solid #e0e6ed;
        }

        /* T·ª´ng d√≤ng l·ªói (N√≥i t·ª•c, ch·ª≠i th·ªÅ...) */
        .loi-item { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 15px; 
            border-bottom: 1px solid #f0f2f5; 
            cursor: pointer;
            transition: background 0.2s;
        }
        .loi-item:active { background: #f8f9fa; }
        
        .loi-info { flex: 1; display: flex; flex-direction: column; gap: 8px; }
        .loi-name { font-size: 0.95rem; color: #2d3436; font-weight: 500; }
        
        /* ƒêi·ªÉm s·ªë b√™n ph·∫£i */
        .loi-score { font-weight: bold; font-size: 1rem; margin-left: 10px; }
        .minus { color: #ff4757; } /* M√†u ƒë·ªè cho ƒëi·ªÉm √¢m */
        .plus { color: #2ecc71; }  /* M√†u xanh cho ƒëi·ªÉm c·ªông */

        /* √î nh·∫≠p t√™n khi nh·∫•n v√†o l·ªói */
        .input-box-wrap { display: none; width: 100%; margin-top: 8px; animation: slideDown 0.2s ease; }
        .name-input { 
            width: 100%; padding: 10px; border: 2px solid var(--p); 
            border-radius: 8px; box-sizing: border-box; outline: none; font-size: 0.9rem;
        }
        .loi-item.active { background: #f0f7ff; border-left: 4px solid var(--p); }
        .loi-item.active .input-box-wrap { display: block; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* B·∫¢NG K·∫æT QU·∫¢ KI·ªÇU M·ªöI */
        .table-res { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        .table-res th, .table-res td { border: 1px solid #dee2e6; padding: 10px 5px; text-align: center; }
        .table-res th { background: #f8f9fa; color: #666; font-size: 0.75rem; }
        .total-row { background: #fffceb; font-weight: bold; }

        .btn-save { background: var(--p); color: white; border: none; width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 1rem; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <div class="card-header">üìä B·∫¢NG X·∫æP H·∫†NG TU·∫¶N</div>
    <table class="table-res" style="border:none">
        <tbody id="bxh-body"></tbody>
    </table>
</div>

<div id="input-area" class="card" style="display:none">
    <div class="card-header">‚úèÔ∏è CH·∫§M ƒêI·ªÇM: <span id="lop-label"></span></div>
    
    <div class="error-container" id="error-list"></div>

    <div style="padding: 15px;">
        <button class="btn-save" onclick="saveData()">L∆ØU K·∫æT QU·∫¢</button>
        
        <h3 style="font-size: 0.85rem; color: #666; margin: 20px 0 10px 0;">CHI TI·∫æT ƒê√É NH·∫¨P:</h3>
        <table class="table-res">
            <thead>
                <tr>
                    <th>Vi·ªác l√†m t·ªët/kh√¥ng t·ªët</th>
                    <th>Bi·ªÉu ƒëi·ªÉm</th>
                    <th>C√° nh√¢n/T·∫≠p th·ªÉ</th>
                    <th>S·ªë l·∫ßn</th>
                    <th>ƒêi·ªÉm</th>
                </tr>
            </thead>
            <tbody id="res-body"></tbody>
            <tr class="total-row">
                <td colspan="4" style="text-align: right;">T·ªïng ƒëi·ªÉm:</td>
                <td id="total-val">0</td>
            </tr>
        </table>
    </div>
</div>

<script>
    const LOP_LIST = ['6A1','6A2','6A3','7A1','7A2','8A1','8A2','9A1','9A2'];
    const ERROR_DATA = [
        { 
            g: "K·ª∂ LU·∫¨T - ƒê·∫†O ƒê·ª®C", 
            i: [
                { n: "N√≥i t·ª•c, ch·ª≠i th·ªÅ", d: -10 },
                { n: "ƒê√°nh nhau", d: -50 },
                { n: "V√¥ l·ªÖ v·ªõi gi√°o vi√™n", d: -50 },
                { n: "X·∫£ r√°c b·ª´a b√£i", d: -20 }
            ]
        },
        { 
            g: "T√ÅC PHONG - ƒê·ªíNG PH·ª§C", 
            i: [
                { n: "Kh√¥ng khƒÉn qu√†ng/huy hi·ªáu", d: -5 },
                { n: "M·∫∑c sai ƒë·ªìng ph·ª•c", d: -10 },
                { n: "T√≥c nhu·ªôm/sai quy ƒë·ªãnh", d: -20 }
            ]
        },
        { 
            g: "H·ªåC T·∫¨P (VI·ªÜC T·ªêT)", 
            i: [
                { n: "ƒêi·ªÉm 10", d: 10 },
                { n: "Ph√°t bi·ªÉu x√¢y d·ª±ng b√†i", d: 5 },
                { n: "Ti·∫øt h·ªçc lo·∫°i A", d: 10 }
            ]
        }
    ];

    let db = JSON.parse(localStorage.getItem('DiemSaoDo_PA')) || {};
    let curLop = "";

    function init() {
        LOP_LIST.forEach(l => { if(!db[l]) db[l] = { total: 100, logs: [] }; });
        const listEl = document.getElementById('error-list');
        listEl.innerHTML = "";
        
        ERROR_DATA.forEach(group => {
            listEl.innerHTML += `<div class="group-header">${group.g}</div>`;
            group.i.forEach(item => {
                const id = 'id' + Math.random().toString(36).substr(2, 5);
                listEl.innerHTML += `
                    <div class="loi-item" id="row-${id}" onclick="toggleRow('${id}')">
                        <div class="loi-info">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span class="loi-name">${item.n}</span>
                                <span class="loi-score ${item.d < 0 ? 'minus' : 'plus'}">${item.d > 0 ? '+' : ''}${item.d}</span>
                            </div>
                            <div class="input-box-wrap" onclick="event.stopPropagation()">
                                <input type="text" class="name-input" id="in-${id}" data-n="${item.n}" data-d="${item.d}" placeholder="Nh·∫≠p t√™n HS (v√≠ d·ª•: An, B√¨nh x2)...">
                            </div>
                        </div>
                    </div>`;
            });
        });
        renderBXH();
    }

    function toggleRow(id) {
        const row = document.getElementById(`row-${id}`);
        row.classList.toggle('active');
        if(row.classList.contains('active')) document.getElementById(`in-${id}`).focus();
    }

    function renderBXH() {
        const sorted = [...LOP_LIST].sort((a,b) => db[b].total - db[a].total);
        const body = document.getElementById('bxh-body');
        body.innerHTML = '';
        sorted.forEach((l, i) => {
            body.innerHTML += `
                <tr onclick="chonLop('${l}')" style="cursor:pointer">
                    <td width="50">${i+1}</td>
                    <td style="text-align:left; padding-left:20px; font-weight:bold; color:var(--p)">L·ªõp ${l}</td>
                    <td width="80" class="${db[l].total < 100 ? 'minus' : 'plus'}">${db[l].total}</td>
                </tr>`;
        });
        localStorage.setItem('DiemSaoDo_PA', JSON.stringify(db));
    }

    function chonLop(l) {
        curLop = l;
        document.getElementById('input-area').style.display = 'block';
        document.getElementById('lop-label').innerText = l;
        renderLogs();
        window.scrollTo({ top: document.getElementById('input-area').offsetTop - 20, behavior: 'smooth' });
    }

    function saveData() {
        const inputs = document.querySelectorAll('.name-input');
        let added = false;
        inputs.forEach(inp => {
            const val = inp.value.trim();
            if(val !== "") {
                const d = parseInt(inp.dataset.d);
                let sl = 1;
                let ten = val;
                const match = val.match(/x\s*(\d+)/i);
                if(match) { sl = parseInt(match[1]); ten = val.replace(/x\s*\d+/i, '').trim(); }

                db[curLop].logs.push({ n: inp.dataset.n, b: d, hs: ten, sl: sl, t: d * sl });
                db[curLop].total += (d * sl);
                inp.value = "";
                inp.parentElement.parentElement.parentElement.classList.remove('active');
                added = true;
            }
        });
        if(added) { renderBXH(); renderLogs(); alert("ƒê√£ l∆∞u!"); }
    }

    function renderLogs() {
        const body = document.getElementById('res-body');
        body.innerHTML = '';
        let tong = 0;
        db[curLop].logs.forEach((log, i) => {
            tong += log.t;
            body.innerHTML += `
                <tr onclick="removeLog(${i})">
                    <td style="text-align:left">${log.n}</td>
                    <td>${log.b > 0 ? '+' : ''}${log.b}</td>
                    <td>${log.hs}</td>
                    <td>${log.sl}</td>
                    <td class="${log.t < 0 ? 'minus' : 'plus'}">${log.t > 0 ? '+' : ''}${log.t}</td>
                </tr>`;
        });
        document.getElementById('total-val').innerText = (tong > 0 ? "+" : "") + tong;
        document.getElementById('total-val').className = tong < 0 ? 'minus' : 'plus';
    }

    function removeLog(i) {
        if(confirm("X√≥a d√≤ng n√†y?")) {
            db[curLop].total -= db[curLop].logs[i].t;
            db[curLop].logs.splice(i, 1);
            renderBXH(); renderLogs();
        }
    }

    init();
</script>
</body>
</html>
