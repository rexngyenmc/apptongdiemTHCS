<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sao ƒê·ªè Ph∆∞·ªõc An - Qu·∫£n L√Ω Minh B·∫°ch</title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #e3f2fd; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 100px; }
        
        /* M√ÄN H√åNH KH√ìA */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; color: white; }
        .pin-input { width: 150px; padding: 15px; border-radius: 10px; border: none; font-size: 1.5rem; text-align: center; letter-spacing: 5px; margin: 20px 0; font-weight: bold; }

        #main-content { display: none; }
        .header { background: var(--p); color: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; }
        .container { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; max-width: 1100px; margin: 0 auto; }

        /* B·∫¢NG ƒêI·ªÇM */
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
        .lop-row { cursor: pointer; }
        .dang-chon { background: #fff9c4 !important; border-left: 5px solid var(--p); }

        /* NH·∫¨T K√ù */
        .log-container { max-height: 300px; overflow-y: auto; background: #f8f9fa; border-radius: 10px; padding: 10px; border: 1px solid #ddd; }
        .log-item { font-size: 0.8rem; padding: 8px; border-bottom: 1px solid #eee; display: flex; flex-direction: column; }
        .log-time { color: #888; font-weight: bold; }
        .log-content { color: #333; }

        /* FORM */
        .group-title { background: #eee; padding: 5px; font-weight: bold; margin-top: 10px; font-size: 0.8rem; }
        .loi-item { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; }
        input[type=number] { width: 45px; padding: 5px; text-align: center; border-radius: 5px; border: 1px solid #ccc; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-apply { background: var(--p); color: white; }
        
        /* DECOR */
        .footer-info { text-align: center; font-size: 0.7rem; color: #78909c; margin-top: 20px; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2>üîê SAO ƒê·ªé PH∆Ø·ªöC AN</h2>
    <input type="password" id="pin-input" class="pin-input" placeholder="PIN" maxlength="4" oninput="checkPin()">
</div>

<div id="main-content">
    <div class="header">
        <h1>TR∆Ø·ªúNG TH&THCS PH∆Ø·ªöC AN</h1>
        <p>H·ªá th·ªëng ch·∫•m ƒëi·ªÉm minh b·∫°ch 2026</p>
    </div>

    <div class="container">
        <div class="card" style="flex: 1; min-width: 320px;">
            <h3>üèÜ X·∫øp H·∫°ng Tu·∫ßn</h3>
            <table>
                <tbody id="body-bang">
                    <script>
                        const lops = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
                        lops.forEach(l => {
                            document.write(`<tr class="lop-row" data-lop="${l}" onclick="chonLop(this)"><td>#</td><td>L·ªõp ${l}</td><td class="tong">100</td></tr>`);
                        });
                    </script>
                </tbody>
            </table>
        </div>

        <div id="panel" class="card" style="flex: 1.2; min-width: 320px; display:none;">
            <h3 id="tenlop" style="color: var(--p);">Ch·ªçn l·ªõp...</h3>
            <div id="form-nhap">
                <div class="group-title">T√ÅC PHONG</div>
                <div class="loi-item"><span>KhƒÉn qu√†ng/ƒê·ªìng ph·ª•c</span><input type="number" id="l1" data-name="T√°c phong" data-d="-5"></div>
                <div class="group-title">CHUY√äN C·∫¶N</div>
                <div class="loi-item"><span>ƒêi tr·ªÖ/V·∫Øng/Tr·ªën ti·∫øt</span><input type="number" id="l2" data-name="Chuy√™n c·∫ßn" data-d="-5"></div>
                <div class="group-title">H·ªåC T·∫¨P</div>
                <div class="loi-item"><span>Hoa ƒëi·ªÉm 10 (+)</span><input type="number" id="l3" data-name="ƒêi·ªÉm 10" data-d="10"></div>
            </div>
            <button class="btn btn-apply" onclick="apDung()">L∆ØU & GHI NH·∫¨T K√ù</button>
        </div>

        <div class="card" style="width: 100%;">
            <h3>üìë Nh·∫≠t K√Ω Ho·∫°t ƒê·ªông (Minh B·∫°ch)</h3>
            <div id="log-list" class="log-container">
                <div class="log-item">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o ƒë∆∞·ª£c ghi l·∫°i.</div>
            </div>
            <button onclick="clearLog()" style="background:none; border:none; color:red; font-size:0.7rem; cursor:pointer; margin-top:5px;">üóë X√≥a l·ªãch s·ª≠ nh·∫≠t k√Ω</button>
        </div>
    </div>

    <div class="footer-info">
        Thi·∫øt k·∫ø b·ªüi <b>truongkycaonguyen</b><br>
        üìç TH&THCS Ph∆∞·ªõc An
    </div>
</div>

<script>
const PIN = "1234";
let lopDangChon = null;
let dataLoi = {};
let logs = [];

function checkPin() {
    if (document.getElementById("pin-input").value === PIN) {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("main-content").style.display = "block";
        loadAll();
    }
}

function chonLop(row) {
    document.querySelectorAll(".lop-row").forEach(r => r.classList.remove("dang-chon"));
    row.classList.add("dang-chon");
    lopDangChon = row;
    document.getElementById("panel").style.display = "block";
    document.getElementById("tenlop").innerText = "Ch·∫•m ƒëi·ªÉm: L·ªõp " + row.dataset.lop;
    
    const saved = dataLoi[row.dataset.lop] || {};
    document.querySelectorAll("#form-nhap input").forEach(i => i.value = saved[i.id] || 0);
}

function apDung() {
    if(!lopDangChon) return;
    const tenLop = lopDangChon.dataset.lop;
    let tongBienDong = 0;
    let tempLoi = {};
    let chiTietLoi = [];

    document.querySelectorAll("#form-nhap input").forEach(i => {
        let val = Number(i.value) || 0;
        let diem = val * Number(i.dataset.d);
        tongBienDong += diem;
        tempLoi[i.id] = val;
        if(val > 0) chiTietLoi.push(`${i.dataset.name}: ${val} l·∫ßn (${diem > 0 ? '+' : ''}${diem}ƒë)`);
    });

    dataLoi[tenLop] = tempLoi;
    let diemCu = Number(lopDangChon.dataset.tong) || 100;
    let diemMoi = 100 + tongBienDong;
    lopDangChon.querySelector(".tong").innerText = diemMoi;
    lopDangChon.dataset.tong = diemMoi;

    // GHI NH·∫¨T K√ù
    const time = new Date().toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    const logMsg = chiTietLoi.length > 0 ? chiTietLoi.join(", ") : "C·∫≠p nh·∫≠t l·∫°i (kh√¥ng c√≥ l·ªói)";
    addLog(`[${time}] L·ªõp ${tenLop}: ${logMsg}. T·ªïng ƒëi·ªÉm: ${diemMoi}ƒë`);

    xepHang();
    saveAll();
    alert("ƒê√£ c·∫≠p nh·∫≠t v√† ghi nh·∫≠t k√Ω!");
}

function addLog(msg) {
    logs.unshift(msg); // Th√™m v√†o ƒë·∫ßu danh s√°ch
    if(logs.length > 50) logs.pop(); // Gi·ªõi h·∫°n 50 d√≤ng
    renderLogs();
}

function renderLogs() {
    const container = document.getElementById("log-list");
    if(logs.length === 0) {
        container.innerHTML = '<div class="log-item">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o.</div>';
        return;
    }
    container.innerHTML = logs.map(l => `<div class="log-item"><span class="log-content">${l}</span></div>`).join("");
}

function xepHang() {
    let rows = Array.from(document.querySelectorAll(".lop-row"));
    rows.sort((a,b) => (Number(b.dataset.tong) || 100) - (Number(a.dataset.tong) || 100));
    let container = document.getElementById("body-bang");
    rows.forEach((r, i) => {
        r.cells[0].innerText = i + 1;
        container.appendChild(r);
    });
}

function saveAll() {
    localStorage.setItem('pa_data', JSON.stringify({
        diem: Array.from(document.querySelectorAll(".lop-row")).map(r => ({l: r.dataset.lop, d: r.dataset.tong})),
        loi: dataLoi,
        nhatky: logs
    }));
}

function loadAll() {
    const raw = localStorage.getItem('pa_data');
    if (!raw) return;
    const data = JSON.parse(raw);
    if (data.diem) data.diem.forEach(item => {
        let r = document.querySelector(`.lop-row[data-lop="${item.l}"]`);
        if(r) { r.querySelector(".tong").innerText = item.d; r.dataset.tong = item.d; }
    });
    dataLoi = data.loi || {};
    logs = data.nhatky || [];
    renderLogs();
    xepHang();
}

function clearLog() {
    if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫°ch nh·∫≠t k√Ω ho·∫°t ƒë·ªông?")) {
        logs = [];
        renderLogs();
        saveAll();
    }
}
</script>
</body>
</html>
