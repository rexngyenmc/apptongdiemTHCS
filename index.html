<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QU·∫¢N L√ù THI ƒêUA PH∆Ø·ªöC AN</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 10px; }
        .header { text-align: center; padding: 10px; background: #0056b3; color: white; margin-bottom: 10px; border-radius: 5px; }
        
        .container { display: flex; gap: 10px; }
        
        /* B·∫¢NG X·∫æP H·∫†NG B√äN TR√ÅI */
        .left-panel { width: 35%; background: white; border: 1px solid #ccc; border-radius: 5px; padding: 10px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #f2f2f2; font-size: 0.8rem; }
        .row-lop { cursor: pointer; }
        .row-lop:hover { background: #f9f9f9; }
        .selected { background: #e3f2fd !important; font-weight: bold; border: 2px solid #2196F3; }

        /* FORM CH·∫§M ƒêI·ªÇM B√äN PH·∫¢I */
        .right-panel { width: 65%; background: white; border: 1px solid #ccc; border-radius: 5px; padding: 10px; position: relative; }
        .sticky-header { position: sticky; top: 0; background: white; padding-bottom: 10px; border-bottom: 2px solid #0056b3; z-index: 10; }
        
        .input-group { margin: 10px 0; }
        input[type="text"] { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #0056b3; border-radius: 4px; font-size: 1rem; }
        
        .scroll-list { height: 450px; overflow-y: auto; margin-top: 10px; border: 1px solid #eee; }
        .loi-item { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; }
        .loi-item:hover { background: #fdfdfd; }
        .loi-name { flex: 1; font-size: 0.9rem; margin-left: 10px; }
        .loi-score { font-weight: bold; width: 40px; text-align: right; }
        
        .btn-save { width: 100%; padding: 15px; background: #2e7d32; color: white; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; margin-top: 10px; }
        .btn-zalo { width: 100%; padding: 10px; background: #0068ff; color: white; border: none; margin-top: 10px; cursor: pointer; border-radius: 4px; }

        .group-tag { background: #eee; padding: 5px; font-size: 0.7rem; font-weight: bold; color: #555; margin-top: 10px; }
        .red { color: red; } .green { color: green; }
        .nhat-ky { margin-top: 10px; font-size: 0.75rem; color: #666; background: #fffde7; padding: 5px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="header">
    <h3 style="margin:0">THI ƒêUA PH∆Ø·ªöC AN 2025-2026</h3>
</div>

<div class="container">
    <div class="left-panel">
        <h4 style="margin:0 0 10px 0; text-align:center">B·∫¢NG ƒêI·ªÇM</h4>
        <table>
            <thead>
                <tr><th>XH</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr>
            </thead>
            <tbody id="ds-lop">
                <script>
                    const dsLop = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
                    dsLop.forEach(l => {
                        document.write(`<tr class="row-lop" id="row-${l}" onclick="chonLop('${l}')">
                            <td id="rank-${l}">-</td>
                            <td style="text-align:left">${l}</td>
                            <td id="diem-${l}" style="color:blue">100</td>
                        </tr>`);
                    });
                </script>
            </tbody>
        </table>
        <button class="btn-zalo" onclick="copyZalo()">COPY B√ÅO C√ÅO</button>
    </div>

    <div id="form-panel" class="right-panel" style="display:none">
        <div class="sticky-header">
            <h4 id="lbl-lop" style="margin:0; color:#0056b3">CH·ªåN L·ªöP</h4>
            <div class="input-group">
                <input type="text" id="txt-ten" placeholder="Nh·∫≠p t√™n HS vi ph·∫°m...">
            </div>
            <button class="btn-save" onclick="xacNhan()">L∆ØU ƒê·ª¢T N√ÄY</button>
        </div>

        <div class="scroll-list" id="list-loi">
            <div class="group-tag">T√ÅC PHONG</div>
            <div class="loi-item" onclick="tick('l1')"><input type="checkbox" id="l1" data-d="-5" data-n="KhƒÉn qu√†ng"> <span class="loi-name">Kh√¥ng khƒÉn qu√†ng/Huy hi·ªáu</span> <span class="loi-score red">-5</span></div>
            <div class="loi-item" onclick="tick('l2')"><input type="checkbox" id="l2" data-d="-5" data-n="T√°c phong"> <span class="loi-name">Kh√¥ng b·ªè √°o v√†o qu·∫ßn</span> <span class="loi-score red">-5</span></div>
            <div class="loi-item" onclick="tick('l3')"><input type="checkbox" id="l3" data-d="-5" data-n="√Åo kho√°c"> <span class="loi-name">M·∫∑c √°o kho√°c sai quy ƒë·ªãnh</span> <span class="loi-score red">-5</span></div>
            
            <div class="group-tag">K·ª∂ LU·∫¨T</div>
            <div class="loi-item" onclick="tick('l4')"><input type="checkbox" id="l4" data-d="-10" data-n="N√≥i t·ª•c"> <span class="loi-name">N√≥i t·ª•c, ch·ª≠i th·ªÅ</span> <span class="loi-score red">-10</span></div>
            <div class="loi-item" onclick="tick('l5')"><input type="checkbox" id="l5" data-d="-10" data-n="ƒê√°nh nhau"> <span class="loi-name">ƒê√°nh nhau</span> <span class="loi-score red">-10</span></div>
            <div class="loi-item" onclick="tick('l6')"><input type="checkbox" id="l6" data-d="-2" data-n="ƒêi tr·ªÖ"> <span class="loi-name">ƒêi tr·ªÖ</span> <span class="loi-score red">-2</span></div>
            
            <div class="group-tag">H·ªåC T·∫¨P & TH∆Ø·ªûNG</div>
            <div class="loi-item" onclick="tick('l7')"><input type="checkbox" id="l7" data-d="10" data-n="ƒêi·ªÉm 10"> <span class="loi-name">ƒê·∫°t ƒëi·ªÉm 10</span> <span class="loi-score green">+10</span></div>
            <div class="loi-item" onclick="tick('l8')"><input type="checkbox" id="l8" data-d="5" data-n="Vi·ªác t·ªët"> <span class="loi-name">Vi·ªác t·ªët/C·ªßa r∆°i</span> <span class="loi-score green">+5</span></div>
            <div class="loi-item" onclick="tick('l9')"><input type="checkbox" id="l9" data-d="10" data-n="Ti·∫øt A" data-type="L"> <span class="loi-name">Ti·∫øt h·ªçc lo·∫°i A</span> <span class="loi-score green">+10</span></div>
        </div>
        
        <div id="log" class="nhat-ky"></div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('pa_old_style')) || {};
    let currentLop = "";

    function tick(id) { document.getElementById(id).checked = !document.getElementById(id).checked; }

    function chonLop(l) {
        currentLop = l;
        document.querySelectorAll('.row-lop').forEach(r => r.classList.remove('selected'));
        document.getElementById('row-'+l).classList.add('selected');
        document.getElementById('form-panel').style.display = "block";
        document.getElementById('lbl-lop').innerText = "CH·∫§M ƒêI·ªÇM: L·ªöP " + l;
        renderLog();
    }

    function xacNhan() {
        const tenVal = document.getElementById('txt-ten').value.trim();
        const dsTen = tenVal.split(/[,.;]+/).filter(x => x.trim().length > 0);
        const checks = Array.from(document.querySelectorAll('#list-loi input:checked'));

        if (checks.length === 0) return alert("Ch∆∞a ch·ªçn l·ªói!");
        const isClassError = checks.every(c => c.dataset.type === "L");
        if (!isClassError && dsTen.length === 0) return alert("Ch∆∞a nh·∫≠p t√™n HS!");

        if (!db[currentLop]) db[currentLop] = { total: 100, logs: [] };

        let scoreChange = 0;
        let desc = [];

        checks.forEach(c => {
            let diem = parseInt(c.dataset.d);
            let n = c.dataset.type === "L" ? 1 : dsTen.length;
            scoreChange += (diem * n);
            desc.push(c.dataset.n);
        });

        db[currentLop].total += scoreChange;
        db[currentLop].logs.unshift(`${new Date().toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'})}: ${scoreChange}ƒë - ${tenVal || 'C·∫£ l·ªõp'} (${desc.join(",")})`);

        // Reset
        document.getElementById('txt-ten').value = "";
        checks.forEach(c => c.checked = false);
        
        localStorage.setItem('pa_old_style', JSON.stringify(db));
        updateBang();
        renderLog();
    }

    function updateBang() {
        dsLop.forEach(l => {
            const s = db[l] ? db[l].total : 100;
            document.getElementById('diem-'+l).innerText = s;
        });
        const sorted = [...dsLop].sort((a,b) => (db[b]?.total||100) - (db[a]?.total||100));
        sorted.forEach((l, i) => document.getElementById('rank-'+l).innerText = i+1);
    }

    function renderLog() {
        const logBox = document.getElementById('log');
        if (!db[currentLop] || db[currentLop].logs.length === 0) {
            logBox.innerHTML = "Ch∆∞a c√≥ nh·∫≠t k√Ω ch·∫•m.";
            return;
        }
        logBox.innerHTML = "<b>L·ªãch s·ª≠:</b><br>" + db[currentLop].logs.join("<br>");
    }

    function copyZalo() {
        let msg = "üìä THI ƒêUA PH∆Ø·ªöC AN\n";
        [...dsLop].sort((a,b) => (db[b]?.total||100) - (db[a]?.total||100)).forEach((l, i) => {
            msg += `${i+1}. L·ªõp ${l}: ${db[l]?.total || 100}ƒë\n`;
        });
        navigator.clipboard.writeText(msg).then(() => alert("ƒê√£ copy!"));
    }

    updateBang();
</script>
</body>
</html>
