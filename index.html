<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω ƒêi·ªÉm Sao ƒê·ªè THCS</title>
    <style>
        :root {
            --primary-color: #1976d2;
            --accent-color: #d32f2f;
            --bg-color: #f0f4f8;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg-color); margin: 0; padding: 15px; }
        h1 { text-align: center; color: var(--primary-color); text-transform: uppercase; font-size: 1.4rem; }

        .container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; max-width: 1000px; margin: 0 auto; }

        .table-section { flex: 1; min-width: 320px; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th, td { border-bottom: 1px solid #eee; padding: 12px 8px; text-align: center; }
        th { background: var(--primary-color); color: white; }

        .lop-row { cursor: pointer; transition: 0.2s; }
        .lop-row:hover { background: #e3f2fd; }
        .dang-chon { background: #fff9c4 !important; outline: 2px solid #ffd600; }

        .panel-section { width: 320px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); display: none; position: sticky; top: 10px; height: fit-content; }
        .panel-section h3 { text-align: center; margin: 0 0 10px 0; color: var(--accent-color); }
        .current-score { text-align: center; font-weight: bold; margin-bottom: 15px; color: #555; }
        
        .loi-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; background: #fafafa; padding: 8px; border-radius: 6px; }
        input[type=number] { width: 50px; padding: 8px; border: 1px solid #ccc; border-radius: 6px; text-align: center; font-size: 1rem; }

        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-apply { background: #2e7d32; color: white; }
        .btn-zalo { background: #1976d2; color: white; margin-top: 20px; }
        .btn-reset { background: #9e9e9e; color: white; font-size: 0.8rem; }

        @media (max-width: 600px) {
            .container { flex-direction: column; }
            .panel-section { width: auto; position: static; }
        }
    </style>
</head>
<body>

<h1>B·∫¢NG ƒêI·ªÇM SAO ƒê·ªé</h1>

<div class="container">
    <div class="table-section">
        <table>
            <thead>
                <tr>
                    <th>H·∫°ng</th>
                    <th>L·ªõp</th>
                    <th>ƒêi·ªÉm</th>
                </tr>
            </thead>
            <tbody id="body-bang">
                <tr class="lop-row" data-lop="6A" onclick="chonLop(this)"> <td class="xephang"></td> <td>6A</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="6B" onclick="chonLop(this)"> <td class="xephang"></td> <td>6B</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="6C" onclick="chonLop(this)"> <td class="xephang"></td> <td>6C</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="7A" onclick="chonLop(this)"> <td class="xephang"></td> <td>7A</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="7B" onclick="chonLop(this)"> <td class="xephang"></td> <td>7B</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="7C" onclick="chonLop(this)"> <td class="xephang"></td> <td>7C</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="8A" onclick="chonLop(this)"> <td class="xephang"></td> <td>8A</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="8B" onclick="chonLop(this)"> <td class="xephang"></td> <td>8B</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="8C" onclick="chonLop(this)"> <td class="xephang"></td> <td>8C</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="9A" onclick="chonLop(this)"> <td class="xephang"></td> <td>9A</td> <td class="tong">100</td> </tr>
                <tr class="lop-row" data-lop="9B" onclick="chonLop(this)"> <td class="xephang"></td> <td>9B</td> <td class="tong">100</td> </tr>
            </tbody>
        </table>
        <button class="btn btn-zalo" onclick="xuatBaoCao()">üìã Sao ch√©p b√°o c√°o g·ª≠i Zalo</button>
        <button class="btn btn-reset" onclick="resetDiem()">üîÑ L√†m m·ªõi ƒëi·ªÉm t·∫•t c·∫£ c√°c l·ªõp</button>
    </div>

    <div id="panel" class="panel-section">
        <h3 id="tenlop">L·ªõp</h3>
        <div id="diem-hien-tai" class="current-score">ƒêi·ªÉm hi·ªán t·∫°i: 100</div>
        
        <div class="loi-item"><span>ƒêi h·ªçc mu·ªôn (-2)</span><input type="number" id="loi1" min="0" data-diem="2" class="input-loi"></div>
        <div class="loi-item"><span>ƒê·ªìng ph·ª•c (-5)</span><input type="number" id="loi2" min="0" data-diem="5" class="input-loi"></div>
        <div class="loi-item"><span>KhƒÉn qu√†ng (-3)</span><input type="number" id="loi3" min="0" data-diem="3" class="input-loi"></div>
        <div class="loi-item"><span>·ªín √†o (-2)</span><input type="number" id="loi4" min="0" data-diem="2" class="input-loi"></div>
        <div class="loi-item"><span>V·ªá sinh (-5)</span><input type="number" id="loi5" min="0" data-diem="5" class="input-loi"></div>
        
        <button class="btn btn-apply" onclick="apDung()">C·∫¨P NH·∫¨T ƒêI·ªÇM</button>
    </div>
</div>

<script>
let lopDangChon = null;
let dataLoi = {}; // N∆°i l∆∞u s·ªë l·∫ßn vi ph·∫°m c·ªßa t·ª´ng l·ªõp

window.onload = () => {
    loadData();
    xepHang();
};

function chonLop(row) {
    document.querySelectorAll(".lop-row").forEach(r => r.classList.remove("dang-chon"));
    row.classList.add("dang-chon");
    
    lopDangChon = row;
    const tenLop = row.dataset.lop;
    
    document.getElementById("panel").style.display = "block";
    document.getElementById("tenlop").innerText = "Ch·∫•m ƒëi·ªÉm L·ªõp " + tenLop;
    document.getElementById("diem-hien-tai").innerText = "ƒêi·ªÉm hi·ªán t·∫°i: " + row.querySelector(".tong").innerText;

    // Hi·ªÉn th·ªã l·∫°i c√°c s·ªë li·ªáu ƒë√£ nh·∫≠p c≈© c·ªßa l·ªõp n√†y (n·∫øu c√≥)
    const loiCuaLop = dataLoi[tenLop] || {loi1:0, loi2:0, loi3:0, loi4:0, loi5:0};
    document.getElementById("loi1").value = loiCuaLop.loi1;
    document.getElementById("loi2").value = loiCuaLop.loi2;
    document.getElementById("loi3").value = loiCuaLop.loi3;
    document.getElementById("loi4").value = loiCuaLop.loi4;
    document.getElementById("loi5").value = loiCuaLop.loi5;
    
    if(window.innerWidth < 600) document.getElementById("panel").scrollIntoView({behavior: "smooth"});
}

function apDung() {
    if(!lopDangChon) return;
    const tenLop = lopDangChon.dataset.lop;
    
    let tongTru = 0;
    // L∆∞u l·∫°i s·ªë l·∫ßn vi ph·∫°m v√†o bi·∫øn dataLoi
    dataLoi[tenLop] = {
        loi1: Number(document.getElementById("loi1").value) || 0,
        loi2: Number(document.getElementById("loi2").value) || 0,
        loi3: Number(document.getElementById("loi3").value) || 0,
        loi4: Number(document.getElementById("loi4").value) || 0,
        loi5: Number(document.getElementById("loi5").value) || 0
    };

    // T√≠nh t·ªïng ƒëi·ªÉm tr·ª´
    document.querySelectorAll(".input-loi").forEach(i => {
        tongTru += (Number(i.value) || 0) * Number(i.dataset.diem);
    });

    let diemMoi = 100 - tongTru;
    if (diemMoi < 0) diemMoi = 0;

    lopDangChon.querySelector(".tong").innerText = diemMoi;
    lopDangChon.dataset.tong = diemMoi;
    document.getElementById("diem-hien-tai").innerText = "ƒêi·ªÉm hi·ªán t·∫°i: " + diemMoi;

    xepHang();
    saveData();
    
    const btn = document.querySelector(".btn-apply");
    btn.innerText = "ƒê√É L∆ØU!";
    setTimeout(() => btn.innerText = "C·∫¨P NH·∫¨T ƒêI·ªÇM", 800);
}

function xepHang() {
    let rows = Array.from(document.querySelectorAll(".lop-row"));
    rows.sort((a,b) => (Number(b.dataset.tong) || 100) - (Number(a.dataset.tong) || 100));
    let container = document.getElementById("body-bang");
    rows.forEach((r, i) => {
        let h = i + 1;
        r.querySelector(".xephang").innerText = (h==1)?"ü•á":(h==2)?"ü•à":(h==3)?"ü•â":h;
        container.appendChild(r);
    });
}

function saveData() {
    localStorage.setItem('saoDo_Diem', JSON.stringify(Array.from(document.querySelectorAll(".lop-row")).map(r => ({lop: r.dataset.lop, diem: r.dataset.tong}))));
    localStorage.setItem('saoDo_Loi', JSON.stringify(dataLoi));
}

function loadData() {
    const savedDiem = JSON.parse(localStorage.getItem('saoDo_Diem'));
    const savedLoi = JSON.parse(localStorage.getItem('saoDo_Loi'));
    if (savedDiem) {
        savedDiem.forEach(item => {
            let r = document.querySelector(`.lop-row[data-lop="${item.lop}"]`);
            if(r) { r.querySelector(".tong").innerText = item.diem; r.dataset.tong = item.diem; }
        });
    }
    if (savedLoi) dataLoi = savedLoi;
}

function resetDiem() {
    if(confirm("L√†m m·ªõi to√†n b·ªô d·ªØ li·ªáu?")) {
        localStorage.clear();
        location.reload();
    }
}

function xuatBaoCao() {
    let text = "üìã B√ÅO C√ÅO ƒêI·ªÇM SAO ƒê·ªé\n";
    document.querySelectorAll(".lop-row").forEach(r => {
        text += `${r.querySelector(".xephang").innerText}. L·ªõp ${r.dataset.lop}: ${r.querySelector(".tong").innerText}ƒë\n`;
    });
    navigator.clipboard.writeText(text).then(() => alert("ƒê√£ sao ch√©p b√°o c√°o!"));
}
</script>
</body>
</html>
