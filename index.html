<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªá Th·ªëng Ph∆∞·ªõc An 2026</title>
    <style>
        :root { --blue: #1a73e8; --green: #34a853; --orange: #fbbc05; --red: #ea4335; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; color: #333; }
        .screen { display: none; padding: 15px; max-width: 900px; margin: auto; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
        .card { background: white; border-radius: 12px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        
        /* Buttons */
        .btn-main { width: 100%; padding: 18px; border: none; border-radius: 10px; color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .btn-cl { padding: 12px 5px; border: 1px solid #ddd; border-radius: 8px; background: white; font-weight: bold; cursor: pointer; }
        .btn-cl.active { background: var(--blue); color: white; border-color: var(--blue); }

        /* Ch·∫•m ƒëi·ªÉm theo b·∫£ng */
        .item-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; align-items: center; }
        .detail-area { display: none; padding: 15px; background: #fdfdfd; border: 1px solid #eee; flex-direction: column; gap: 10px; border-radius: 8px; margin: 5px 0 15px 0; }
        input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
        
        /* B·∫£ng l·ªãch s·ª≠ theo ƒë√∫ng m·∫´u user g·ª≠i */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background: white; font-size: 13px; }
        th, td { border: 1px solid #dee2e6; padding: 10px; text-align: left; }
        th { background: #f8f9fa; font-weight: bold; }
        .btn-del { color: var(--red); cursor: pointer; font-weight: bold; border: none; background: none; font-size: 16px; }

        #sync-status { position: fixed; top: 0; width: 100%; background: var(--orange); text-align: center; padding: 5px; font-weight: bold; display: none; z-index: 1000; }
        .class-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
    </style>
</head>
<body>

<div id="sync-status">ƒêang ƒë·ªìng b·ªô d·ªØ li·ªáu...</div>

<div id="home-screen" class="screen" style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh;">
    <h1 style="color:var(--blue); margin-bottom:5px;">PH∆Ø·ªöC AN 2026</h1>
    <p style="margin-bottom:30px; color:#666;">H·ªçc k·ª≥ 2 - NƒÉm h·ªçc 2025-2026</p>
    <button class="btn-main" style="background:var(--blue)" onclick="init('GV')">GI√ÅO VI√äN</button>
    <button class="btn-main" style="background:var(--green)" onclick="init('SD')">SAO ƒê·ªé</button>
    <button class="btn-main" style="background:var(--orange); color:black" onclick="init('BXH')">B·∫¢NG V√ÄNG THI ƒêUA</button>
</div>

<div id="auth-screen" class="screen">
    <button onclick="goHome()">‚Üê Quay l·∫°i</button>
    <div class="card" style="margin-top:15px">
        <h3 id="auth-title">ƒêƒÉng nh·∫≠p</h3>
        <input type="password" id="pin-input" placeholder="M√£ PIN" style="display:none; margin-bottom:10px; text-align:center;">
        <input type="text" id="user-search" placeholder="T√¨m t√™n c·ªßa b·∫°n..." onkeyup="filterUser()">
        <div id="user-list" style="max-height:200px; overflow-y:auto; border:1px solid #eee; border-radius:8px; margin-top:10px;"></div>
        <button class="btn-main" style="background:var(--blue); margin-top:15px" onclick="verifyUser()">V√ÄO H·ªÜ TH·ªêNG</button>
    </div>
</div>

<div id="score-screen" class="screen">
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <b id="info-header" style="color:var(--blue)"></b>
            <button onclick="showScreen('auth-screen')">ƒê·ªïi l·ªõp</button>
        </div>
        <div class="class-grid" id="class-btns"></div>
    </div>

    <div id="input-area" style="display:none">
        <div class="card">
            <h4 style="margin:0 0 10px 0">Danh m·ª•c vi ph·∫°m / Vi·ªác t·ªët</h4>
            <div id="criteria-list"></div>
        </div>

        <div class="card">
            <h4 style="margin:0 0 10px 0">L·ªãch s·ª≠ v·ª´a nh·∫≠p (Ch∆∞a l∆∞u)</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>N·ªôi dung</th>
                            <th>Bi·ªÉu ƒëi·ªÉm</th>
                            <th>H·ªçc sinh</th>
                            <th>L·∫ßn</th>
                            <th>T·ªïng</th>
                            <th>X√≥a</th>
                        </tr>
                    </thead>
                    <tbody id="ls-body"></tbody>
                </table>
            </div>
            <div style="text-align:right; margin-top:10px; font-weight:bold; font-size:1.1rem">
                T·ªïng ƒëi·ªÉm tu·∫ßn: <span id="total-preview" style="color:var(--blue)">0</span>
            </div>
            <button class="btn-main" style="background:var(--green); margin-top:15px" onclick="syncToCloud()">L∆ØU V√Ä ƒê·ªíNG B·ªò L√äN TV</button>
        </div>
    </div>
</div>

<div id="bxh-screen" class="screen">
    <h1 style="text-align:center; color:var(--orange)">üèÜ B·∫¢NG V√ÄNG THI ƒêUA</h1>
    <div id="bxh-content"></div>
    <button class="btn-main" style="background:#444; margin-top:20px" onclick="goHome()">QUAY L·∫†I</button>
</div>

<script>
// --- C·∫§U H√åNH ---
const SCRIPT_URL = "D√ÅN_URL_APP_SCRIPT_C·ª¶A_B·∫†N_V√ÄO_ƒê√ÇY";
const DANH_SACH_LOP = ["6A1","6A2","6A3","7A1","7A2","8A1","8A2","9A1","9A2"];
const DS_GV = ["C√¥ Hu·ªá", "Th·∫ßy S∆°n", "C√¥ Lan", "Th·∫ßy H√πng", "Th·∫ßy ƒê·ª©c"];
const DS_SD = ["An 9A1", "B√¨nh 8A2", "Chi 7A1", "D≈©ng 6A2", "H·∫°nh 9A2"];

// D·ªØ li·ªáu b√°m s√°t source: 5 c·ªßa b·∫°n
const DATA_SD = [
    {h: "T√°c phong", ds: [
        {n:"Kh√¥ng khƒÉn qu√†ng/Huy hi·ªáu", d:-5}, [cite: 5]
        {n:"Kh√¥ng b·ªè √°o v√†o qu·∫ßn", d:-5}, [cite: 5]
        {n:"M·∫∑c √°o kho√°c sai quy ƒë·ªãnh", d:-5}, [cite: 5]
        {n:"ƒê·ªìng ph·ª•c kh√¥ng ƒë√∫ng", d:-5}, [cite: 5]
        {n:"ƒêi ch√¢n tr·∫ßn", d:-5}, [cite: 5]
        {n:"T√≥c d√†i (nam)", d:-5}, [cite: 5]
        {n:"Nhu·ªôm t√≥c/Trang ƒëi·ªÉm", d:-10} [cite: 5]
    ]},
    {h: "N·ªÅ n·∫øp & K·ª∑ lu·∫≠t", ds: [
        {n:"ƒê·ªÉ xe kh√¥ng ngay h√†ng", d:-5}, [cite: 5]
        {n:"Kh√¥ng ƒë·ªôi n√≥n b·∫£o hi·ªÉm", d:-5}, [cite: 5]
        {n:"Ra c·ªïng kh√¥ng xin ph√©p", d:-5}, [cite: 5]
        {n:"S·ª≠ d·ª•ng ƒêT sai n∆°i", d:-5}, [cite: 5]
        {n:"N√≥i t·ª•c/Ch·ª≠i th·ªÅ", d:-10}, [cite: 5]
        {n:"ƒê√°nh nhau", d:-10}, [cite: 5]
        {n:"ƒêi tr·ªÖ", d:-2}, [cite: 5]
        {n:"V·∫Øng kh√¥ng ph√©p", d:-5}, [cite: 5]
        {n:"Tr·ªën ti·∫øt/N√≥i chuy·ªán ri√™ng", d:-10} [cite: 5]
    ]},
    {h: "Nghi·ªáp v·ª• Sao ƒë·ªè", ds: [
        {n:"Sƒê kh√¥ng ƒëeo bƒÉng/Tr·ª±c tr·ªÖ", d:-10}, [cite: 5]
        {n:"Sƒê kh√¥ng ƒëi tr·ª±c", d:-20}, [cite: 5]
        {n:"Sƒê kh√¥ng t·ªïng k·∫øt cu·ªëi tu·∫ßn", d:-50} [cite: 5]
    ]}
];

const DATA_GV = [
    {h: "H·ªçc t·∫≠p", ds: [
        {n:"Ti·∫øt A", d:10}, {n:"Ti·∫øt B", d:5}, [cite: 5]
        {n:"Ti·∫øt C", d:-5}, {n:"Ti·∫øt D", d:-10}, [cite: 5]
        {n:"ƒêi·ªÉm 10", d:10}, {n:"ƒêi·ªÉm 8,9", d:9}, [cite: 5]
        {n:"ƒêi·ªÉm 7", d:5}, {n:"ƒêi·ªÉm 4", d:-5}, [cite: 5]
        {n:"ƒêi·ªÉm 0,1,2,3", d:-10}, [cite: 5]
        {n:"Kh√¥ng thu·ªôc b√†i/L√†m b√†i t·∫≠p", d:-10} [cite: 5]
    ]},
    {h: "Phong tr√†o", ds: [
        {n:"H·∫°ng Nh·∫•t/Nh√¨/Ba phong tr√†o", d:50}, [cite: 5]
        {n:"Nh·∫∑t ƒë∆∞·ª£c c·ªßa r∆°i tr·∫£ l·∫°i", d:5} [cite: 5]
    ]}
];

let role="", user="", currentLop="", lsTemp=[];

function init(r){
    role=r; if(r==='BXH') return renderBXH();
    showScreen('auth-screen');
    document.getElementById('pin-input').style.display=(r==='SD'?'block':'none');
    renderUserList();
}

function renderUserList(){
    let list = (role==='GV'?DS_GV:DS_SD).sort();
    let h=""; list.forEach(n => h+=`<div style="padding:12px; border-bottom:1px solid #eee; cursor:pointer;" onclick="selU(this)">${n}</div>`);
    document.getElementById('user-list').innerHTML=h;
}

function selU(el){
    Array.from(el.parentNode.children).forEach(i=>i.style.background="white");
    el.style.background="#e8f0fe"; user=el.innerText;
}

function verifyUser(){
    if(!user) return alert("Vui l√≤ng ch·ªçn t√™n!");
    showScreen('score-screen');
    let h=""; DANH_SACH_LOP.forEach(l => h+=`<button class="btn-cl" onclick="selLop('${l}',this)">${l}</button>`);
    document.getElementById('class-btns').innerHTML=h;
}

function selLop(l, b){
    currentLop=l; document.querySelectorAll('.btn-cl').forEach(i=>i.classList.remove('active'));
    b.classList.add('active'); document.getElementById('info-header').innerText="Ng∆∞·ªùi tr·ª±c: "+user+" | L·ªõp: "+l;
    document.getElementById('input-area').style.display='block'; renderCriteria();
}

function renderCriteria(){
    let h="", data=(role==='GV'?DATA_GV:DATA_SD);
    data.forEach((g,gi)=>{
        h+=`<h5 style="margin:10px 0 5px 0; color:#888;">${g.h}</h5>`;
        g.ds.forEach((item,ii)=>{
            let id=`row-${gi}-${ii}`;
            h+=`<div class="item-row" onclick="toggle('${id}')"><span>${item.n}</span><b>${item.d}</b></div>
                <div class="detail-area" id="${id}">
                    <input type="text" placeholder="Nh·∫≠p t√™n HS (v√≠ d·ª•: An, B√¨nh, Chi...)" id="hs-${id}">
                    <input type="number" value="1" id="sl-${id}" placeholder="S·ªë l·∫ßn">
                    <button class="btn-main" style="background:var(--blue); padding:10px; font-size:0.9rem" onclick="addLS('${item.n}',${item.d},'${id}')">X√°c nh·∫≠n</button>
                </div>`;
        });
    });
    document.getElementById('criteria-list').innerHTML=h;
}

// H√†m th√™m v√†o l·ªãch s·ª≠ - ƒê√∫ng nh∆∞ image_62db9e.png
function addLS(name, score, id){
    let hs = document.getElementById('hs-'+id).value || "C·∫£ l·ªõp";
    let sl = parseInt(document.getElementById('sl-'+id).value) || 1;
    lsTemp.push({
        time: new Date().toLocaleString(),
        lop: currentLop,
        loi: name,
        info: hs,
        sl: sl,
        diem: score,
        tong: score * sl,
        nguoi: user
    });
    renderLS();
    toggle(id);
    document.getElementById('hs-'+id).value = "";
}

function renderLS(){
    let h="", total=0;
    lsTemp.forEach((item, idx)=>{
        total += item.tong;
        h += `<tr>
            <td>${item.loi}</td>
            <td>${item.diem}</td>
            <td>${item.info}</td>
            <td>${item.sl}</td>
            <td style="font-weight:bold; color:${item.tong<0?'red':'green'}">${item.tong}</td>
            <td class="btn-del" onclick="lsTemp.splice(${idx},1);renderLS()">‚úï</td>
        </tr>`;
    });
    document.getElementById('ls-body').innerHTML=h;
    document.getElementById('total-preview').innerText = (total > 0 ? "+" : "") + total;
}

async function syncToCloud(){
    if(lsTemp.length===0) return alert("Ch∆∞a c√≥ l·ªói n√†o ƒë·ªÉ l∆∞u!");
    document.getElementById('sync-status').style.display='block';
    try {
        await fetch(SCRIPT_URL, {method: 'POST', body: JSON.stringify(lsTemp)});
        alert("ƒê√£ g·ª≠i d·ªØ li·ªáu th√†nh c√¥ng!");
        lsTemp=[]; renderLS(); goHome();
    } catch(e) { alert("L·ªói k·∫øt n·ªëi m√°y ch·ªß!"); }
    document.getElementById('sync-status').style.display='none';
}

async function renderBXH(){
    showScreen('bxh-screen');
    document.getElementById('bxh-content').innerHTML="ƒêang t·∫£i d·ªØ li·ªáu...";
    try {
        const res = await fetch(SCRIPT_URL); const data = await res.json();
        let bxh={}; DANH_SACH_LOP.forEach(l => bxh[l]=100);
        data.slice(1).forEach(r => { if(bxh[r[1]]!==undefined) bxh[r[1]]+=parseFloat(r[5]); });
        let sorted = Object.entries(bxh).sort((a,b)=>b[1]-a[1]);
        let h=""; 
        sorted.forEach((item,idx)=> {
            h+=`<div style="display:flex; padding:15px; margin:10px; background:rgba(255,255,255,0.1); border-radius:10px; align-items:center;">
                <span style="font-size:1.5rem; width:40px">${idx+1}</span>
                <span style="flex:1; font-size:1.2rem">L·ªõp ${item[0]}</span>
                <span style="font-size:1.3rem; font-weight:bold">${item[1]} ƒë</span>
            </div>`;
        });
        document.getElementById('bxh-content').innerHTML=h;
    } catch(e) { document.getElementById('bxh-content').innerHTML="L·ªói t·∫£i d·ªØ li·ªáu!"; }
}

function filterUser(){
    let v=document.getElementById('user-search').value.toLowerCase();
    document.querySelectorAll('#user-list div').forEach(it=>it.style.display=it.innerText.toLowerCase().includes(v)?'block':'none');
}
function toggle(id){ let e=document.getElementById(id); e.style.display=(e.style.display==='flex'?'none':'flex'); }
function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.style.display='none'); document.getElementById(id).style.display='block'; }
function goHome(){ location.reload(); }
</script>
</body>
</html>
