<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAO ƒê·ªé PH∆Ø·ªöC AN - FULL BI·ªÇU ƒêI·ªÇM</title>
    <style>
        :root { --p: #0056b3; --a: #e53935; --s: #43a047; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        
        #login-screen { position: fixed; inset: 0; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; color: white; }
        .pin-input { width: 120px; padding: 10px; border-radius: 8px; border: none; font-size: 1.5rem; text-align: center; margin-top: 15px; }

        #main-content { display: none; max-width: 1200px; margin: 0 auto; }
        .container { display: flex; flex-wrap: wrap; gap: 15px; }
        .card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex: 1; min-width: 320px; }

        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px 5px; text-align: center; border-bottom: 1px solid #eee; font-weight: bold; }
        .lop-row { cursor: pointer; }
        .dang-chon { background: #e3f2fd !important; border-left: 5px solid var(--p); }

        .sticky-box { position: sticky; top: 0; background: white; z-index: 50; padding-bottom: 10px; border-bottom: 2px solid #f0f2f5; }
        .name-input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
        .btn-save { width: 100%; padding: 15px; background: var(--s); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .scroll-form { max-height: 500px; overflow-y: auto; margin-top: 10px; padding-right: 5px; }
        .group-title { background: #444; color: white; padding: 8px; font-weight: bold; font-size: 0.75rem; margin-top: 15px; border-radius: 4px; text-transform: uppercase; }
        
        .loi-item { display: flex; align-items: center; padding: 12px 5px; border-bottom: 1px solid #f9f9f9; cursor: pointer; }
        .loi-text { flex: 1; font-size: 0.85rem; margin-left: 10px; color: #333; }
        .loi-score { font-weight: bold; width: 45px; text-align: right; font-size: 0.85rem; }
        .minus { color: var(--a); } .plus { color: var(--s); }

        .log-box { margin-top: 15px; font-size: 0.75rem; background: #fffde7; padding: 10px; border-radius: 8px; border: 1px solid #ffe082; }
        .history-item { border-bottom: 1px dashed #ddd; padding: 5px 0; }
    </style>
</head>
<body>

<div id="login-screen">
    <h3>M·∫¨T KH·∫®U SAO ƒê·ªé</h3>
    <input type="password" id="pin-input" class="pin-input" placeholder="****" maxlength="4" oninput="checkPin()">
</div>

<div id="main-content">
    <div class="container">
        <div class="card" style="flex: 1;">
            <h3 style="text-align:center; color: var(--p);">XH THI ƒêUA</h3>
            <table>
                <tbody id="ds-lop">
                    <script>
                        const lops = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
                        lops.forEach(l => {
                            document.write(`<tr class="lop-row" id="row-${l}" onclick="chonLop('${l}')">
                                <td style="width:30px"><span id="rank-${l}">-</span></td>
                                <td style="text-align:left">L·ªõp ${l}</td>
                                <td style="color:var(--p)" id="diem-${l}">100</td>
                            </tr>`);
                        });
                    </script>
                </tbody>
            </table>
            <button onclick="xuatZalo()" style="width:100%; margin-top:20px; padding:12px; border:none; background:#0068ff; color:white; border-radius:8px; font-weight:bold;">COPY B√ÅO C√ÅO ZALO</button>
            <button onclick="if(confirm('X√≥a h·∫øt ƒëi·ªÉm?')) {localStorage.clear(); location.reload();}" style="width:100%; margin-top:10px; padding:5px; border:none; background:none; color:red; font-size:0.7rem;">Reset Tu·∫ßn M·ªõi</button>
        </div>

        <div id="panel" class="card" style="flex: 2; display:none;">
            <div class="sticky-box">
                <h3 id="label-lop" style="margin:0 0 10px 0; color:var(--p);">Ch·ªçn l·ªõp</h3>
                <input type="text" id="input-ten" class="name-input" placeholder="Nh·∫≠p t√™n HS vi ph·∫°m ƒë·ª£t n√†y...">
                <button class="btn-save" onclick="luuDot()">L∆ØU ƒê·ª¢T N√ÄY & TI·∫æP T·ª§C</button>
            </div>

            <div class="scroll-form" id="form-loi">
                <div class="group-title">1. T√°c phong & ƒê·ªìng ph·ª•c (-5ƒë)</div>
                <div class="loi-item" onclick="toggle('m1')"><input type="checkbox" id="m1" data-d="-5" data-n="KhƒÉn qu√†ng"> <span class="loi-text">Kh√¥ng ƒëeo KhƒÉn qu√†ng/Huy hi·ªáu</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m2')"><input type="checkbox" id="m2" data-d="-5" data-n="T√°c phong"> <span class="loi-text">Kh√¥ng b·ªè √°o v√†o qu·∫ßn</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m3')"><input type="checkbox" id="m3" data-d="-5" data-n="√Åo kho√°c"> <span class="loi-text">M·∫∑c √°o kho√°c trong tr∆∞·ªùng sai quy ƒë·ªãnh</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m4')"><input type="checkbox" id="m4" data-d="-5" data-n="ƒê·ªìng ph·ª•c"> <span class="loi-text">ƒê·ªìng ph·ª•c kh√¥ng ƒë√∫ng quy ƒë·ªãnh</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m5')"><input type="checkbox" id="m5" data-d="-5" data-n="Ch√¢n tr·∫ßn"> <span class="loi-text">ƒêi ch√¢n tr·∫ßn ra s√¢n/WC</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m6')"><input type="checkbox" id="m6" data-d="-5" data-n="T√≥c d√†i"> <span class="loi-text">ƒê·ªÉ t√≥c d√†i (nam)</span> <span class="loi-score minus">-5</span></div>
                
                <div class="group-title">2. ƒê·∫°o ƒë·ª©c & K·ª∑ lu·∫≠t (-10ƒë/ -30ƒë)</div>
                <div class="loi-item" onclick="toggle('m7')"><input type="checkbox" id="m7" data-d="-10" data-n="Nhu·ªôm/Son"> <span class="loi-text">Nhu·ªôm t√≥c, t√¥ son, s∆°n m√≥ng</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m8')"><input type="checkbox" id="m8" data-d="-10" data-n="N√≥i t·ª•c"> <span class="loi-text">N√≥i t·ª•c, ch·ª≠i th·ªÅ</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m9')"><input type="checkbox" id="m9" data-d="-10" data-n="ƒê√°nh nhau"> <span class="loi-text">ƒê√°nh nhau</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m10')"><input type="checkbox" id="m10" data-d="-10" data-n="Ch·ªëng ƒë·ªëi"> <span class="loi-text">Ch·ªëng ƒë·ªëi Sao ƒë·ªè</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m11')"><input type="checkbox" id="m11" data-d="-30" data-n="H∆∞ h·ªèng TS"> <span class="loi-text">C·ªë √Ω l√†m h∆∞ h·ªèng t√†i s·∫£n tr∆∞·ªùng</span> <span class="loi-score minus">-30</span></div>
                <div class="loi-item" onclick="toggle('m12')"><input type="checkbox" id="m12" data-d="-30" data-n="Ph√° r√†o"> <span class="loi-text">Chui r√†o, ph√° h√†ng r√†o</span> <span class="loi-score minus">-30</span></div>
                <div class="loi-item" onclick="toggle('m13')"><input type="checkbox" id="m13" data-d="-20" data-n="B·ªè r√°c b·∫≠y"> <span class="loi-text">B·ªè r√°c kh√¥ng ƒë√∫ng n∆°i quy ƒë·ªãnh</span> <span class="loi-score minus">-20</span></div>

                <div class="group-title">3. Chuy√™n c·∫ßn & T·∫≠p th·ªÉ</div>
                <div class="loi-item" onclick="toggle('m14')"><input type="checkbox" id="m14" data-d="-2" data-n="ƒêi tr·ªÖ"> <span class="loi-text">ƒêi h·ªçc tr·ªÖ</span> <span class="loi-score minus">-2</span></div>
                <div class="loi-item" onclick="toggle('m15')"><input type="checkbox" id="m15" data-d="-5" data-n="V·∫Øng"> <span class="loi-text">V·∫Øng kh√¥ng ph√©p</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m16')"><input type="checkbox" id="m16" data-d="-10" data-n="Tr·ªën ti·∫øt"> <span class="loi-text">Tr·ªën ti·∫øt</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m17')"><input type="checkbox" id="m17" data-d="-5" data-n="N√≥i chuy·ªán"> <span class="loi-text">N√≥i chuy·ªán ri√™ng</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m18')"><input type="checkbox" id="m18" data-d="-50" data-n="B·ªè SH15" data-tp="L"> <span class="loi-text">L·ªõp kh√¥ng SH 15 ph√∫t</span> <span class="loi-score minus">-50</span></div>
                <div class="loi-item" onclick="toggle('m19')"><input type="checkbox" id="m19" data-d="-20" data-n="Qu·ªëc ca nh·ªè" data-tp="L"> <span class="loi-text">H√°t Qu·ªëc ca nh·ªè/Kh√¥ng h√°t</span> <span class="loi-score minus">-20</span></div>

                <div class="group-title">4. H·ªçc t·∫≠p (C·ªông & Tr·ª´)</div>
                <div class="loi-item" onclick="toggle('m20')"><input type="checkbox" id="m20" data-d="-10" data-n="K.Thu·ªôc b√†i"> <span class="loi-text">Kh√¥ng thu·ªôc b√†i/Kh√¥ng l√†m BT</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m21')"><input type="checkbox" id="m21" data-d="-10" data-n="ƒêi·ªÉm y·∫øu"> <span class="loi-text">ƒêi·ªÉm 0, 1, 2, 3</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m22')"><input type="checkbox" id="m22" data-d="5" data-n="ƒêi·ªÉm 7"> <span class="loi-text">ƒê·∫°t ƒëi·ªÉm 7</span> <span class="loi-score plus">+5</span></div>
                <div class="loi-item" onclick="toggle('m23')"><input type="checkbox" id="m23" data-d="9" data-n="ƒêi·ªÉm 8,9"> <span class="loi-text">ƒê·∫°t ƒëi·ªÉm 8, 9</span> <span class="loi-score plus">+9</span></div>
                <div class="loi-item" onclick="toggle('m24')"><input type="checkbox" id="m24" data-d="10" data-n="ƒêi·ªÉm 10"> <span class="loi-text">ƒê·∫°t ƒëi·ªÉm 10</span> <span class="loi-score plus">+10</span></div>
                <div class="loi-item" onclick="toggle('m25')"><input type="checkbox" id="m25" data-d="10" data-n="Ti·∫øt A" data-tp="L"> <span class="loi-text">1 ti·∫øt h·ªçc lo·∫°i A</span> <span class="loi-score plus">+10</span></div>
                <div class="loi-item" onclick="toggle('m26')"><input type="checkbox" id="m26" data-d="5" data-n="Vi·ªác t·ªët"> <span class="loi-text">Nh·∫∑t ƒë∆∞·ª£c c·ªßa r∆°i tr·∫£ l·∫°i</span> <span class="loi-score plus">+5</span></div>

                <div class="group-title">5. L·ªói Sao ƒë·ªè</div>
                <div class="loi-item" onclick="toggle('m27')"><input type="checkbox" id="m27" data-d="-10" data-n="Sƒê tr·ªÖ" data-tp="L"> <span class="loi-text">Sao ƒë·ªè tr·ª±c tr·ªÖ/Kh√¥ng ƒëeo bƒÉng</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m28')"><input type="checkbox" id="m28" data-d="-20" data-n="Sƒê b·ªè tr·ª±c" data-tp="L"> <span class="loi-text">Sao ƒë·ªè kh√¥ng ƒëi tr·ª±c</span> <span class="loi-score minus">-20</span></div>
            </div>

            <div class="log-box" id="nhat-ky"></div>
        </div>
    </div>
</div>

<script>
const PIN = "1234";
let store = JSON.parse(localStorage.getItem('pa_2026_full')) || {};
let cur = "";

function checkPin() {
    if (document.getElementById("pin-input").value === PIN) {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("main-content").style.display = "block";
        capNhatBang();
    }
}

function toggle(id) {
    const ck = document.getElementById(id);
    ck.checked = !ck.checked;
}

function chonLop(l) {
    cur = l;
    document.querySelectorAll('.lop-row').forEach(r => r.classList.remove('dang-chon'));
    document.getElementById('row-'+l).classList.add('dang-chon');
    document.getElementById('panel').style.display = "block";
    document.getElementById('label-lop').innerText = "ƒêang ch·∫•m L·ªõp " + l;
    inNhatKy();
}

function luuDot() {
    const tenVal = document.getElementById('input-ten').value.trim();
    const hs = tenVal.split(/[,.;]+/).filter(x => x.trim().length > 0);
    const checked = Array.from(document.querySelectorAll('#form-loi input[type="checkbox"]:checked'));

    if (checked.length === 0) return alert("Ch∆∞a ch·ªçn l·ªói!");
    // N·∫øu l·ªói kh√¥ng ph·∫£i lo·∫°i 'L' (L·ªõp) th√¨ b·∫Øt bu·ªôc nh·∫≠p t√™n
    const needsName = checked.some(ck => ck.dataset.tp !== "L");
    if (needsName && hs.length === 0) return alert("Vui l√≤ng nh·∫≠p t√™n HS vi ph·∫°m!");

    if (!store[cur]) store[cur] = { total: 100, logs: [] };

    let dotDiem = 0;
    let dotLoi = [];

    checked.forEach(ck => {
        let diem = parseInt(ck.dataset.d);
        // N·∫øu l√† l·ªói l·ªõp th√¨ t√≠nh 1 l·∫ßn, l·ªói HS th√¨ nh√¢n theo s·ªë l∆∞·ª£ng t√™n
        let count = ck.dataset.tp === "L" ? 1 : hs.length;
        dotDiem += (diem * count);
        dotLoi.push(`${ck.dataset.n}(${count})`);
    });

    store[cur].total += dotDiem;
    store[cur].logs.unshift({
        time: new Date().toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'}),
        names: tenVal || "C·∫£ l·ªõp",
        desc: dotLoi.join(", "),
        score: (dotDiem > 0 ? "+" : "") + dotDiem
    });

    // Reset ƒë·ª£t nh·∫≠p
    document.getElementById('input-ten').value = "";
    checked.forEach(ck => ck.checked = false);
    
    localStorage.setItem('pa_2026_full', JSON.stringify(store));
    capNhatBang();
    inNhatKy();
}

function capNhatBang() {
    lops.forEach(l => {
        const s = store[l] ? store[l].total : 100;
        document.getElementById('diem-'+l).innerText = s + "ƒë";
    });
    const sorted = [...lops].sort((a,b) => (store[b]?.total||100) - (store[a]?.total||100));
    sorted.forEach((l, i) => {
        document.getElementById('rank-'+l).innerText = (i + 1 == 1) ? "ü•á" : (i + 1);
    });
}

function inNhatKy() {
    const box = document.getElementById('nhat-ky');
    if (!store[cur] || store[cur].logs.length === 0) {
        box.innerHTML = "Ch∆∞a c√≥ d·ªØ li·ªáu l·ªõp n√†y."; return;
    }
    let html = "<b>L·ªãch s·ª≠ ch·∫•m ƒë·ª£t:</b><br>";
    store[cur].logs.forEach(i => {
        html += `<div class="history-item"><i>${i.time}</i>: <b style="color:${i.score<0?'red':'green'}">${i.score}ƒë</b> - ${i.names} <br><small>${i.desc}</small></div>`;
    });
    box.innerHTML = html;
}

function xuatZalo() {
    let msg = "üìä B√ÅO C√ÅO THI ƒêUA PH∆Ø·ªöC AN\n";
    const sorted = [...lops].sort((a,b) => (store[b]?.total||100) - (store[a]?.total||100));
    sorted.forEach((l, i) => {
        msg += `${i+1}. L·ªõp ${l}: ${store[l]?.total || 100}ƒë\n`;
    });
    navigator.clipboard.writeText(msg).then(() => alert("ƒê√£ copy b√°o c√°o!"));
}
</script>
</body>
</html>
