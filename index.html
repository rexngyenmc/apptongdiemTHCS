<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sao ƒê·ªè TH&THCS Ph∆∞·ªõc An</title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #f0f8ff; --gold: #ffd700; --silver: #c0c0c0; --bronze: #cd7f32; }
        
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 120px; }
        
        /* ƒê·ªäNH DANH TR∆Ø·ªúNG */
        body::before {
            content: "üìç Tr∆∞·ªùng TH&THCS Ph∆∞·ªõc An"; display: block; font-size: 0.75rem; font-weight: bold;
            color: var(--p); padding: 5px 10px; background: rgba(255, 255, 255, 0.9);
            border-radius: 0 0 10px 0; position: fixed; top: 0; left: 0; z-index: 100;
        }

        /* M√ÄN H√åNH KH√ìA */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; color: white; }
        .pin-input { width: 150px; padding: 15px; border-radius: 12px; border: none; font-size: 1.8rem; text-align: center; letter-spacing: 5px; margin: 20px 0; font-weight: bold; color: var(--p); }

        #main-content { display: none; max-width: 1200px; margin: 0 auto; }

        .header { background: white; color: var(--p); padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-bottom: 4px solid var(--p); }

        .container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }

        /* B·∫¢NG X·∫æP H·∫†NG */
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); flex: 1; min-width: 320px; }
        table { width: 100%; border-collapse: collapse; }
        th { font-size: 0.7rem; color: #888; text-transform: uppercase; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        td { padding: 12px 5px; text-align: center; border-bottom: 1px solid #f9f9f9; font-weight: bold; }

        /* BI·ªÇU T∆Ø·ª¢NG H·∫†NG */
        .rank { width: 30px; height: 30px; line-height: 30px; display: inline-block; border-radius: 50%; background: #eee; font-size: 0.8rem; }
        .rank-1 { background: var(--gold); color: #000; font-size: 1.1rem; }
        .rank-2 { background: var(--silver); color: #000; }
        .rank-3 { background: var(--bronze); color: #fff; }

        /* L·ªöP ƒêANG CH·ªåN */
        .lop-row { cursor: pointer; transition: 0.2s; }
        .dang-chon { background: #e3f2fd !important; outline: 2px solid var(--p); border-radius: 10px; }

        /* PANEL CH·∫§M ƒêI·ªÇM */
        .panel-section { flex: 1.5; min-width: 320px; display: none; }
        .scroll-form { max-height: 500px; overflow-y: auto; padding: 10px; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .group-title { background: #f0f4f8; color: var(--p); padding: 8px; font-weight: bold; margin-top: 15px; font-size: 0.8rem; border-left: 4px solid var(--p); border-radius: 4px; }
        .loi-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f1f1f1; }
        .loi-item span { flex: 1; font-size: 0.85rem; }
        .loi-item b { width: 40px; color: var(--a); font-size: 0.8rem; text-align: right; margin-right: 10px; }
        .loi-item b.plus { color: var(--s); }
        input[type=number] { width: 50px; padding: 8px; border-radius: 8px; border: 1px solid #ccc; text-align: center; font-weight: bold; }

        /* N√öT B·∫§M */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn-apply { background: var(--p); color: white; font-size: 1rem; }
        .btn-reset { background: #fff; color: var(--a); border: 2px solid var(--a); margin-top: 20px; font-size: 0.8rem; }

        /* NH·∫¨T K√ù */
        .log-box { width: 100%; margin-top: 20px; background: #fff; padding: 15px; border-radius: 20px; }
        .log-list { max-height: 150px; overflow-y: auto; font-size: 0.75rem; color: #555; border-left: 2px solid #ddd; padding-left: 10px; }

        /* TRANG TR√ç CU·ªêI TRANG */
        .decor-fixed { position: fixed; bottom: 0; left: 0; right: 0; height: 70px; pointer-events: none; display: flex; align-items: flex-end; justify-content: space-between; padding: 0 30px; z-index: 1; }
        .footer-text { text-align: center; padding: 20px; font-size: 0.7rem; color: #999; position: relative; z-index: 2; }
    </style>
</head>
<body>

<div id="login-screen">
    <div style="font-size: 4rem;">üè´</div>
    <h2 style="margin: 10px 0;">PH∆Ø·ªöC AN ADMIN</h2>
    <input type="password" id="pin-input" class="pin-input" placeholder="PIN" maxlength="4" oninput="checkPin()">
    <p style="opacity: 0.7; font-size: 0.8rem;">Vui l√≤ng nh·∫≠p m√£ PIN ƒë·ªÉ ti·∫øp t·ª•c</p>
</div>

<div id="main-content">
    <div class="header">
        <h1 style="margin:0;">S·ªî TAY SAO ƒê·ªé</h1>
        <div style="color: #666; font-size: 0.8rem; margin-top: 5px;">H·ªá th·ªëng qu·∫£n l√Ω thi ƒëua t·∫≠p th·ªÉ</div>
    </div>

    <div class="container">
        <div class="card">
            <h3 style="margin-top:0;">üèÜ B·∫£ng X·∫øp H·∫°ng</h3>
            <table>
                <thead><tr><th>H·∫°ng</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody id="body-bang">
                    <script>
                        const lops = ['6A','6B','6C', '7A','7B','7C', '8A','8B','8C', '9A','9B'];
                        lops.forEach(l => {
                            document.write(`<tr class="lop-row" data-lop="${l}" onclick="chonLop(this)"><td class="rank-cell"></td><td>${l}</td><td class="tong">100</td></tr>`);
                        });
                    </script>
                </tbody>
            </table>
            <button class="btn btn-reset" onclick="resetTuan()">üîÑ RESET ƒêI·ªÇM TU·∫¶N M·ªöI</button>
        </div>

        <div id="panel" class="panel-section">
            <div class="scroll-form">
                <h3 id="tenlop" style="text-align:center; color: var(--p);">Ch·ªçn l·ªõp...</h3>
                
                <div class="group-title">1. T√ÅC PHONG & ƒê·∫†O ƒê·ª®C (-5ƒë)</div>
                <div class="loi-item"><span>KhƒÉn qu√†ng/Huy hi·ªáu</span><b>-5</b><input type="number" id="l1" data-n="KhƒÉn qu√†ng" data-d="-5"></div>
                <div class="loi-item"><span>T√°c phong/√Åo kho√°c</span><b>-5</b><input type="number" id="l2" data-n="T√°c phong" data-d="-5"></div>
                <div class="loi-item"><span>Xe kh√¥ng ngay h√†ng</span><b>-5</b><input type="number" id="l3" data-n="ƒê·ªÉ xe" data-d="-5"></div>
                
                <div class="group-title">2. CHUY√äN C·∫¶N & TR·∫¨T T·ª∞</div>
                <div class="loi-item"><span>ƒêi tr·ªÖ</span><b>-2</b><input type="number" id="l4" data-n="ƒêi tr·ªÖ" data-d="-2"></div>
                <div class="loi-item"><span>V·∫Øng kh√¥ng ph√©p</span><b>-5</b><input type="number" id="l5" data-n="V·∫Øng KP" data-d="-5"></div>
                <div class="loi-item"><span>N√≥i chuy·ªán/Tr·ªën ti·∫øt</span><b>-10</b><input type="number" id="l6" data-n="Tr·∫≠t t·ª±" data-d="-10"></div>
                <div class="loi-item"><span>Kh√¥ng SH ƒë·∫ßu gi·ªù/TD</span><b>-50</b><input type="number" id="l7" data-n="SH/TD" data-d="-50"></div>

                <div class="group-title">3. H·ªåC T·∫¨P (C·ªòNG/TR·ª™)</div>
                <div class="loi-item"><span>ƒêi·ªÉm k√©m (0-3)</span><b>-10</b><input type="number" id="l8" data-n="ƒêi·ªÉm k√©m" data-d="-10"></div>
                <div class="loi-item"><span>ƒêi·ªÉm 10</span><b class="plus">+10</b><input type="number" id="l9" data-n="ƒêi·ªÉm 10" data-d="10"></div>
                <div class="loi-item"><span>Ti·∫øt h·ªçc lo·∫°i A</span><b class="plus">+10</b><input type="number" id="l10" data-n="Ti·∫øt A" data-d="10"></div>
                <div class="loi-item"><span>Ti·∫øt h·ªçc lo·∫°i D</span><b>-10</b><input type="number" id="l11" data-n="Ti·∫øt D" data-d="-10"></div>

                <div class="group-title">4. V·ªÜ SINH & PHONG TR√ÄO</div>
                <div class="loi-item"><span>R√°c trong l·ªõp</span><b>-100</b><input type="number" id="l12" data-n="R√°c l·ªõp" data-d="-100"></div>
                <div class="loi-item"><span>Nh·∫•t phong tr√†o</span><b class="plus">+50</b><input type="number" id="l13" data-n="Nh·∫•t PT" data-d="50"></div>

                <button class="btn btn-apply" onclick="apDung()">C·∫¨P NH·∫¨T D·ªÆ LI·ªÜU</button>
            </div>
        </div>

        <div class="log-box">
            <h4>üìë Nh·∫≠t K√Ω G·∫ßn ƒê√¢y</h4>
            <div id="log-list" class="log-list">Ch∆∞a c√≥ ho·∫°t ƒë·ªông.</div>
        </div>
    </div>

    <div class="footer-text">
        Ph·∫ßn m·ªÅm ƒë∆∞·ª£c thi·∫øt k·∫ø b·ªüi <b>truongkycaonguyen</b><br>
        D√†nh ri√™ng cho TH&THCS Ph∆∞·ªõc An
    </div>
</div>

<div class="decor-fixed">
    <div style="font-size: 40px;">üå≥üå≤</div>
    <div style="font-size: 50px;">üè´</div>
    <div style="font-size: 40px;">üå≤üå≥</div>
</div>

<script>
const PIN = "1234";
let lopDangChon = null;
let dataLoi = {};
let logs = [];

function checkPin() {
    if (document.getElementById("pin-input").value === PIN) {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("main-content").style.display = "block";
        loadAll();
    }
}

function chonLop(row) {
    document.querySelectorAll(".lop-row").forEach(r => r.classList.remove("dang-chon"));
    row.classList.add("dang-chon");
    lopDangChon = row;
    document.getElementById("panel").style.display = "block";
    document.getElementById("tenlop").innerText = "ƒêang ch·∫•m: " + row.dataset.lop;
    
    const saved = dataLoi[row.dataset.lop] || {};
    document.querySelectorAll("#form-nhap input").forEach(i => i.value = saved[i.id] || 0);
    if(window.innerWidth < 600) document.getElementById("panel").scrollIntoView({behavior: "smooth"});
}

function apDung() {
    if(!lopDangChon) return;
    const tenLop = lopDangChon.dataset.lop;
    let tongBienDong = 0;
    let detail = [];
    let tempLoi = {};

    document.querySelectorAll("#form-nhap input").forEach(i => {
        let val = Number(i.value) || 0;
        let d = Number(i.dataset.d);
        tongBienDong += (val * d);
        tempLoi[i.id] = val;
        if(val > 0) detail.push(`${i.dataset.n} x${val}`);
    });

    dataLoi[tenLop] = tempLoi;
    let diemFinal = 100 + tongBienDong;
    lopDangChon.querySelector(".tong").innerText = (diemFinal < 0) ? 0 : diemFinal;
    lopDangChon.dataset.tong = (diemFinal < 0) ? 0 : diemFinal;

    const gio = new Date().toLocaleTimeString('vi-VN');
    logs.unshift(`[${gio}] L·ªõp ${tenLop}: ${detail.length ? detail.join(", ") : "C·∫≠p nh·∫≠t ƒëi·ªÉm"}`);
    if(logs.length > 20) logs.pop();

    renderLogs(); xepHang(); saveAll();
    alert("ƒê√£ l∆∞u ƒëi·ªÉm cho l·ªõp " + tenLop);
}

function xepHang() {
    let rows = Array.from(document.querySelectorAll(".lop-row"));
    rows.sort((a,b) => (Number(b.dataset.tong) || 0) - (Number(a.dataset.tong) || 0));
    let container = document.getElementById("body-bang");
    rows.forEach((r, i) => {
        let h = i + 1;
        let badge = h === 1 ? 'rank-1' : h === 2 ? 'rank-2' : h === 3 ? 'rank-3' : '';
        let icon = h === 1 ? 'ü•á' : h === 2 ? 'ü•à' : h === 3 ? 'ü•â' : h;
        r.querySelector(".rank-cell").innerHTML = `<span class="rank ${badge}">${icon}</span>`;
        container.appendChild(r);
    });
}

function renderLogs() {
    const container = document.getElementById("log-list");
    container.innerHTML = logs.map(l => `<div>‚Ä¢ ${l}</div>`).join("");
}

function saveAll() {
    localStorage.setItem('pa_v4_data', JSON.stringify({
        diem: Array.from(document.querySelectorAll(".lop-row")).map(r => ({l: r.dataset.lop, d: r.dataset.tong})),
        loi: dataLoi,
        nhatky: logs
    }));
}

function loadAll() {
    const raw = localStorage.getItem('pa_v4_data');
    if (!raw) { xepHang(); return; }
    const data = JSON.parse(raw);
    if (data.diem) data.diem.forEach(item => {
        let r = document.querySelector(`.lop-row[data-lop="${item.l}"]`);
        if(r) { r.querySelector(".tong").innerText = item.d; r.dataset.tong = item.d; }
    });
    dataLoi = data.loi || {};
    logs = data.nhatky || [];
    renderLogs(); xepHang();
}

function resetTuan() {
    if(confirm("X√°c nh·∫≠n x√≥a to√†n b·ªô d·ªØ li·ªáu ƒë·ªÉ b·∫Øt ƒë·∫ßu tu·∫ßn m·ªõi?")) {
        localStorage.clear();
        location.reload();
    }
}
</script>
</body>
</html>
