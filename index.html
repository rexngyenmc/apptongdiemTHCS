<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAO Äá» PHÆ¯á»šC AN 2026</title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #f0f2f5; --gold: #ffd700; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; padding-bottom: 50px; }
        
        /* MÃ€N HÃŒNH PIN */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; }
        .pin-input { width: 160px; padding: 15px; border-radius: 15px; border: none; font-size: 2rem; text-align: center; letter-spacing: 5px; font-weight: bold; margin: 20px 0; color: var(--p); outline: none; }

        /* HEADER */
        .header { background: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border-top: 5px solid var(--p); }
        .header h1 { font-size: 1.1rem; margin: 0; color: var(--p); text-transform: uppercase; }

        /* Báº¢NG Xáº¾P Háº NG THáº²NG XUá»NG */
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 15px; }
        .card h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        
        table { width: 100%; border-collapse: collapse; }
        th { font-size: 0.8rem; color: #666; padding: 10px 5px; }
        td { padding: 12px 5px; text-align: center; border-bottom: 1px solid #f0f0f0; font-weight: bold; }
        
        .rank { width: 30px; height: 30px; line-height: 30px; display: inline-block; border-radius: 50%; background: #f0f0f0; font-size: 0.8rem; }
        .rank-1 { background: var(--gold); color: #000; }
        .rank-2 { background: #e0e0e0; }
        .rank-3 { background: #cd7f32; color: white; }

        /* Báº¢NG TÃNH & NHáº¬P LIá»†U */
        .sticky-box { position: sticky; top: 0; z-index: 100; background: white; padding: 10px 0; }
        .input-group { margin-bottom: 10px; }
        .input-label { font-size: 0.8rem; font-weight: bold; color: var(--p); display: block; margin-bottom: 5px; }
        .name-input, .search-input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; outline: none; transition: 0.3s; }
        .name-input:focus, .search-input:focus { border-color: var(--p); }

        .scroll-form { max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 10px; padding: 5px; }
        .group-title { background: #f8f9fa; padding: 8px; font-weight: bold; font-size: 0.8rem; color: #555; border-left: 4px solid var(--p); margin: 10px 0 5px 0; }
        
        .loi-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #f9f9f9; cursor: pointer; }
        .loi-item:active { background: #f0f0f0; }
        .loi-info { flex: 1; font-size: 0.9rem; padding-left: 10px; }
        .score-val { font-weight: bold; width: 45px; text-align: right; }
        .minus { color: var(--a); } .plus { color: var(--s); }

        /* NÃšT Báº¤M */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1rem; }
        .btn-apply { background: var(--p); color: white; }
        .btn-zalo { background: #0068ff; color: white; }
        .btn-reset { background: #fff; color: var(--a); border: 1px solid var(--a); margin-top: 30px; font-size: 0.8rem; }

        /* Lá»ŠCH Sá»¬ */
        .history-list { max-height: 200px; overflow-y: auto; font-size: 0.8rem; }
        .log-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dotted #ccc; align-items: center; }
        .btn-del { color: red; border: none; background: none; font-weight: bold; padding: 5px 10px; cursor: pointer; }

        .lop-row { cursor: pointer; }
        .lop-row.active { background: #e3f2fd !important; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2 style="margin:0">ğŸ”‘ Máº¬T MÃƒ SAO Äá»</h2>
    <p>LiÃªn Äá»™i PhÆ°á»›c An</p>
    <input type="password" id="pin-input" class="pin-input" placeholder="****" maxlength="4" oninput="checkPin()">
</div>

<div id="main-content">
    <div class="header">
        <h1>LiÃªn Äá»™i TH & THCS PhÆ°á»›c An</h1>
        <p style="margin:5px 0 0; font-size:0.7rem; color:#888;">Há»‡ thá»‘ng cháº¥m Ä‘iá»ƒm thi Ä‘ua 2025 - 2026</p>
    </div>

    <div class="container">
        <div class="card">
            <h3>ğŸ† Báº£ng Xáº¿p Háº¡ng <small id="current-week" style="font-size:0.7rem; color:#888;"></small></h3>
            <table>
                <thead>
                    <tr><th>Háº¡ng</th><th>Lá»›p</th><th>Äiá»ƒm Tá»•ng</th></tr>
                </thead>
                <tbody id="bxh-body">
                    </tbody>
            </table>
            <button class="btn btn-zalo" onclick="xuatZalo()">ğŸ”µ Copy bÃ¡o cÃ¡o Zalo</button>
        </div>

        <div class="card" id="tinh-diem-area" style="display:none;">
            <h3 id="label-lop">Äang chá»n: ...</h3>
            
            <div class="input-group">
                <span class="input-label">ğŸ‘¤ TÃŠN Há»ŒC SINH (VD: AN, BINHx2, HOANGx3):</span>
                <input type="text" id="hs-names" class="name-input" placeholder="Nháº­p tÃªn vÃ  x láº§n vi pháº¡m...">
            </div>

            <div class="sticky-box">
                <span class="input-label">ğŸ” TÃŒM KIáº¾M Lá»–I NHANH:</span>
                <input type="text" id="search-loi" class="search-input" placeholder="GÃµ tÃªn lá»—i Ä‘á»ƒ tÃ¬m..." onkeyup="filterLoi()">
            </div>

            <div class="scroll-form" id="danh-sach-loi">
                <div class="group-title">1. TÃC PHONG - Äá»’NG PHá»¤C (-5Ä‘)</div>
                <div class="loi-item" onclick="toggleTick('l1')"><input type="checkbox" id="l1" data-d="-5" data-n="KhÄƒn quÃ ng/Huy hiá»‡u"> <div class="loi-info">KhÃ´ng KhÄƒn quÃ ng/Huy hiá»‡u</div> <div class="score-val minus">-5</div></div>
                <div class="loi-item" onclick="toggleTick('l2')"><input type="checkbox" id="l2" data-d="-5" data-n="TÃ¡c phong"> <div class="loi-info">KhÃ´ng bá» Ã¡o vÃ o quáº§n</div> <div class="score-val minus">-5</div></div>
                <div class="loi-item" onclick="toggleTick('l3')"><input type="checkbox" id="l3" data-d="-5" data-n="Ão khoÃ¡c"> <div class="loi-info">Máº·c Ã¡o khoÃ¡c sai quy Ä‘á»‹nh</div> <div class="score-val minus">-5</div></div>
                <div class="loi-item" onclick="toggleTick('l4')"><input type="checkbox" id="l4" data-d="-5" data-n="Äá»“ng phá»¥c"> <div class="loi-info">Äá»“ng phá»¥c ko Ä‘Ãºng quy Ä‘á»‹nh</div> <div class="score-val minus">-5</div></div>
                <div class="loi-item" onclick="toggleTick('l5')"><input type="checkbox" id="l5" data-d="-5" data-n="Äá»ƒ xe"> <div class="loi-info">Äá»ƒ xe ko ngay hÃ ng</div> <div class="score-val minus">-5</div></div>
                
                <div class="group-title">2. Äáº O Äá»¨C - Ká»¶ LUáº¬T</div>
                <div class="loi-item" onclick="toggleTick('l6')"><input type="checkbox" id="l6" data-d="-10" data-n="NÃ³i tá»¥c"> <div class="loi-info">NÃ³i tá»¥c, chá»­i thá»</div> <div class="score-val minus">-10</div></div>
                <div class="loi-item" onclick="toggleTick('l7')"><input type="checkbox" id="l7" data-d="-20" data-n="Bá» rÃ¡c"> <div class="loi-info">Bá» rÃ¡c sai nÆ¡i quy Ä‘á»‹nh</div> <div class="score-val minus">-20</div></div>
                <div class="loi-item" onclick="toggleTick('l8')"><input type="checkbox" id="l8" data-d="-10" data-n="Äiá»‡n thoáº¡i"> <div class="loi-info">Sá»­ dá»¥ng ÄT ko phÃ©p</div> <div class="score-val minus">-10</div></div>
                <div class="loi-item" onclick="toggleTick('l9')"><input type="checkbox" id="l9" data-d="-30" data-n="PhÃ¡ hoáº¡i TS"> <div class="loi-info">Cá»‘ Ã½ phÃ¡ hoáº¡i tÃ i sáº£n</div> <div class="score-val minus">-30</div></div>
                
                <div class="group-title">3. Há»ŒC Táº¬P (Cá»˜NG & TRá»ª)</div>
                <div class="loi-item" onclick="toggleTick('l10')"><input type="checkbox" id="l10" data-d="10" data-n="Äiá»ƒm 10"> <div class="loi-info">Äáº¡t Ä‘iá»ƒm 10</div> <div class="score-val plus">+10</div></div>
                <div class="loi-item" onclick="toggleTick('l11')"><input type="checkbox" id="l11" data-d="9" data-n="Äiá»ƒm 8,9"> <div class="loi-info">Äáº¡t Ä‘iá»ƒm 8, 9</div> <div class="score-val plus">+9</div></div>
                <div class="loi-item" onclick="toggleTick('l12')"><input type="checkbox" id="l12" data-d="-10" data-n="Ko thuá»™c bÃ i"> <div class="loi-info">KhÃ´ng thuá»™c/lÃ m bÃ i</div> <div class="score-val minus">-10</div></div>
                <div class="loi-item" onclick="toggleTick('l13')"><input type="checkbox" id="l13" data-d="10" data-n="Tiáº¿t A"> <div class="loi-info">Tiáº¿t há»c loáº¡i A</div> <div class="score-val plus">+10</div></div>
            </div>

            <button class="btn btn-apply" onclick="luuDiem()">âœ… XÃC NHáº¬N LÆ¯U ÄIá»‚M</button>

            <div class="group-title">ğŸ•’ Lá»ŠCH Sá»¬ CHáº¤M (Lá»šP ÄANG CHá»ŒN)</div>
            <div id="ls-vung" class="history-list">
                </div>
        </div>

        <button class="btn btn-reset" onclick="resetTuan()">ğŸ”„ RESET TUáº¦N Má»šI (XÃ“A Háº¾T)</button>
    </div>
</div>

<script>
    const PIN_CODE = "1234";
    const LOP_LIST = ["6A", "6B", "6C", "7A", "7B", "7C", "8A", "8B", "8C", "9A", "9B"];
    let dataLop = JSON.parse(localStorage.getItem('PhuocAn2026')) || {};

    // Khá»Ÿi táº¡o data náº¿u má»›i
    LOP_LIST.forEach(l => { if(!dataLop[l]) dataLop[l] = { score: 100, logs: [] }; });

    function checkPin() {
        if(document.getElementById('pin-input').value === PIN_CODE) {
            document.getElementById('login-screen').style.display = 'none';
            renderBXH();
        }
    }

    function renderBXH() {
        const sorted = [...LOP_LIST].sort((a, b) => dataLop[b].score - dataLop[a].score);
        const body = document.getElementById('bxh-body');
        body.innerHTML = '';
        sorted.forEach((l, index) => {
            const h = index + 1;
            const rankCls = h==1?'rank-1':h==2?'rank-2':h==3?'rank-3':'';
            body.innerHTML += `
                <tr class="lop-row" id="row-${l}" onclick="chonLop('${l}')">
                    <td><span class="rank ${rankCls}">${h}</span></td>
                    <td>Lá»›p ${l}</td>
                    <td style="color: ${dataLop[l].score < 100 ? 'red' : 'green'}">${dataLop[l].score}</td>
                </tr>
            `;
        });
        localStorage.setItem('PhuocAn2026', JSON.stringify(dataLop));
    }

    let lopDangChon = "";
    function chonLop(l) {
        lopDangChon = l;
        document.querySelectorAll('.lop-row').forEach(r => r.classList.remove('active'));
        document.getElementById(`row-${l}`).classList.add('active');
        document.getElementById('tinh-diem-area').style.display = 'block';
        document.getElementById('label-lop').innerText = `Äang cháº¥m: Lá»›p ${l}`;
        document.getElementById('tinh-diem-area').scrollIntoView({behavior: "smooth"});
        renderLS();
    }

    function toggleTick(id) {
        const ck = document.getElementById(id);
        ck.checked = !ck.checked;
    }

    function filterLoi() {
        const key = document.getElementById('search-loi').value.toLowerCase();
        const items = document.querySelectorAll('.loi-item');
        items.forEach(it => {
            const txt = it.innerText.toLowerCase();
            it.style.display = txt.includes(key) ? 'flex' : 'none';
        });
    }

    function luuDiem() {
        if(!lopDangChon) return alert("Chá»n lá»›p trÆ°á»›c!");
        const hsName = document.getElementById('hs-names').value.trim() || "Táº­p thá»ƒ";
        const checks = document.querySelectorAll('#danh-sach-loi input:checked');
        
        if(checks.length === 0) return alert("ChÆ°a tick lá»—i nÃ o!");

        // TÃ­nh toÃ¡n x há»‡ sá»‘
        let totalX = 0;
        let hsArray = hsName.split(/[,;]+/).filter(x => x.trim() !== "");
        let multiplier = 0;
        
        hsArray.forEach(h => {
            let m = h.toLowerCase().match(/x(\d+)/);
            multiplier += m ? parseInt(m[1]) : 1;
        });
        if(multiplier === 0) multiplier = 1;

        let totalChange = 0;
        let details = [];

        checks.forEach(c => {
            let d = parseInt(c.dataset.d);
            let n = c.dataset.n;
            totalChange += (d * multiplier);
            details.push(`${n} (x${multiplier})`);
            c.checked = false; // reset tick
        });

        dataLop[lopDangChon].score += totalChange;
        dataLop[lopDangChon].logs.unshift({
            id: Date.now(),
            txt: `${hsName}: ${details.join(", ")}`,
            sc: totalChange,
            time: new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'})
        });

        document.getElementById('hs-names').value = "";
        renderBXH();
        renderLS();
        alert("ÄÃ£ lÆ°u thÃ nh cÃ´ng!");
    }

    function renderLS() {
        const vung = document.getElementById('ls-vung');
        vung.innerHTML = '';
        dataLop[lopDangChon].logs.forEach(g => {
            vung.innerHTML += `
                <div class="log-item">
                    <span><b>[${g.time}]</b> ${g.txt} (<i class="${g.sc<0?'minus':'plus'}">${g.sc>0?'+':''}${g.sc}</i>)</span>
                    <button class="btn-del" onclick="xoaLS('${g.id}')">âœ•</button>
                </div>
            `;
        });
    }

    function xoaLS(id) {
        if(!confirm("XÃ³a dÃ²ng nÃ y vÃ  hoÃ n láº¡i Ä‘iá»ƒm?")) return;
        const index = dataLop[lopDangChon].logs.findIndex(x => x.id == id);
        if(index > -1) {
            dataLop[lopDangChon].score -= dataLop[lopDangChon].logs[index].sc;
            dataLop[lopDangChon].logs.splice(index, 1);
            renderBXH();
            renderLS();
        }
    }

    function xuatZalo() {
        let txt = "ğŸ“Š BÃO CÃO THI ÄUA PHÆ¯á»šC AN\n";
        const sorted = [...LOP_LIST].sort((a, b) => dataLop[b].score - dataLop[a].score);
        sorted.forEach((l, i) => {
            txt += `${i+1}. Lá»›p ${l}: ${dataLop[l].score}Ä‘\n`;
        });
        navigator.clipboard.writeText(txt).then(() => alert("ÄÃ£ copy bÃ¡o cÃ¡o! HÃ£y dÃ¡n vÃ o Zalo."));
    }

    function resetTuan() {
        if(confirm("Cáº¢NH BÃO: XÃ³a toÃ n bá»™ Ä‘iá»ƒm vÃ  lá»‹ch sá»­ Ä‘á»ƒ sang tuáº§n má»›i?")) {
            localStorage.clear();
            location.reload();
        }
    }
</script>

</body>
</html>
