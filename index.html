<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T·ªîNG ƒêI·ªÇM TH&THCS Ph∆∞·ªõc An</title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #f4f7f6; --gold: #ffd700; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 80px; color: #333; }
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; color: white; }
        .pin-input { width: 150px; padding: 15px; border-radius: 12px; border: none; font-size: 2rem; text-align: center; letter-spacing: 5px; font-weight: bold; margin: 20px 0; color: var(--p); }

        #main-content { display: none; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .header { background: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-bottom: 4px solid var(--p); }
        .school-title { font-size: 1.1rem; font-weight: bold; color: var(--p); text-transform: uppercase; }

        .container { display: flex; flex-wrap: wrap; gap: 15px; }

        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); flex: 1; min-width: 300px; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 10px 5px; text-align: center; border-bottom: 1px solid #f9f9f9; font-weight: bold; font-size: 0.9rem; }
        
        .rank { width: 28px; height: 28px; line-height: 28px; display: inline-block; border-radius: 50%; background: #eee; font-size: 0.75rem; }
        .rank-1 { background: var(--gold); }
        .rank-2 { background: #e0e0e0; }
        .rank-3 { background: #f0d0b0; }

        .lop-row { cursor: pointer; transition: 0.2s; }
        .dang-chon { background: #e3f2fd !important; outline: 2px solid var(--p); }

        .search-box { position: sticky; top: 0; background: white; z-index: 10; padding: 10px 0; margin-bottom: 10px; border-bottom: 1px solid #eee; }
        .search-input { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #e0e0e0; font-size: 0.9rem; box-sizing: border-box; outline: none; }

        /* INPUT T√äN HS */
        .name-box { margin-bottom: 15px; background: #fffde7; padding: 10px; border-radius: 10px; border: 1px solid #ffe082; }
        .name-input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-weight: bold; }

        .scroll-form { max-height: 450px; overflow-y: auto; padding-right: 5px; }
        .group-title { background: #f8f9fa; color: var(--p); padding: 8px; font-weight: bold; margin-top: 15px; font-size: 0.75rem; border-radius: 5px; border-left: 4px solid var(--p); }
        .loi-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f1f1f1; cursor: pointer; }
        .loi-item:active { background: #f9f9f9; }
        .loi-item span { flex: 1; font-size: 0.85rem; color: #333; }
        .score-tag { width: 50px; font-weight: bold; font-size: 0.8rem; text-align: right; margin-right: 10px; }
        .minus { color: var(--a); }
        .plus { color: var(--s); }
        
        input[type=checkbox] { width: 22px; height: 22px; cursor: pointer; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-apply { background: var(--p); color: white; }
        .btn-zalo { background: #0068ff; color: white; }
        .btn-reset { background: #fff; color: var(--a); border: 1px solid var(--a); margin-top: 20px; font-size: 0.7rem; }

        .history-box { margin-top: 15px; font-size: 0.75rem; background: #f9f9f9; padding: 10px; border-radius: 10px; min-height: 50px; }
        .log-entry { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dotted #ccc; }
        .btn-del { color: red; border: none; background: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2>üîë SAO ƒê·ªé PH∆Ø·ªöC AN</h2>
    <input type="password" id="pin-input" class="pin-input" placeholder="****" maxlength="4" oninput="checkPin()">
</div>

<div id="main-content">
    <div class="header">
        <div class="school-title">Tr∆∞·ªùng TH & THCS Ph∆∞·ªõc An</div>
        <p style="margin:5px 0 0 0; font-size:0.8rem; color:#555;">H·ªá Th·ªëng Ch·∫•m ƒêi·ªÉm C·ªông D·ªìn - 2026</p>
    </div>

    <div class="container">
        <div class="card">
            <h3>üèÜ B·∫£ng X·∫øp H·∫°ng (XH)</h3>
            <table>
                <thead><tr><th>XH</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody id="body-bang">
                    <script>
                        const dsLops = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
                        dsLops.forEach(l => {
                          document.write(`<tr class="lop-row" data-lop="${l}" onclick="chonLop(this)"><td class="rank-cell"></td><td>L·ªõp ${l}</td><td class="tong">100</td></tr>`);
                        });
                    </script>
                </tbody>
            </table>
            <button class="btn btn-zalo" onclick="xuatZalo()">üîµ Xu·∫•t B√°o C√°o Zalo</button>
            <button class="btn btn-reset" onclick="resetDuLieu()">üîÑ Reset Tu·∫ßn M·ªõi</button>
        </div>

        <div id="panel" class="card" style="display:none; flex: 1.6;">
            <div class="name-box">
                <label style="font-size: 0.8rem; font-weight: bold; color: #d8a000;">üë§ NH·∫¨P T√äN H·ªåC SINH VI PH·∫†M:</label>
                <input type="text" id="input-names" class="name-input" placeholder="V√≠ d·ª•: Ho√†ng, √Çn, H√†...">
            </div>

            <div class="search-box">
                <input type="text" class="search-input" id="search-error" placeholder="üîç T√¨m nhanh l·ªói..." onkeyup="filterLoi()">
            </div>
            
            <h3 id="tenlop" style="text-align:center; color: var(--p); margin: 5px 0;">Ch·ªçn L·ªõp</h3>
            
            <div class="scroll-form" id="form-nhap">
                                <div class="group-title">1. T√°c phong & ƒê·ªìng ph·ª•c (-5ƒë)</div>
                <div class="loi-item" onclick="toggle('m1')"><input type="checkbox" id="m1" data-d="-5" data-n="KhƒÉn qu√†ng"> <span class="loi-text">Kh√¥ng ƒëeo KhƒÉn qu√†ng/Huy hi·ªáu</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m2')"><input type="checkbox" id="m2" data-d="-5" data-n="T√°c phong"> <span class="loi-text">Kh√¥ng b·ªè √°o v√†o qu·∫ßn</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m3')"><input type="checkbox" id="m3" data-d="-5" data-n="√Åo kho√°c"> <span class="loi-text">M·∫∑c √°o kho√°c trong tr∆∞·ªùng sai quy ƒë·ªãnh</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m4')"><input type="checkbox" id="m4" data-d="-5" data-n="ƒê·ªìng ph·ª•c"> <span class="loi-text">ƒê·ªìng ph·ª•c kh√¥ng ƒë√∫ng quy ƒë·ªãnh</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m5')"><input type="checkbox" id="m5" data-d="-5" data-n="Ch√¢n tr·∫ßn"> <span class="loi-text">ƒêi ch√¢n tr·∫ßn ra s√¢n/WC</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m6')"><input type="checkbox" id="m6" data-d="-5" data-n="T√≥c d√†i"> <span class="loi-text">ƒê·ªÉ t√≥c d√†i (nam)</span> <span class="loi-score minus">-5</span></div>
                
                <div class="group-title">2. ƒê·∫°o ƒë·ª©c & K·ª∑ lu·∫≠t (-10ƒë/ -30ƒë)</div>
                <div class="loi-item" onclick="toggle('m7')"><input type="checkbox" id="m7" data-d="-10" data-n="Nhu·ªôm/Son"> <span class="loi-text">Nhu·ªôm t√≥c, t√¥ son, s∆°n m√≥ng</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m8')"><input type="checkbox" id="m8" data-d="-10" data-n="N√≥i t·ª•c"> <span class="loi-text">N√≥i t·ª•c, ch·ª≠i th·ªÅ</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m9')"><input type="checkbox" id="m9" data-d="-10" data-n="ƒê√°nh nhau"> <span class="loi-text">ƒê√°nh nhau</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m10')"><input type="checkbox" id="m10" data-d="-10" data-n="Ch·ªëng ƒë·ªëi"> <span class="loi-text">Ch·ªëng ƒë·ªëi Sao ƒë·ªè</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m11')"><input type="checkbox" id="m11" data-d="-30" data-n="H∆∞ h·ªèng TS"> <span class="loi-text">C·ªë √Ω l√†m h∆∞ h·ªèng t√†i s·∫£n tr∆∞·ªùng</span> <span class="loi-score minus">-30</span></div>
                <div class="loi-item" onclick="toggle('m12')"><input type="checkbox" id="m12" data-d="-30" data-n="Ph√° r√†o"> <span class="loi-text">Chui r√†o, ph√° h√†ng r√†o</span> <span class="loi-score minus">-30</span></div>
                <div class="loi-item" onclick="toggle('m13')"><input type="checkbox" id="m13" data-d="-20" data-n="B·ªè r√°c b·∫≠y"> <span class="loi-text">B·ªè r√°c kh√¥ng ƒë√∫ng n∆°i quy ƒë·ªãnh</span> <span class="loi-score minus">-20</span></div>

                <div class="group-title">3. Chuy√™n c·∫ßn & T·∫≠p th·ªÉ</div>
                <div class="loi-item" onclick="toggle('m14')"><input type="checkbox" id="m14" data-d="-2" data-n="ƒêi tr·ªÖ"> <span class="loi-text">ƒêi h·ªçc tr·ªÖ</span> <span class="loi-score minus">-2</span></div>
                <div class="loi-item" onclick="toggle('m15')"><input type="checkbox" id="m15" data-d="-5" data-n="V·∫Øng"> <span class="loi-text">V·∫Øng kh√¥ng ph√©p</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m16')"><input type="checkbox" id="m16" data-d="-10" data-n="Tr·ªën ti·∫øt"> <span class="loi-text">Tr·ªën ti·∫øt</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m17')"><input type="checkbox" id="m17" data-d="-5" data-n="N√≥i chuy·ªán"> <span class="loi-text">N√≥i chuy·ªán ri√™ng</span> <span class="loi-score minus">-5</span></div>
                <div class="loi-item" onclick="toggle('m18')"><input type="checkbox" id="m18" data-d="-50" data-n="B·ªè SH15" data-tp="L"> <span class="loi-text">L·ªõp kh√¥ng SH 15 ph√∫t</span> <span class="loi-score minus">-50</span></div>
                <div class="loi-item" onclick="toggle('m19')"><input type="checkbox" id="m19" data-d="-20" data-n="Qu·ªëc ca nh·ªè" data-tp="L"> <span class="loi-text">H√°t Qu·ªëc ca nh·ªè/Kh√¥ng h√°t</span> <span class="loi-score minus">-20</span></div>

                <div class="group-title">4. H·ªçc t·∫≠p (C·ªông & Tr·ª´)</div>
                <div class="loi-item" onclick="toggle('m20')"><input type="checkbox" id="m20" data-d="-10" data-n="K.Thu·ªôc b√†i"> <span class="loi-text">Kh√¥ng thu·ªôc b√†i/Kh√¥ng l√†m BT</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m21')"><input type="checkbox" id="m21" data-d="-10" data-n="ƒêi·ªÉm y·∫øu"> <span class="loi-text">ƒêi·ªÉm 0, 1, 2, 3</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m22')"><input type="checkbox" id="m22" data-d="5" data-n="ƒêi·ªÉm 7"> <span class="loi-text">ƒê·∫°t ƒëi·ªÉm 7</span> <span class="loi-score plus">+5</span></div>
                <div class="loi-item" onclick="toggle('m23')"><input type="checkbox" id="m23" data-d="9" data-n="ƒêi·ªÉm 8,9"> <span class="loi-text">ƒê·∫°t ƒëi·ªÉm 8, 9</span> <span class="loi-score plus">+9</span></div>
                <div class="loi-item" onclick="toggle('m24')"><input type="checkbox" id="m24" data-d="10" data-n="ƒêi·ªÉm 10"> <span class="loi-text">ƒê·∫°t ƒëi·ªÉm 10</span> <span class="loi-score plus">+10</span></div>
                <div class="loi-item" onclick="toggle('m25')"><input type="checkbox" id="m25" data-d="10" data-n="Ti·∫øt A" data-tp="L"> <span class="loi-text">1 ti·∫øt h·ªçc lo·∫°i A</span> <span class="loi-score plus">+10</span></div>
                <div class="loi-item" onclick="toggle('m26')"><input type="checkbox" id="m26" data-d="5" data-n="Vi·ªác t·ªët"> <span class="loi-text">Nh·∫∑t ƒë∆∞·ª£c c·ªßa r∆°i tr·∫£ l·∫°i</span> <span class="loi-score plus">+5</span></div>

                <div class="group-title">5. L·ªói Sao ƒë·ªè</div>
                <div class="loi-item" onclick="toggle('m27')"><input type="checkbox" id="m27" data-d="-10" data-n="Sƒê tr·ªÖ" data-tp="L"> <span class="loi-text">Sao ƒë·ªè tr·ª±c tr·ªÖ/Kh√¥ng ƒëeo bƒÉng</span> <span class="loi-score minus">-10</span></div>
                <div class="loi-item" onclick="toggle('m28')"><input type="checkbox" id="m28" data-d="-20" data-n="Sƒê b·ªè tr·ª±c" data-tp="L"> <span class="loi-text">Sao ƒë·ªè kh√¥ng ƒëi tr·ª±c</span> <span class="loi-score minus">-20</span></div>
            </div>

            <div class="log-box" id="nhat-ky"></div>
        </div>
    </div>
</div>
            <button class="btn btn-apply" onclick="apDung()">L∆ØU ƒêI·ªÇM ƒê·ª¢T N√ÄY</button>
            <div class="history-box" id="log-box">L·ªãch s·ª≠: Ch∆∞a c√≥ d·ªØ li·ªáu.</div>
        </div>
    </div>
</div>

<script>
const PIN = "1234";	
let db = JSON.parse(localStorage.getItem('pa_final_2026')) || {};
let curLop = "";

function checkPin() {
    if (document.getElementById("pin-input").value === PIN) {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("main-content").style.display = "block";
        updateHienThi();
    }
}

function toggle(id) {
    const ck = document.getElementById(id);
    ck.checked = !ck.checked;
}

function filterLoi() {
    let input = document.getElementById('search-error').value.toLowerCase();
    let items = document.getElementsByClassName('loi-item');
    for (let i = 0; i < items.length; i++) {
        items[i].style.display = items[i].innerText.toLowerCase().includes(input) ? "flex" : "none";
    }
}

function chonLop(row) {
    document.querySelectorAll(".lop-row").forEach(r => r.classList.remove("dang-chon"));
    row.classList.add("dang-chon");
    curLop = row.dataset.lop;
    document.getElementById("panel").style.display = "block";
    document.getElementById("tenlop").innerText = "ƒêang ch·∫•m L·ªõp " + curLop;
    renderLog();
}

function apDung() {
    if(!curLop) return;
    const nameStr = document.getElementById("input-names").value.trim();
    const dsTen = nameStr.split(/[,.;]+/).filter(x => x.trim().length > 0);
    const checks = Array.from(document.querySelectorAll("#form-nhap input[type='checkbox']:checked"));

    if(checks.length === 0) return alert("B·∫°n ch∆∞a ch·ªçn l·ªói!");
    const coLoiCaNhan = checks.some(c => !c.dataset.type);
    if(coLoiCaNhan && dsTen.length === 0) return alert("Vui l√≤ng nh·∫≠p t√™n h·ªçc sinh!");

    if(!db[curLop]) db[curLop] = { total: 100, logs: [] };

    let hieuSoDotNay = 0;
    let noiDung = [];

    checks.forEach(c => {
        let diemGoc = Number(c.dataset.d);
        let soLuong = c.dataset.type === "L" ? 1 : dsTen.length;
        let tongDiemLoi = diemGoc * soLuong;
        
        hieuSoDotNay += tongDiemLoi;
        noiDung.push(`${c.dataset.n}(${soLuong})`);
    });

    db[curLop].total += hieuSoDotNay;
    const gio = new Date().toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'});
    
    db[curLop].logs.unshift({
        id: Date.now(),
        time: gio,
        text: `${nameStr || 'C·∫£ l·ªõp'} - ${noiDung.join(", ")}`,
        score: hieuSoDotNay
    });

    // Reset Form
    document.getElementById("input-names").value = "";
    checks.forEach(c => c.checked = false);
    
    saveData();
    updateHienThi();
    alert("ƒê√£ c·ªông d·ªìn th√†nh c√¥ng!");
}

function updateHienThi() {
    let rows = Array.from(document.querySelectorAll(".lop-row"));
    rows.forEach(r => {
        let l = r.dataset.lop;
        let score = db[l] ? db[l].total : 100;
        r.querySelector(".tong").innerText = score;
        r.dataset.tong = score;
    });

    // X·∫øp h·∫°ng
    rows.sort((a,b) => (Number(b.dataset.tong) || 0) - (Number(a.dataset.tong) || 0));
    let container = document.getElementById("body-bang");
    rows.forEach((r, i) => {
        let h = i + 1;
        let icon = h === 1 ? 'ü•á' : h === 2 ? 'ü•à' : h === 3 ? 'ü•â' : h;
        r.querySelector(".rank-cell").innerHTML = `<span class="rank ${h<=3?'rank-'+h:''}">${icon}</span>`;
        container.appendChild(r);
    });
    renderLog();
}

function renderLog() {
    const box = document.getElementById("log-box");
    if(!curLop || !db[curLop] || db[curLop].logs.length === 0) {
        box.innerHTML = "Nh·∫≠t k√Ω: Ch∆∞a c√≥ d·ªØ li·ªáu.";
        return;
    }
    box.innerHTML = "<b>L·ªãch s·ª≠ ch·∫•m:</b><br>" + db[curLop].logs.map(n => `
        <div class="log-entry">
            <span>[${n.time}] ${n.text} (${n.score > 0 ? '+' : ''}${n.score})</span>
            <button class="btn-del" onclick="xoaLog(${n.id})">‚úï</button>
        </div>
    `).join("");
}

function xoaLog(id) {
    if(!confirm("X√≥a l·ªói n√†y v√† tr·∫£ l·∫°i ƒëi·ªÉm?")) return;
    db[curLop].logs = db[curLop].logs.filter(n => {
        if(n.id === id) {
            db[curLop].total -= n.score;
            return false;
        }
        return true;
    });
    saveData();
    updateHienThi();
}

function xuatZalo() {
    let msg = "üìä B√ÅO C√ÅO THI ƒêUA PH∆Ø·ªöC AN\n";
    let sorted = Array.from(document.querySelectorAll(".lop-row"));
    sorted.forEach((r, i) => {
        msg += `${i+1}. L·ªõp ${r.dataset.lop}: ${r.querySelector(".tong").innerText}ƒë\n`;
    });
    navigator.clipboard.writeText(msg + "\n---\nSao ƒë·ªè Ph∆∞·ªõc An 2026").then(() => alert("ƒê√£ copy b√°o c√°o!"));
}

function resetDuLieu() {
    if(confirm("X√≥a to√†n b·ªô ƒëi·ªÉm v√† l·ªãch s·ª≠ tu·∫ßn n√†y?")) {
        localStorage.removeItem('pa_final_2026');
        location.reload();
    }
}

function saveData() {
    localStorage.setItem('pa_final_2026', JSON.stringify(db));
}
</script>
</body>
</html>
