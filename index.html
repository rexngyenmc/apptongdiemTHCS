

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WEB SAO ƒê·ªé PH∆Ø·ªöC AN</title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #f8f9fa; --gold: #ffd700; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; }
        .pin-input { width: 160px; padding: 15px; border-radius: 15px; border: none; font-size: 2rem; text-align: center; letter-spacing: 5px; font-weight: bold; margin: 20px 0; color: var(--p); outline: none; }
        .header { background: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-top: 5px solid var(--p); }
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f1f1f1; font-size: 0.7rem; padding: 8px; border: 1px solid #ddd; }
        td { padding: 10px 5px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 0.8rem; }
        .rank { width: 25px; height: 25px; line-height: 25px; display: inline-block; border-radius: 50%; background: #eee; font-size: 0.7rem; }
        .rank-1 { background: var(--gold); }
        .input-group { margin-bottom: 15px; }
        .input-label { font-size: 0.8rem; font-weight: bold; color: var(--p); display: block; margin-bottom: 5px; }
        .input-box { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; outline: none; }
        .scroll-form { max-height: 400px; overflow-y: auto; border: 1px solid #eee; border-radius: 10px; background: #fff; margin-bottom: 10px; }
        .group-title { background: #e9ecef; padding: 8px; font-weight: bold; font-size: 0.75rem; border-left: 4px solid var(--p); position: sticky; top: 0; z-index: 10; }
        .loi-item { display: flex; flex-direction: column; padding: 12px; border-bottom: 1px solid #eee; }
        .loi-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; cursor: pointer; }
        .name-for-loi { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 0.85rem; outline: none; display: none; }
        .loi-item.active { background: #f0f7ff; }
        .loi-item.active .name-for-loi { display: block; }
        .score-tag { font-weight: bold; font-size: 0.85rem; min-width: 40px; text-align: right; }
        .minus { color: var(--a); } .plus { color: var(--s); }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1rem; }
        .btn-apply { background: var(--p); color: white; }
        .btn-zalo { background: #0068ff; color: white; }
        .btn-copy { background: #28a745; color: white; margin-bottom: 10px; }
        .btn-reset { background: #fff; color: var(--a); border: 1px solid var(--a); margin-top: 20px; font-size: 0.7rem; }
        .btn-del { color: red; border: none; background: none; font-weight: bold; cursor: pointer; }
        .active-lop { background: #e3f2fd !important; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2 style="margin:0">üîë M·∫¨T M√É SAO ƒê·ªé</h2>
    <input type="password" id="pin-input" class="pin-input" placeholder="****" maxlength="4" oninput="checkPin()">
</div>

<div id="main-content">
    <div class="header">
        <h1 style="font-size: 1rem; margin:0; color:var(--p)">LI√äN ƒê·ªòI TH & THCS PH∆Ø·ªöC AN</h1>
    </div>

    <div class="container">
        <div class="card">
            <h3 style="margin-top:0; font-size:0.9rem">üèÜ B·∫¢NG X·∫æP H·∫†NG</h3>
            <table>
                <thead><tr><th>H·∫°ng</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody id="bxh-body"></tbody>
            </table>
            <button class="btn btn-zalo" onclick="xuatZalo()">üîµ Copy b√°o c√°o Zalo</button>
        </div>

        <div class="card" id="input-area" style="display:none;">
            <h3 id="current-lop-label" style="color:var(--p); text-align:center; margin-top:0"></h3>
            
            <div class="input-group">
                <span class="input-label">üîç T√åM KI·∫æM L·ªñI:</span>
                <input type="text" id="search-loi" class="input-box" placeholder="T√¨m t√™n l·ªói..." onkeyup="filterLoi()">
            </div>

            <p style="font-size: 0.7rem; color: #666; margin-bottom: 5px;">* Tick ch·ªçn l·ªói r·ªìi nh·∫≠p t√™n (VD: Nguy√™n x2) tr·ª±c ti·∫øp b√™n d∆∞·ªõi l·ªói ƒë√≥.</p>
            <div class="scroll-form" id="error-list">
                </div>

            <button class="btn btn-apply" onclick="luuDuLieu()">üíæ L∆ØU D·ªÆ LI·ªÜU CH·∫§M</button>

            <h3 style="font-size:0.8rem; margin-top:30px;">üìú L·ªäCH S·ª¨ L·ªöP ƒêANG CH·ªåNG</h3>
            <button class="btn btn-copy" onclick="copyTableLS()">üìã Copy b·∫£ng (D√°n Excel/Zalo)</button>
            <div style="overflow-x: auto;">
                <table id="table-to-copy">
                    <thead>
                        <tr>
                            <th>Vi·ªác l√†m</th>
                            <th>Bi·ªÉu</th>
                            <th>C√° nh√¢n</th>
                            <th>L·∫ßn</th>
                            <th>T·ªïng</th>
                            <th>X√≥a</th>
                        </tr>
                    </thead>
                    <tbody id="ls-body"></tbody>
                </table>
            </div>
        </div>

        <button class="btn btn-reset" onclick="resetTuan()">üîÑ RESET TU·∫¶N M·ªöI</button>
    </div>
</div>

<script>
    const PIN = "1234";
    const LOP_LIST = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
    
    // D·ªØ li·ªáu l·ªói t·ª´ file Word 
    const ERROR_DATA = [
        { g: "T√ÅC PHONG - ƒê·ªíNG PH·ª§C", i: [
            { n: "Kh√¥ng ƒëeo KhƒÉn qu√†ng/Huy hi·ªáu", d: -5 },
            { n: "Kh√¥ng b·ªè √°o v√†o qu·∫ßn", d: -5 },
            { n: "M·∫∑c √°o kho√°c trong tr∆∞·ªùng", d: -5 },
            { n: "ƒê·ªìng ph·ª•c sai quy ƒë·ªãnh", d: -5 },
            { n: "ƒêi ch√¢n tr·∫ßn ra s√¢n/WC", d: -5 },
            { n: "ƒê·ªÉ xe kh√¥ng ngay h√†ng", d: -5 },
            { n: "Kh√¥ng ƒë·ªôi n√≥n b·∫£o hi·ªÉm", d: -5 },
            { n: "ƒê·ªÉ t√≥c d√†i (Nam)", d: -5 }
        ]},
        { g: "K·ª∂ LU·∫¨T & ƒê·∫†O ƒê·ª®C", i: [
            { n: "Nhu·ªôm t√≥c/Son ph·∫•n/M√≥ng", d: -10 },
            { n: "N√≥i t·ª•c, ch·ª≠i th·ªÅ", d: -10 },
            { n: "ƒê√°nh nhau", d: -10 },
            { n: "Ch·ªëng ƒë·ªëi Sao ƒë·ªè", d: -10 },
            { n: "B·ªè r√°c sai quy ƒë·ªãnh", d: -20 },
            { n: "Chui r√†o, ph√° h√†ng r√†o", d: -30 },
            { n: "Vi·∫øt v·∫Ω b·∫≠y t∆∞·ªùng/b√†n", d: -10 },
            { n: "Ra c·ªïng kh√¥ng ph√©p", d: -5 }
        ]},
        { g: "H·ªåC T·∫¨P & TI·∫æT H·ªåC", i: [
            { n: "ƒêi·ªÉm 10", d: 10 },
            { n: "ƒêi·ªÉm 8, 9", d: 9 },
            { n: "ƒêi·ªÉm 7", d: 5 },
            { n: "ƒêi·ªÉm 4", d: -5 },
            { n: "ƒêi·ªÉm 0,1,2,3", d: -10 },
            { n: "Ti·∫øt h·ªçc lo·∫°i A", d: 10 },
            { n: "Ti·∫øt h·ªçc lo·∫°i B", d: 5 },
            { n: "Ti·∫øt h·ªçc lo·∫°i C", d: -5 },
            { n: "Ti·∫øt h·ªçc lo·∫°i D", d: -10 },
            { n: "Kh√¥ng thu·ªôc b√†i/L√†m BT", d: -10 },
            { n: "Tr·∫£ l·∫°i c·ªßa r∆°i", d: 5 }
        ]}
    ];

    let db = JSON.parse(localStorage.getItem('PHUOC_AN_DB')) || {};
    let curLop = "";

    function init() {
        LOP_LIST.forEach(l => { if(!db[l]) db[l] = { total: 100, logs: [] }; });
        const listEl = document.getElementById('error-list');
        ERROR_DATA.forEach(group => {
            listEl.innerHTML += `<div class="group-title">${group.g}</div>`;
            group.i.forEach((item, idx) => {
                const id = `err-${Math.random().toString(36).substr(2, 5)}`;
                listEl.innerHTML += `
                    <div class="loi-item" id="item-${id}">
                        <div class="loi-info" onclick="toggleSelection('${id}')">
                            <input type="checkbox" id="${id}" data-n="${item.n}" data-d="${item.d}">
                            <span style="flex:1; margin-left:10px; font-size:0.85rem">${item.n}</span>
                            <span class="score-tag ${item.d < 0 ? 'minus' : 'plus'}">${item.d > 0 ? '+' : ''}${item.d}</span>
                        </div>
                        <input type="text" class="name-for-loi" id="name-${id}" placeholder="Nh·∫≠p t√™n HS (VD: Linh, An x2)...">
                    </div>`;
            });
        });
    }

    function checkPin() {
        if(document.getElementById('pin-input').value === PIN) {
            document.getElementById('login-screen').style.display = 'none';
            renderBXH();
        }
    }

    function toggleSelection(id) {
        const cb = document.getElementById(id);
        const item = document.getElementById(`item-${id}`);
        cb.checked = !cb.checked;
        if(cb.checked) {
            item.classList.add('active');
            document.getElementById(`name-${id}`).focus();
        } else {
            item.classList.remove('active');
        }
    }

    function filterLoi() {
        let key = document.getElementById('search-loi').value.toLowerCase();
        document.querySelectorAll('.loi-item').forEach(it => {
            it.style.display = it.innerText.toLowerCase().includes(key) ? 'flex' : 'none';
        });
    }

    function luuDuLieu() {
        const selected = document.querySelectorAll('#error-list input[type="checkbox"]:checked');
        if(selected.length === 0) return alert("B·∫°n ch∆∞a ch·ªçn l·ªói n√†o!");

        selected.forEach(cb => {
            const id = cb.id;
            const rawName = document.getElementById(`name-${id}`).value.trim() || "T·∫≠p th·ªÉ";
            const diemGoc = parseInt(cb.dataset.d);
            
            // X·ª≠ l√Ω "x2", "x3" th√¥ng minh
            let soLan = 1;
            const match = rawName.toLowerCase().match(/x\s*(\d+)/);
            if(match) soLan = parseInt(match[1]);

            const tongDiemRow = diemGoc * soLan;

            db[curLop].logs.unshift({
                id: Date.now() + Math.random(),
                vi·ªác: cb.dataset.n,
                bi·ªÉu: (diemGoc > 0 ? "+" : "") + diemGoc,
                t√™n: rawName,
                l·∫ßn: soLan,
                t·ªïng: (tongDiemRow > 0 ? "+" : "") + tongDiemRow
            });
            db[curLop].total += tongDiemRow;

            // Reset d√≤ng ƒë√≥
            cb.checked = false;
            document.getElementById(`name-${id}`).value = "";
            document.getElementById(`item-${id}`).classList.remove('active');
        });

        renderBXH(); renderLS();
        alert("ƒê√£ l∆∞u th√†nh c√¥ng!");
    }

    function renderBXH() {
        const sorted = [...LOP_LIST].sort((a,b) => db[b].total - db[a].total);
        const body = document.getElementById('bxh-body');
        body.innerHTML = '';
        sorted.forEach((l, i) => {
            body.innerHTML += `<tr class="lop-row" id="row-${l}" onclick="chonLop('${l}')">
                <td><span class="rank ${i<3?'rank-1':''}">${i+1}</span></td>
                <td>L·ªõp ${l}</td>
                <td style="color:${db[l].total<100?'red':'green'}">${db[l].total}</td>
            </tr>`;
        });
        localStorage.setItem('PHUOC_AN_DB', JSON.stringify(db));
    }

    function chonLop(l) {
        curLop = l;
        document.querySelectorAll('.lop-row').forEach(r => r.classList.remove('active-lop'));
        document.getElementById(`row-${l}`).classList.add('active-lop');
        document.getElementById('input-area').style.display = 'block';
        document.getElementById('current-lop-label').innerText = `ƒêANG CH·∫§M: L·ªöP ${l}`;
        renderLS();
        window.scrollTo({top: document.getElementById('input-area').offsetTop, behavior: 'smooth'});
    }

    function renderLS() {
        const body = document.getElementById('ls-body');
        body.innerHTML = '';
        db[curLop].logs.forEach(log => {
            body.innerHTML += `<tr>
                <td style="text-align:left">${log.vi·ªác}</td>
                <td>${log.bi·ªÉu}</td>
                <td>${log.t√™n}</td>
                <td>${log.l·∫ßn}</td>
                <td class="${parseInt(log.t·ªïng)<0?'minus':'plus'}">${log.t·ªïng}</td>
                <td><button class="btn-del" onclick="xoaLog('${log.id}')">‚úï</button></td>
            </tr>`;
        });
    }

    function copyTableLS() {
        const table = document.getElementById("table-to-copy");
        if (table.rows.length <= 1) return alert("Kh√¥ng c√≥ d·ªØ li·ªáu!");
        
        const tempDiv = document.createElement("div");
        const tableClone = table.cloneNode(true);
        for (let row of tableClone.rows) { row.deleteCell(-1); }
        
        tableClone.style.borderCollapse = "collapse";
        tableClone.querySelectorAll("th, td").forEach(cell => {
            cell.style.border = "1px solid black";
            cell.style.padding = "5px";
            cell.style.textAlign = "center";
        });

        tempDiv.appendChild(tableClone);
        document.body.appendChild(tempDiv);
        const range = document.createRange();
        range.selectNode(tempDiv);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand('copy');
        document.body.removeChild(tempDiv);
        alert("ƒê√£ copy b·∫£ng!");
    }

    function xuatZalo() {
        let txt = "üìä B√ÅO C√ÅO THI ƒêUA PH∆Ø·ªöC AN\n";
        [...LOP_LIST].sort((a,b) => db[b].total - db[a].total).forEach((l, i) => {
            txt += `${i+1}. L·ªõp ${l}: ${db[l].total}ƒë\n`;
        });
        navigator.clipboard.writeText(txt).then(() => alert("ƒê√£ copy b√°o c√°o!"));
    }

    function xoaLog(id) {
        if(!confirm("X√≥a d√≤ng n√†y?")) return;
        const index = db[curLop].logs.findIndex(x => x.id == id);
        db[curLop].total -= parseInt(db[curLop].logs[index].t·ªïng);
        db[curLop].logs.splice(index, 1);
        renderBXH(); renderLS();
    }

    function resetTuan() { if(confirm("X√≥a h·∫øt d·ªØ li·ªáu tu·∫ßn c≈©?")) { localStorage.clear(); location.reload(); } }

    init();
</script>
</body>
</html>
