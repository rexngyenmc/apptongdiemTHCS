<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TH & THCS PHƯỚC AN - SAO ĐỎ</title>

<style>
:root{
--bg:#0f172a;
--card:#1e293b;
--blue:#3b82f6;
--red:#ef4444;
--green:#22c55e;
}
*{box-sizing:border-box}
body{
margin:0;
font-family:Segoe UI,sans-serif;
background:var(--bg);
color:white;
}
#login{
position:fixed;
inset:0;
background:linear-gradient(135deg,#1e3a8a,#2563eb);
display:flex;
justify-content:center;
align-items:center;
flex-direction:column;
z-index:10;
}
#login input{
padding:15px;
font-size:22px;
border-radius:10px;
border:none;
text-align:center;
}
#app{display:none;padding:15px;}
.topbar{
display:flex;
justify-content:space-between;
align-items:center;
flex-wrap:wrap;
margin-bottom:15px;
}
.menu button{
margin-right:10px;
padding:10px 15px;
border:none;
border-radius:8px;
background:var(--blue);
color:white;
cursor:pointer;
}
.card{
background:var(--card);
padding:15px;
border-radius:15px;
margin-bottom:20px;
animation:fade 0.3s ease;
}
@keyframes fade{
from{opacity:0;transform:translateY(10px)}
to{opacity:1;transform:translateY(0)}
}
table{
width:100%;
border-collapse:collapse;
font-size:14px;
}
th,td{
border:1px solid #334155;
padding:8px;
text-align:center;
}
input{
width:100%;
padding:6px;
border-radius:6px;
border:none;
}
.minus{color:var(--red)}
.plus{color:var(--green)}
.class-select{
margin-bottom:10px;
padding:8px;
border-radius:8px;
}
</style>
</head>
<body>

<div id="login">
<h2>SAO ĐỎ PHƯỚC AN</h2>
<input type="password" id="pin" placeholder="Nhập PIN">
</div>

<div id="app">
<div class="topbar">
<h2>TH & THCS PHƯỚC AN</h2>
<div class="menu">
<button onclick="showRank()">Bảng xếp hạng</button>
<button onclick="showScore()">Sổ tính điểm</button>
</div>
</div>

<div id="rankView" class="card"></div>
<div id="scoreView" class="card" style="display:none"></div>
</div>

<script>
const PIN="1234";

const LOPS=["6A","6B","6C","6D","7A","7B","7C","7D","8A","8B","8C","9A","9B"];

const LOIS=[
{ n:"Không đeo khăn quàng hoặc huy hiệu", d:-5 },
{ n:"Không bỏ áo vào quần", d:-5 },
{ n:"Đi trễ", d:-2 },
{ n:"Vắng không phép", d:-5 },
{ n:"Nói tục", d:-10 },
{ n:"Đánh nhau", d:-50 },
{ n:"Xả rác", d:-20 },
{ n:"Không trực nhật", d:-10 },
{ n:"Không thuộc bài", d:-10 },
{ n:"Điểm 7", d:5 },
{ n:"Điểm 8-9", d:7 },
{ n:"Điểm 10", d:10 },
{ n:"Tham gia phong trào", d:10 }
];

let DB = JSON.parse(localStorage.getItem("PHUOCAN_DB")) || {};

// Khởi tạo dữ liệu
LOPS.forEach(l=>{
if(!DB[l]){
DB[l]={
total:100,
weekHistory:[],
monthHistory:[],
yearHistory:[]
};
}
if(!DB[l].weekHistory) DB[l].weekHistory=[];
if(!DB[l].monthHistory) DB[l].monthHistory=[];
if(!DB[l].yearHistory) DB[l].yearHistory=[];
});

document.getElementById("pin").addEventListener("input",function(){
if(this.value===PIN){
login.style.display="none";
app.style.display="block";
renderRank();
renderScore();
}
});

function showRank(){
rankView.style.display="block";
scoreView.style.display="none";
}

function showScore(){
rankView.style.display="none";
scoreView.style.display="block";
}

function renderRank(){
let html="<h3>BẢNG XẾP HẠNG</h3><table><tr><th>Hạng</th><th>Lớp</th><th>Tổng điểm</th></tr>";
[...LOPS].sort((a,b)=>DB[b].total-DB[a].total)
.forEach((l,i)=>{
html+=`<tr>
<td>${i+1}</td>
<td>${l}</td>
<td class="${DB[l].total<100?'minus':'plus'}">${DB[l].total}</td>
</tr>`;
});
html+="</table>";
rankView.innerHTML=html;
localStorage.setItem("PHUOCAN_DB",JSON.stringify(DB));
}

function renderScore(){
let html=`<h3>SỔ TÍNH ĐIỂM</h3>
<select class="class-select" id="lopSelect">
${LOPS.map(l=>`<option value="${l}">${l}</option>`).join("")}
</select>
<table>
<tr>
<th>Nội dung</th>
<th>Biểu điểm</th>
<th>Số lần</th>
<th>Điểm</th>
</tr>`;

LOIS.forEach((loi,i)=>{
html+=`
<tr>
<td>${loi.n}</td>
<td class="${loi.d<0?'minus':'plus'}">${loi.d>0?'+':''}${loi.d}</td>
<td><input type="number" value="0" min="0" id="sl${i}" oninput="calc()"></td>
<td id="diem${i}">0</td>
</tr>`;
});

html+=`<tr>
<td colspan="3"><b>Tổng phiên</b></td>
<td id="tongPhien">0</td>
</tr>
</table>
<button onclick="save()">Lưu cuối tuần</button>`;

scoreView.innerHTML=html;
}

function calc(){
let tong=0;
LOIS.forEach((loi,i)=>{
let sl=parseInt(document.getElementById("sl"+i).value)||0;
let diem=sl*loi.d;
document.getElementById("diem"+i).innerText=diem>0?`+${diem}`:diem;
tong+=diem;
});
document.getElementById("tongPhien").innerText=tong>0?`+${tong}`:tong;
}

function save(){
let lop=document.getElementById("lopSelect").value;
let tong=parseInt(document.getElementById("tongPhien").innerText)||0;

// Cộng vào bảng xếp hạng
DB[lop].total+=tong;

// Lưu tuần
DB[lop].weekHistory.push(tong);

// Đủ 4 tuần -> tạo tháng
if(DB[lop].weekHistory.length % 4===0){
let last4=DB[lop].weekHistory.slice(-4);
let tongThang=last4.reduce((a,b)=>a+b,0);
DB[lop].monthHistory.push(tongThang);
}

// Đủ 12 tháng -> tạo năm
if(DB[lop].monthHistory.length % 12===0 && DB[lop].monthHistory.length!==0){
let last12=DB[lop].monthHistory.slice(-12);
let tongNam=last12.reduce((a,b)=>a+b,0);
DB[lop].yearHistory.push(tongNam);
}

localStorage.setItem("PHUOCAN_DB",JSON.stringify(DB));

renderRank();
alert("Đã lưu tuần cho lớp "+lop);
}
</script>

</body>
</html>
