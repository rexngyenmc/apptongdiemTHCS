<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAO ƒê·ªé PH∆Ø·ªöC AN</title>
    <style>
        :root { --p:#2563eb; --s:#16a34a; --a:#dc2626; --bg:#f1f5f9; }
        * { box-sizing: border-box; }
        body { margin: 0; padding: 10px; font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); }

        /* M√ÄN H√åNH LOGIN */
        #login { 
            position: fixed; inset: 0; background: linear-gradient(135deg, #1e40af, #3b82f6);
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            color: white; z-index: 100; 
        }
        #login h2 { margin-bottom: 20px; letter-spacing: 2px; }
        #pin { width: 180px; padding: 15px; font-size: 2rem; border: none; border-radius: 15px; text-align: center; outline: none; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }

        /* CARD V√Ä LAYOUT */
        .card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h3 { margin-top: 0; color: #1e40af; border-left: 4px solid var(--p); padding-left: 10px; font-size: 1.1rem; }

        /* B·∫¢NG CH·∫§M ƒêI·ªÇM 5 C·ªòT */
        .table-wrapper { overflow-x: auto; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; background: white; border: 1px solid #333; }
        th, td { border: 1px solid #333; padding: 8px 4px; text-align: center; }
        th { background: #f2f2f2; color: #333; font-weight: bold; }
        
        input.name { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.8rem; }
        input.qty { width: 45px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
        
        /* HI·ªÇN TH·ªä ƒêI·ªÇM */
        .minus { color: var(--a); font-weight: bold; }
        .plus { color: var(--s); font-weight: bold; }
        .total-row { background: #fefce8; font-weight: bold; }

        /* N√öT B·∫§M */
        button { 
            width: 100%; padding: 15px; border: none; border-radius: 12px; 
            background: linear-gradient(135deg, #2563eb, #1d4ed8); 
            color: white; font-weight: bold; margin-top: 15px; cursor: pointer;
            box-shadow: 0 4px 10px rgba(37, 99, 235, 0.3);
        }
        button:active { transform: scale(0.98); }
    </style>
</head>
<body>

<div id="login">
    <div style="font-size: 4rem; margin-bottom: 10px;">üõ°Ô∏è</div>
    <h2>M·∫¨T M√É SAO ƒê·ªé</h2>
    <input id="pin-input" type="password" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
</div>

<div id="app" style="display:none">
    <div class="card">
        <h3>üèÜ B·∫¢NG X·∫æP H·∫†NG TU·∫¶N</h3>
        <table>
            <thead><tr><th width="20%">H·∫°ng</th><th>L·ªõp</th><th width="30%">T·ªïng ƒêi·ªÉm</th></tr></thead>
            <tbody id="bxh-body"></tbody>
        </table>
    </div>

    <div id="panel" class="card" style="display:none">
        <h3 id="lopTitle">CH·ªåN L·ªöP ƒê·ªÇ CH·∫§M</h3>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th width="35%">N·ªôi dung</th>
                        <th width="15%">Bi·ªÉu</th>
                        <th width="25%">C√° nh√¢n / T·∫≠p th·ªÉ</th>
                        <th width="10%">L·∫ßn</th>
                        <th width="15%">ƒêi·ªÉm</th>
                    </tr>
                </thead>
                <tbody id="input-body"></tbody>
                <tr class="total-row">
                    <td colspan="4" style="text-align: right; padding-right: 10px;">T·ªïng ƒëi·ªÉm thay ƒë·ªïi:</td>
                    <td id="tong-phien">0</td>
                </tr>
            </table>
        </div>
        <button onclick="saveSession()">üíæ X√ÅC NH·∫¨N L∆ØU D·ªÆ LI·ªÜU</button>
    </div>
</div>

<script>
const PIN = "1234";
const LOPS = ["6A1","6A2","6A3","7A1","7A2","8A1","8A2","9A1","9A2"];
const DANH_SACH_LOI = [
    {n: "Kh√¥ng ƒëeo KhƒÉn qu√†ng/Huy hi·ªáu", d: -5},
    {n: "Kh√¥ng b·ªè √°o v√†o qu·∫ßn", d: -5},
    {n: "N√≥i t·ª•c, ch·ª≠i th·ªÅ", d: -10},
    {n: "ƒêi tr·ªÖ", d: -2},
    {n: "V√¥ l·ªÖ v·ªõi gi√°o vi√™n", d: -50},
    {n: "X·∫£ r√°c b·ª´a b√£i", d: -20},
    {n: "ƒê√°nh nhau", d: -50},
    {n: "ƒêi·ªÉm s·ªë: 10", d: 10},
    {n: "Ph√°t bi·ªÉu x√¢y b√†i", d: 5}
];

let db = JSON.parse(localStorage.getItem("SAODO_PRO_DATA")) || {};
let lopHienTai = "";

// Ki·ªÉm tra m·∫≠t m√£
document.getElementById('pin-input').addEventListener('input', function() {
    if (this.value === PIN) {
        document.getElementById('login').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        initApp();
    } else if (this.value.length === 4) {
        alert("Sai m√£ PIN!");
        this.value = "";
    }
});

function initApp() {
    LOPS.forEach(l => { if(!db[l]) db[l] = { total: 100, history: [] }; });
    renderBXH();
    renderMainTable();
}

function renderBXH() {
    const body = document.getElementById('bxh-body');
    body.innerHTML = "";
    [...LOPS].sort((a,b) => db[b].total - db[a].total).forEach((l, i) => {
        body.innerHTML += `
            <tr onclick="chonLop('${l}')" style="cursor:pointer">
                <td>${i+1}</td>
                <td style="font-weight:bold; color:#2563eb">${l}</td>
                <td class="${db[l].total < 100 ? 'minus' : 'plus'}">${db[l].total}</td>
            </tr>`;
    });
    localStorage.setItem("SAODO_PRO_DATA", JSON.stringify(db));
}

function chonLop(l) {
    lopHienTai = l;
    document.getElementById('panel').style.display = 'block';
    document.getElementById('lopTitle').innerText = "‚úèÔ∏è CH·∫§M ƒêI·ªÇM: " + l;
    resetTableInputs();
    window.scrollTo({ top: document.getElementById('panel').offsetTop, behavior: 'smooth' });
}

function renderMainTable() {
    const body = document.getElementById('input-body');
    body.innerHTML = "";
    DANH_SACH_LOI.forEach((item, i) => {
        body.innerHTML += `
            <tr>
                <td style="text-align:left">${item.n}</td>
                <td class="${item.d < 0 ? 'minus' : 'plus'}">${item.d > 0 ? '+' : ''}${item.d}</td>
                <td><input class="name" id="name-${i}" placeholder="T√™n HS/L·ªõp..."></td>
                <td><input type="number" class="qty" id="qty-${i}" value="0" min="0" oninput="tinhToanTaiCho()"></td>
                <td id="score-${i}" class="diem-so">0</td>
            </tr>`;
    });
}

function tinhToanTaiCho() {
    let tong = 0;
    DANH_SACH_LOI.forEach((item, i) => {
        let sl = parseInt(document.getElementById(`qty-${i}`).value) || 0;
        let diem = item.d * sl;
        let cell = document.getElementById(`score-${i}`);
        cell.innerText = (diem > 0 ? '+' : '') + diem;
        cell.className = diem < 0 ? 'minus' : (diem > 0 ? 'plus' : '');
        tong += diem;
    });
    document.getElementById('tong-phien').innerText = (tong > 0 ? '+' : '') + tong;
    document.getElementById('tong-phien').className = tong < 0 ? 'minus' : (tong > 0 ? 'plus' : '');
}

function resetTableInputs() {
    DANH_SACH_LOI.forEach((_, i) => {
        document.getElementById(`name-${i}`).value = "";
        document.getElementById(`qty-${i}`).value = 0;
        document.getElementById(`score-${i}`).innerText = 0;
    });
    document.getElementById('tong-phien').innerText = 0;
}

function saveSession() {
    let coThayDoi = false;
    DANH_SACH_LOI.forEach((item, i) => {
        let ten = document.getElementById(`name-${i}`).value.trim();
        let sl = parseInt(document.getElementById(`qty-${i}`).value) || 0;
        if (sl > 0) {
            let diemTong = item.d * sl;
            db[lopHienTai].history.push({ nd: item.n, hs: ten, sl: sl, d: diemTong });
            db[lopHienTai].total += diemTong;
            coThayDoi = true;
        }
    });

    if (coThayDoi) {
        renderBXH();
        resetTableInputs();
        alert("ƒê√£ c·∫≠p nh·∫≠t ƒëi·ªÉm cho l·ªõp " + lopHienTai);
    } else {
        alert("Vui l√≤ng nh·∫≠p s·ªë l·∫ßn vi ph·∫°m/vi·ªác t·ªët!");
    }
}
</script>
</body>
</html>
