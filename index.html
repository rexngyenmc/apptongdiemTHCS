<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªÜ TH·ªêNG THI ƒêUA PH∆Ø·ªöC AN</title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #f4f7f9; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 0; }
        .navbar { background: var(--p); display: flex; justify-content: space-around; padding: 12px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .nav-item { color: white; text-decoration: none; font-weight: bold; font-size: 0.9rem; cursor: pointer; padding: 5px 15px; border-radius: 20px; }
        .nav-item.active { background: white; color: var(--p); }
        
        #login-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; }
        .pin-box { background: white; padding: 25px; border-radius: 15px; color: #333; text-align: center; width: 80%; max-width: 300px; }
        
        .container { padding: 15px; max-width: 600px; margin: auto; }
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        
        /* Grid danh s√°ch l·ªõp cho S·ªï ƒë·∫ßu b√†i */
        .class-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .class-btn { background: white; border: 2px solid var(--p); padding: 15px 5px; border-radius: 10px; font-weight: bold; color: var(--p); cursor: pointer; text-align: center; }
        
        .scroll-list { max-height: 400px; overflow-y: auto; border: 1px solid #ddd; border-radius: 10px; margin: 10px 0; }
        .group-title { background: #eee; padding: 8px; font-weight: bold; font-size: 0.75rem; border-left: 4px solid var(--p); position: sticky; top: 0; z-index: 10; }
        .loi-item { display: flex; flex-direction: column; padding: 12px; border-bottom: 1px solid #eee; }
        .loi-row { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .input-name { width: 100%; margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; display: none; box-sizing: border-box; }
        .loi-item.active { background: #f0f7ff; }
        .loi-item.active .input-name { display: block; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-save { background: var(--p); color: white; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px 4px; text-align: center; }
        .minus { color: var(--a); } .plus { color: var(--s); }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="pin-box">
        <h3 id="login-title">NH·∫¨P M√É PIN</h3>
        <input type="password" id="pin-input" style="width:100%; padding:10px; font-size:1.5rem; text-align:center; margin:15px 0;" maxlength="4">
        <button class="btn btn-save" onclick="verifyPin()">X√ÅC NH·∫¨N</button>
        <button class="btn" style="background:#eee" onclick="closeLogin()">H·ª¶Y</button>
    </div>
</div>

<nav class="navbar">
    <div class="nav-item active" id="m-saodo" onclick="switchTab('saodo')">S·ªî SAO ƒê·ªé</div>
    <div class="nav-item" id="m-daubai" onclick="switchTab('daubai')">S·ªî ƒê·∫¶U B√ÄI</div>
</nav>

<div class="container">
    <div id="tab-saodo">
        <div class="card">
            <h3 style="margin-top:0">üèÜ B·∫¢NG X·∫æP H·∫†NG TU·∫¶N</h3>
            <table id="bxh-table">
                <thead><tr><th>H·∫°ng</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody id="bxh-body"></tbody>
            </table>
            <button class="btn btn-save" onclick="openLogin('SAODO')" style="margin-top:15px">üîë ƒêƒÇNG NH·∫¨P SAO ƒê·ªé</button>
        </div>

        <div id="saodo-panel" class="card" style="display:none">
            <h3 id="sd-label" style="color:var(--p); text-align:center"></h3>
            <input type="text" placeholder="üîç T√¨m l·ªói..." onkeyup="filterLoi('sd')" class="input-name" style="display:block; margin-bottom:10px">
            <div id="list-sd" class="scroll-list"></div>
            <button class="btn btn-save" onclick="saveData('sd')">üíæ L∆ØU D·ªÆ LI·ªÜU CH·∫§M</button>
        </div>
    </div>

    <div id="tab-daubai" style="display:none">
        <div class="card" id="daubai-class-select">
            <h3 style="text-align:center">CH·ªåN L·ªöP C·ª¶A B·∫†N</h3>
            <div class="class-grid" id="class-grid-list"></div>
        </div>

        <div id="daubai-panel" class="card" style="display:none">
            <h3 id="db-label" style="color:var(--s); text-align:center"></h3>
            <div id="list-db" class="scroll-list"></div>
            <button class="btn btn-save" onclick="saveData('db')" style="background:var(--s)">üíæ GHI V√ÄO S·ªî ƒê·∫¶U B√ÄI</button>
            <button class="btn" onclick="exitClass()" style="background:#666; color:white">ƒê·ªîI L·ªöP KH√ÅC</button>
        </div>
    </div>

    <div class="card" id="history-card" style="display:none">
        <h3>üìú CHI TI·∫æT ƒê√É GHI</h3>
        <div style="overflow-x:auto">
            <table id="log-table">
                <thead><tr><th>N·ªôi dung</th><th>Bi·ªÉu</th><th>H·ªçc sinh</th><th>T·ªïng</th><th>X√≥a</th></tr></thead>
                <tbody id="log-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // 1. DANH S√ÅCH L·ªöP (ƒê·∫ßy ƒë·ªß)
    const LOP_LIST = ["6A", "6B", "6C", "7A", "7B", "7C", "8A", "8B", "8C", "9A", "9B"];
    const PIN_SAODO = "1234";
    const PIN_LOP = "2025"; // M√£ PIN m·∫∑c ƒë·ªãnh cho c√°c l·ªõp (b·∫°n c√≥ th·ªÉ ƒë·ªïi ri√™ng t·ª´ng l·ªõp)

    // 2. T·ªîNG H·ª¢P L·ªñI T·ª™ FILE PH∆Ø·ªöC AN
    const CRITERIA = [
        { g: "X·∫æP LO·∫†I TI·∫æT H·ªåC", i: [{n:"Ti·∫øt h·ªçc lo·∫°i A",d:10}, {n:"Ti·∫øt h·ªçc lo·∫°i B",d:5}, {n:"Ti·∫øt h·ªçc lo·∫°i C",d:-5}, {n:"Ti·∫øt h·ªçc lo·∫°i D",d:-10}] },
        { g: "T√ÅC PHONG - ƒê·ªíNG PH·ª§C", i: [
            {n:"Kh√¥ng khƒÉn qu√†ng/huy hi·ªáu",d:-5}, {n:"Kh√¥ng b·ªè √°o v√†o qu·∫ßn",d:-5},
            {n:"M·∫∑c √°o kho√°c trong tr∆∞·ªùng",d:-5}, {n:"ƒê·ªìng ph·ª•c sai quy ƒë·ªãnh",d:-5},
            {n:"ƒêi ch√¢n tr·∫ßn ra s√¢n/WC",d:-5}, {n:"Xe kh√¥ng ngay h√†ng",d:-5},
            {n:"Kh√¥ng m≈© b·∫£o hi·ªÉm",d:-5}, {n:"T√≥c d√†i (Nam)",d:-5}
        ]},
        { g: "K·ª∂ LU·∫¨T & ƒê·∫†O ƒê·ª®C", i: [
            {n:"Nhu·ªôm t√≥c/Son ph·∫•n/M√≥ng",d:-10}, {n:"N√≥i t·ª•c ch·ª≠i th·ªÅ",d:-10},
            {n:"ƒê√°nh nhau",d:-10}, {n:"Ch·ªëng ƒë·ªëi sao ƒë·ªè",d:-10},
            {n:"B·ªè r√°c sai quy ƒë·ªãnh",d:-20}, {n:"Chui r√†o/Ph√° h√†ng r√†o",d:-30},
            {n:"V·∫Ω b·∫≠y t∆∞·ªùng/b√†n",d:-10}, {n:"Ra c·ªïng kh√¥ng ph√©p",d:-5}
        ]},
        { g: "CHUY√äN C·∫¶N", i: [{n:"ƒêi tr·ªÖ",d:-2}, {n:"V·∫Øng kh√¥ng ph√©p",d:-5}, {n:"Tr·ªën ti·∫øt",d:-10}] },
        { g: "H·ªåC T·∫¨P", i: [
            {n:"ƒêi·ªÉm 10",d:10}, {n:"ƒêi·ªÉm 8,9",d:9}, {n:"ƒêi·ªÉm 7",d:5},
            {n:"ƒêi·ªÉm 4",d:-5}, {n:"ƒêi·ªÉm k√©m (0,1,2,3)",d:-10},
            {n:"Kh√¥ng thu·ªôc b√†i/BT",d:-10}, {n:"Tr·∫£ l·∫°i c·ªßa r∆°i",d:5}
        ]}
    ];

    let db = JSON.parse(localStorage.getItem('PHUOC_AN_V3')) || {};
    let currentTab = "saodo";
    let activeClass = "";
    let loginType = ""; // "SAODO" ho·∫∑c "LOP"

    // Kh·ªüi t·∫°o
    function init() {
        LOP_LIST.forEach(l => { if(!db[l]) db[l] = { score: 100, logs: [] }; });
        renderBXH();
        
        // T·∫°o n√∫t ch·ªçn l·ªõp cho S·ªï ƒë·∫ßu b√†i
        const grid = document.getElementById('class-grid-list');
        LOP_LIST.forEach(l => {
            grid.innerHTML += `<div class="class-btn" onclick="openLogin('LOP', '${l}')">${l}</div>`;
        });

        // X√¢y d·ª±ng danh s√°ch l·ªói
        buildCriteria('sd');
        buildCriteria('db');
    }

    function buildCriteria(type) {
        const container = document.getElementById('list-' + type);
        CRITERIA.forEach(group => {
            container.innerHTML += `<div class="group-title">${group.g}</div>`;
            group.i.forEach(item => {
                const id = type + Math.random().toString(36).substr(2, 5);
                container.innerHTML += `
                    <div class="loi-item" id="item-${id}">
                        <div class="loi-row" onclick="toggleItem('${id}')">
                            <span style="flex:1">${item.n}</span>
                            <span class="${item.d<0?'minus':'plus'}" style="width:40px; text-align:right"><b>${item.d>0?'+':''}${item.d}</b></span>
                            <input type="checkbox" id="cb-${id}" data-n="${item.n}" data-d="${item.d}" style="display:none">
                        </div>
                        <input type="text" class="input-name" id="name-${id}" placeholder="T√™n HS (VD: An x2)...">
                    </div>`;
            });
        });
    }

    // ƒêƒÉng nh·∫≠p
    function openLogin(type, lop = "") {
        loginType = type;
        activeClass = lop;
        document.getElementById('login-title').innerText = type === "SAODO" ? "M√É PIN SAO ƒê·ªé" : "M√É PIN L·ªöP " + lop;
        document.getElementById('login-screen').style.display = 'flex';
        document.getElementById('pin-input').focus();
    }

    function verifyPin() {
        const pin = document.getElementById('pin-input').value;
        if ((loginType === "SAODO" && pin === PIN_SAODO) || (loginType === "LOP" && pin === PIN_LOP)) {
            closeLogin();
            if (loginType === "SAODO") {
                alert("Ch√†o Sao ƒê·ªè! H√£y ch·ªçn l·ªõp ·ªü b·∫£ng x·∫øp h·∫°ng ƒë·ªÉ ch·∫•m.");
            } else {
                document.getElementById('daubai-class-select').style.display = 'none';
                document.getElementById('daubai-panel').style.display = 'block';
                document.getElementById('history-card').style.display = 'block';
                document.getElementById('db-label').innerText = "S·ªî ƒê·∫¶U B√ÄI " + activeClass;
                renderLogs();
            }
        } else {
            alert("M√£ PIN kh√¥ng ƒë√∫ng!");
        }
        document.getElementById('pin-input').value = "";
    }

    function switchTab(tab) {
        currentTab = tab;
        document.getElementById('m-saodo').classList.toggle('active', tab === 'saodo');
        document.getElementById('m-daubai').classList.toggle('active', tab === 'daubai');
        document.getElementById('tab-saodo').style.display = tab === 'saodo' ? 'block' : 'none';
        document.getElementById('tab-daubai').style.display = tab === 'daubai' ? 'block' : 'none';
        document.getElementById('history-card').style.display = 'none';
    }

    function selectClassSD(lop) {
        if (loginType !== "SAODO") return alert("Vui l√≤ng ƒêƒÉng nh·∫≠p Sao ƒë·ªè tr∆∞·ªõc!");
        activeClass = lop;
        document.querySelectorAll('.lop-row').forEach(r => r.style.background = "none");
        document.getElementById('row-'+lop).style.background = "#e3f2fd";
        document.getElementById('saodo-panel').style.display = 'block';
        document.getElementById('history-card').style.display = 'block';
        document.getElementById('sd-label').innerText = "CH·∫§M ƒêI·ªÇM L·ªöP " + lop;
        renderLogs();
    }

    function saveData(type) {
        const selected = document.querySelectorAll(`#list-${type} input[type="checkbox"]:checked`);
        if (selected.length === 0) return alert("Ch∆∞a ch·ªçn m·ª•c n√†o!");

        selected.forEach(cb => {
            const id = cb.id.replace('cb-', '');
            const name = document.getElementById('name-'+id).value || "T·∫≠p th·ªÉ";
            const points = parseInt(cb.dataset.d);
            let times = 1;
            const match = name.match(/x(\d+)/);
            if(match) times = parseInt(match[1]);

            db[activeClass].logs.unshift({
                id: Date.now() + Math.random(),
                content: cb.dataset.n + (type === 'sd' ? ' (Sao ƒë·ªè)' : ' (SƒêB)'),
                total: points * times,
                who: name
            });
            db[activeClass].score += (points * times);
            
            cb.checked = false;
            document.getElementById('item-'+id).classList.remove('active');
            document.getElementById('name-'+id).value = "";
        });

        localStorage.setItem('PHUOC_AN_V3', JSON.stringify(db));
        renderBXH(); renderLogs();
        alert("ƒê√£ l∆∞u!");
    }

    function renderBXH() {
        const sorted = [...LOP_LIST].sort((a,b) => db[b].score - db[a].score);
        const body = document.getElementById('bxh-body');
        body.innerHTML = "";
        sorted.forEach((l, i) => {
            body.innerHTML += `<tr class="lop-row" id="row-${l}" onclick="selectClassSD('${l}')">
                <td>${i+1}</td>
                <td><b>${l}</b></td>
                <td style="color:${db[l].score<100?'red':'green'}"><b>${db[l].score}</b></td>
            </tr>`;
        });
    }

    function renderLogs() {
        const body = document.getElementById('log-body');
        body.innerHTML = "";
        db[activeClass].logs.forEach(log => {
            body.innerHTML += `<tr>
                <td style="text-align:left">${log.content}</td>
                <td>${log.total > 0 ? '+' : ''}${log.total}</td>
                <td>${log.who}</td>
                <td>${log.total}</td>
                <td><button onclick="deleteLog(${log.id})" style="color:red; border:none; background:none">‚úï</button></td>
            </tr>`;
        });
    }

    function deleteLog(id) {
        if(!confirm("X√≥a d√≤ng n√†y?")) return;
        const idx = db[activeClass].logs.findIndex(l => l.id === id);
        db[activeClass].score -= db[activeClass].logs[idx].total;
        db[activeClass].logs.splice(idx, 1);
        localStorage.setItem('PHUOC_AN_V3', JSON.stringify(db));
        renderBXH(); renderLogs();
    }

    function toggleItem(id) {
        const cb = document.getElementById('cb-'+id);
        const item = document.getElementById('item-'+id);
        cb.checked = !cb.checked;
        item.classList.toggle('active', cb.checked);
        if(cb.checked) document.getElementById('name-'+id).focus();
    }

    function closeLogin() { document.getElementById('login-screen').style.display = 'none'; }
    function exitClass() { location.reload(); }
    function filterLoi(type) { /* Gi·ªëng c√°c b·∫£n tr∆∞·ªõc */ }

    init();
</script>
</body>
</html>
