<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ph∆∞·ªõc An 2026 - ƒê·ªìng B·ªô Sheets</title>
    <style>
        :root { --blue: #1a73e8; --green: #34a853; --orange: #fbbc05; --red: #ea4335; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; }
        .screen { display: none; padding: 15px; max-width: 800px; margin: auto; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
        .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .btn-main { width: 100%; padding: 20px; border: none; border-radius: 15px; color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        .inp-search { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 10px; box-sizing: border-box; }
        .scroll-list { max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 10px; }
        .user-item { padding: 12px; border-bottom: 1px solid #eee; text-align: left; cursor: pointer; }
        .user-item.selected { background: var(--blue); color: white; }
        .class-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
        .btn-cl { padding: 12px 2px; border: 1px solid #ddd; border-radius: 8px; background: white; font-weight: bold; cursor: pointer; }
        .btn-cl.active { background: var(--blue); color: white; }
        .item-row { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; cursor: pointer; align-items: center; }
        .detail-area { display: none; padding: 15px; background: #f9f9f9; flex-direction: column; gap: 10px; border-radius: 10px; margin-bottom: 10px; }
        .ls-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .ls-table th, .ls-table td { border: 1px solid #eee; padding: 8px; text-align: left; }
        #sync-status { position: fixed; top: 0; width: 100%; background: var(--orange); text-align: center; font-size: 12px; display: none; z-index: 100; padding: 5px; font-weight: bold; }
        #bxh-screen { background: #001f3f; color: white; min-height: 100vh; text-align: center; }
        .rank-row { display: flex; align-items: center; background: rgba(255,255,255,0.1); margin: 10px; padding: 15px; border-radius: 15px; }
        .rank-1 { background: linear-gradient(90deg, #ffd700, #ff8f00); color: #000; font-weight: bold; }
    </style>
</head>
<body>
<div id="sync-status">ƒêang x·ª≠ l√Ω d·ªØ li·ªáu...</div>
<div id="home-screen" class="screen" style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh;">
    <h1 style="color:var(--blue); margin-bottom: 5px;">PH∆Ø·ªöC AN 2026</h1>
    <p style="color: #666; margin-bottom: 30px;">H·ªçc k·ª≥ 2 - Tu·∫ßn 19/20</p>
    <button class="btn-main" style="background:var(--blue)" onclick="init('GV')">GI√ÅO VI√äN</button>
    <button class="btn-main" style="background:var(--green)" onclick="init('SD')">SAO ƒê·ªé</button>
    <button class="btn-main" style="background:var(--orange); color:#000" onclick="init('BXH')">B·∫¢NG V√ÄNG THI ƒêUA</button>
</div>

<div id="auth-screen" class="screen">
    <button onclick="goHome()" style="margin-bottom:10px;">‚Üê Quay l·∫°i</button>
    <div class="card">
        <h3 id="auth-title">X√°c th·ª±c</h3>
        <input type="password" id="pin-input" class="inp-search" placeholder="Nh·∫≠p m√£ PIN (1234 ho·∫∑c 9999)" style="display:none">
        <input type="text" id="user-search" class="inp-search" placeholder="T√¨m t√™n gi√°o vi√™n/sao ƒë·ªè..." onkeyup="filterUser()">
        <div id="user-list" class="scroll-list"></div>
        <button class="btn-main" style="background:var(--blue); margin-top:15px" onclick="verifyUser()">V√ÄO H·ªÜ TH·ªêNG</button>
    </div>
</div>

<div id="score-screen" class="screen">
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items: center;">
            <h3 id="info-lop" style="margin:0; color:var(--blue)">Ch·ªçn l·ªõp</h3>
            <button onclick="showScreen('auth-screen')" style="font-size: 12px;">ƒê·ªïi ng∆∞·ªùi tr·ª±c</button>
        </div>
        <div class="class-grid" id="class-btns"></div>
    </div>
    <div id="main-input" style="display:none">
        <div class="card">
            <h4 style="margin:0 0 10px 0;">TI√äU CH√ç CH·∫§M ƒêI·ªÇM</h4>
            <div id="criteria-list"></div>
        </div>
        <div class="card">
            <h4 style="margin:0 0 10px 0;">L·ªäCH S·ª¨ CH·ªú L∆ØU</h4>
            <table class="ls-table">
                <thead><tr><th>L·ªõp</th><th>L·ªói</th><th>HS/L·∫ßn</th><th>ƒêi·ªÉm</th><th>X√≥a</th></tr></thead>
                <tbody id="ls-body"></tbody>
            </table>
            <button id="btn-sync" class="btn-main" style="background:var(--green); margin-top:15px" onclick="syncToCloud()">G·ª¨I D·ªÆ LI·ªÜU & ƒê·ªíNG B·ªò TV</button>
        </div>
    </div>
</div>

<div id="bxh-screen" class="screen">
    <h1 style="color:var(--orange); padding-top:20px; text-shadow: 0 0 10px rgba(0,0,0,0.5);">üèÜ B·∫¢NG V√ÄNG THI ƒêUA</h1>
    <p id="bxh-date"></p>
    <div id="bxh-content"></div>
    <button class="btn-main" style="background:#333; width:200px; margin-top: 20px;" onclick="goHome()">QUAY L·∫†I</button>
</div>
<script>
// --- D√ÅN LINK APPS SCRIPT C·ª¶A B·∫†N V√ÄO ƒê√ÇY ---
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyYhBw6Z3RIuFjCvUJS14GdMl_NjfVAKnLYMNf5mpe8TL1WXwq0tRxFDHiG4eyutu9TDQ/exec";

const DANH_SACH_LOP = ["6A1","6A2","6A3","7A1","7A2","8A1","8A2","9A1","9A2"];
const DS_GV = ["C√¥ Hu·ªá", "Th·∫ßy S∆°n", "C√¥ Lan", "Th·∫ßy H√πng", "Th·∫ßy ƒê·ª©c"];
const DS_SD = ["An 9A1", "B√¨nh 8A2", "Chi 7A1", "D≈©ng 6A2", "H·∫°nh 9A2"];

// D·ªØ li·ªáu b√°m s√°t file Word TI√äU CH√ç THI ƒêUA THCS (1).docx
const DATA_SD = [
    {h: "T√°c phong", ds: [
        {n:"Kh√¥ng khƒÉn qu√†ng/Huy hi·ªáu", d:-5}, // 
        {n:"Kh√¥ng b·ªè √°o v√†o qu·∫ßn", d:-5}, // 
        {n:"M·∫∑c √°o kho√°c sai gi·ªù quy ƒë·ªãnh", d:-5}, // 
        {n:"Sai ƒë·ªìng ph·ª•c (qu·∫ßn/√°o/gi√†y/d√©p)", d:-5}, // 
        {n:"ƒêi ch√¢n tr·∫ßn ra s√¢n/nh√† v·ªá sinh", d:-5}, // 
        {n:"T√≥c d√†i (Nam)", d:-5}, // 
        {n:"Nhu·ªôm t√≥c/Trang ƒëi·ªÉm/S∆°n m√≥ng", d:-10} // 
    ]},
    {h: "N·ªÅ n·∫øp & K·ª∑ lu·∫≠t", ds: [
        {n:"ƒê·ªÉ xe sai quy ƒë·ªãnh", d:-5}, // 
        {n:"Kh√¥ng ƒë·ªôi m≈© b·∫£o hi·ªÉm", d:-5}, // 
        {n:"Ra c·ªïng kh√¥ng xin ph√©p", d:-5}, // 
        {n:"S·ª≠ d·ª•ng ƒêT kh√¥ng ƒë√∫ng n∆°i", d:-5}, // 
        {n:"N√≥i t·ª•c/Ch·ª≠i th·ªÅ/ƒê√°nh nhau", d:-10}, // 
        {n:"Ch·ªëng ƒë·ªëi sao ƒë·ªè", d:-10}, // 
        {n:"ƒêi tr·ªÖ", d:-2}, // 
        {n:"V·∫Øng kh√¥ng ph√©p", d:-5}, // 
        {n:"Tr·ªën ti·∫øt/N√≥i chuy·ªán ri√™ng", d:-10} // 
    ]},
    {h: "V·ªá sinh & T√†i s·∫£n", ds: [
        {n:"ƒÇn u·ªëng sai quy ƒë·ªãnh", d:-10}, // 
        {n:"B·ªè r√°c sai n∆°i (L·ªõp tr·ª´ 100ƒë)", d:-20}, // 
        {n:"V·∫Ω b·∫≠y t∆∞·ªùng/b√†n gh·∫ø", d:-10}, // 
        {n:"Ph√° ho·∫°i t√†i s·∫£n tr∆∞·ªùng", d:-30}, // 
        {n:"Chui r√†o/Ph√° h√†ng r√†o", d:-30} // 
    ]},
    {h: "Nghi·ªáp v·ª• Sao ƒë·ªè", ds: [
        {n:"Sƒê kh√¥ng bƒÉng/Tr·ª±c tr·ªÖ", d:-10}, // 
        {n:"Sƒê kh√¥ng ƒëi tr·ª±c", d:-20}, // 
        {n:"Sƒê kh√¥ng t·ªïng k·∫øt cu·ªëi tu·∫ßn", d:-50} // 
    ]}
];

const DATA_GV = [
    {h: "H·ªçc t·∫≠p", ds: [
        {n:"Ti·∫øt A", d:10}, {n:"Ti·∫øt B", d:5}, // 
        {n:"Ti·∫øt C", d:-5}, {n:"Ti·∫øt D", d:-10}, // 
        {n:"ƒêi·ªÉm 10", d:10}, {n:"ƒêi·ªÉm 8,9", d:9}, // 
        {n:"ƒêi·ªÉm 7", d:5}, {n:"ƒêi·ªÉm 4", d:-5}, // 
        {n:"ƒêi·ªÉm 0,1,2,3", d:-10}, // 
        {n:"Kh√¥ng thu·ªôc b√†i/L√†m b√†i t·∫≠p", d:-10}, // 
        {n:"M·∫•t/X√© b√†i ki·ªÉm tra", d:-20} // 
    ]},
    {h: "Phong tr√†o", ds: [
        {n:"H·∫°ng Nh·∫•t phong tr√†o", d:50}, // 
        {n:"H·∫°ng Nh√¨ phong tr√†o", d:40}, // 
        {n:"H·∫°ng Ba phong tr√†o", d:30}, // 
        {n:"Nh·∫∑t ƒë∆∞·ª£c c·ªßa r∆°i tr·∫£ l·∫°i", d:5} // 
    ]}
];

let role="", user="", currentLop="", lsTemp=[];

function init(r){
    role=r; if(r==='BXH') return renderBXH();
    showScreen('auth-screen');
    document.getElementById('pin-input').style.display=(r==='SD'?'block':'none');
    renderUserList();
}

function renderUserList(){
    let list = (role==='GV'?DS_GV:DS_SD).sort();
    let h=""; list.forEach(n => h+=`<div class="user-item" onclick="selU(this)">${n}</div>`);
    document.getElementById('user-list').innerHTML=h;
}

function filterUser(){
    let val = document.getElementById('user-search').value.toLowerCase();
    let items = document.querySelectorAll('.user-item');
    items.forEach(it => {
        it.style.display = it.innerText.toLowerCase().includes(val) ? 'block' : 'none';
    });
}

function selU(el){
    document.querySelectorAll('.user-item').forEach(i=>i.classList.remove('selected'));
    el.classList.add('selected'); user=el.innerText;
}

function verifyUser(){
    if(!user) return alert("Vui l√≤ng ch·ªçn t√™n!");
    if(role==='SD' && document.getElementById('pin-input').value!=='1234') return alert("Sai m√£ PIN!");
    showScreen('score-screen');
    let h=""; DANH_SACH_LOP.forEach(l => h+=`<button class="btn-cl" onclick="selLop('${l}',this)">${l}</button>`);
    document.getElementById('class-btns').innerHTML=h;
}

function selLop(l, b){
    currentLop=l; document.querySelectorAll('.btn-cl').forEach(i=>i.classList.remove('active'));
    b.classList.add('active'); document.getElementById('info-lop').innerText="L·ªõp: "+l;
    document.getElementById('main-input').style.display='block'; renderCriteria();
}

function renderCriteria(){
    let h="", data=(role==='GV'?DATA_GV:DATA_SD);
    data.forEach((g,gi)=>{
        h+=`<h4 style="margin:15px 0 5px; color:#666; border-bottom: 1px solid #eee;">${g.h}</h4>`;
        g.ds.forEach((item,ii)=>{
            let id=`row-${gi}-${ii}`;
            h+=`<div class="item-row" onclick="toggle('${id}')"><span>${item.n}</span><b style="color:${item.d>0?'green':'red'}">${item.d>0?'+'+item.d:item.d}</b></div>
                <div class="detail-area" id="${id}">
                    <input type="text" placeholder="T√™n HS/L√Ω do..." id="hs-${id}">
                    <input type="number" value="1" id="sl-${id}" placeholder="S·ªë l·∫ßn">
                    <button onclick="addLS('${item.n}',${item.d},'${id}')" style="background:var(--blue); color:#fff; border:none; padding:10px; border-radius:8px">X√°c nh·∫≠n th√™m</button>
                </div>`;
        });
    });
    document.getElementById('criteria-list').innerHTML=h;
}

function addLS(name, score, id){
    let hs=document.getElementById('hs-'+id).value || "C·∫£ l·ªõp", sl=document.getElementById('sl-'+id).value || 1;
    lsTemp.push({time: new Date().toLocaleString('vi-VN'), lop: currentLop, loi: name, info: hs, sl: sl, diem: score*sl, nguoi: user});
    renderLS(); toggle(id);
}

function renderLS(){
    let h=""; lsTemp.forEach((item, idx)=> h+=`<tr><td>${item.lop}</td><td>${item.loi}</td><td>${item.info}(x${item.sl})</td><td>${item.diem}</td><td onclick="lsTemp.splice(${idx},1);renderLS()" style="color:red; font-weight:bold;">X</td></tr>`);
    document.getElementById('ls-body').innerHTML=h;
}

async function syncToCloud(){
    if(lsTemp.length===0) return alert("Kh√¥ng c√≥ d·ªØ li·ªáu!");
    document.getElementById('sync-status').style.display='block';
    document.getElementById('sync-status').innerText="ƒêang g·ª≠i d·ªØ li·ªáu l√™n Google Sheets...";
    try {
        await fetch(SCRIPT_URL, {method: 'POST', body: JSON.stringify(lsTemp)});
        alert("ƒê·ªìng b·ªô th√†nh c√¥ng!"); lsTemp=[]; renderLS(); goHome();
    } catch(e) { alert("L·ªói m·∫°ng! H√£y ki·ªÉm tra k·∫øt n·ªëi."); }
    document.getElementById('sync-status').style.display='none';
}

async function renderBXH(){
    showScreen('bxh-screen');
    document.getElementById('bxh-date').innerText = "Ng√†y: " + new Date().toLocaleDateString('vi-VN');
    document.getElementById('bxh-content').innerHTML="<p>ƒêang t·∫£i b·∫£ng x·∫øp h·∫°ng t·ª´ Tivi...</p>";
    try {
        const res = await fetch(SCRIPT_URL); const data = await res.json();
        let bxh={}; DANH_SACH_LOP.forEach(l => bxh[l]=100);
        data.slice(1).forEach(r => { if(bxh[r[1]]!==undefined) bxh[r[1]]+=parseFloat(r[5]); });
        let sorted = Object.entries(bxh).sort((a,b)=>b[1]-a[1]);
        let h=""; sorted.forEach((item,idx)=> h+=`<div class="rank-row ${idx===0?'rank-1':''}"><span>${idx+1}. L·ªõp ${item[0]}</span><span style="margin-left:auto">${item[1]} ƒë</span></div>`);
        document.getElementById('bxh-content').innerHTML=h;
    } catch(e) { document.getElementById('bxh-content').innerHTML="L·ªói t·∫£i d·ªØ li·ªáu. H√£y d√°n ƒë√∫ng link SCRIPT_URL!"; }
}

function toggle(id){ let e=document.getElementById(id); e.style.display=(e.style.display==='flex'?'none':'flex'); }
function showScreen(id){ document.querySelectorAll('.screen').forEach(s=>s.style.display='none'); document.getElementById(id).style.display='block'; }
function goHome(){ location.reload(); }
</script>
</body>
</html>
