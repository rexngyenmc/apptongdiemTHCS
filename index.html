<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ph∆∞·ªõc An 2026 - BXH Chu·∫©n</title>
    <style>
        :root { --p: #1a73e8; --s: #34a853; --w: #fbbc05; --r: #ea4335; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; }
        .screen { display: none; padding: 15px; max-width: 900px; margin: auto; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
        
        /* BXH Tr√¨nh chi·∫øu */
        #bxh-screen { background: radial-gradient(circle, #001f3f, #000); min-height: 100vh; color: white; text-align: center; padding: 30px 10px; }
        .bxh-title { font-size: 3rem; color: var(--w); text-shadow: 0 0 20px rgba(255,215,0,0.5); margin-bottom: 10px; }
        .rank-table { width: 100%; max-width: 800px; margin: auto; border-spacing: 0 10px; border-collapse: separate; }
        .rank-item { background: rgba(255,255,255,0.1); font-size: 1.8rem; transition: 0.3s; }
        .rank-item td { padding: 20px; }
        .rank-item td:first-child { border-radius: 15px 0 0 15px; font-weight: 900; width: 80px; }
        .rank-item td:last-child { border-radius: 0 15px 15px 0; font-weight: 900; color: var(--w); }
        .top1 { background: linear-gradient(90deg, #ffd700, #ff8f00) !important; color: black !important; transform: scale(1.05); }
        .top1 td:last-child { color: black !important; }

        /* C√°c n√∫t v√† form c≈© */
        .btn-main { width: 100%; padding: 20px; border: none; border-radius: 15px; color: white; font-size: 1.2rem; font-weight: 800; cursor: pointer; margin-bottom: 10px; }
        .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; color: #333; }
        .class-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .btn-cl { padding: 12px 2px; border: 1px solid #ddd; border-radius: 8px; background: white; font-weight: bold; cursor: pointer; }
        .active { background: var(--p) !important; color: white !important; }
        .ls-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; color: #333; }
        .ls-table th, .ls-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>

<div id="home-screen" class="screen" style="display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh;">
    <h1 style="color:var(--p); font-size: 2.5rem;">PH∆Ø·ªöC AN 2026</h1>
    <button class="btn-main" style="background:var(--p)" onclick="init('GV')">GI√ÅO VI√äN</button>
    <button class="btn-main" style="background:var(--s)" onclick="init('SD')">SAO ƒê·ªé</button>
    <button class="btn-main" style="background:var(--w); color:#000" onclick="init('BXH')">B·∫¢NG V√ÄNG</button>
</div>

<div id="auth-screen" class="screen">
    <div class="card">
        <h3>X√ÅC TH·ª∞C NG∆Ø·ªúI D√ôNG</h3>
        <input type="password" id="pin-input" style="width:100%; padding:15px; margin-bottom:10px; border-radius:10px; border:1px solid #ccc; display:none" placeholder="Nh·∫≠p PIN...">
        <input type="text" id="search-user" style="width:100%; padding:15px; border-radius:10px; border:1px solid #ccc;" placeholder="T√¨m t√™n gi√°o vi√™n/sao ƒë·ªè...">
        <div id="user-list" style="max-height:200px; overflow-y:auto; margin:10px 0; border:1px solid #eee;"></div>
        <button class="btn-main" style="background:var(--p)" onclick="verify()">V√ÄO H·ªÜ TH·ªêNG</button>
        <button class="btn-main" style="background:#666" onclick="location.reload()">QUAY L·∫†I</button>
    </div>
</div>

<div id="score-screen" class="screen">
    <div class="card">
        <h3 id="info-header" style="margin:0; color:var(--p)"></h3>
        <div class="class-grid" id="class-btns" style="margin-top:10px"></div>
    </div>
    
    <div id="main-content" style="display:none">
        <div class="card">
            <h4>DANH M·ª§C L·ªñI (FILE PH∆Ø·ªöC AN)</h4>
            <div id="criteria-list"></div>
        </div>

        <div class="card">
            <h4>L·ªäCH S·ª¨ NH·∫¨P T·∫†M TH·ªúI</h4>
            <table class="ls-table">
                <thead><tr><th>L·ªõp</th><th>L·ªói</th><th>HS/L·∫ßn</th><th>ƒêi·ªÉm</th><th>X√≥a</th></tr></thead>
                <tbody id="ls-body"></tbody>
            </table>
            <button class="btn-main" style="background:var(--s); margin-top:15px" onclick="saveToDatabase()">L∆ØU & ƒê·ªíNG B·ªò L√äN TV</button>
        </div>
    </div>
</div>

<div id="bxh-screen" class="screen">
    <h1 class="bxh-title">üèÜ B·∫¢NG V√ÄNG THI ƒêUA</h1>
    <h2 id="bxh-date" style="color:#aaa; margin-bottom:30px"></h2>
    <table class="rank-table" id="rank-table-body">
        </table>
    <button class="btn-main" style="background:#444; width:200px; margin-top:50px" onclick="location.reload()">THO√ÅT</button>
</div>

<script>
const DS_GV = ["C√¥ Hu·ªá", "Th·∫ßy S∆°n", "C√¥ Lan", "Th·∫ßy H√πng", "Th·∫ßy ƒê·ª©c"];
const DS_SD = ["An 9A1", "B√¨nh 8A2", "Chi 7A1", "D≈©ng 6A2"];
const LOP = ["6A1","6A2","6A3","7A1","7A2","8A1","8A2","9A1","9A2"];

// D·ªØ li·ªáu l·ªói 100% Ph∆∞·ªõc An
const LOI_SD = [
    {h: "T√°c phong", ds: [{n:"Kh√¥ng khƒÉn qu√†ng", d:-5}, {n:"Kh√¥ng b·ªè √°o v√†o qu·∫ßn", d:-5}, {n:"Sai ƒë·ªìng ph·ª•c", d:-5}, {n:"ƒêi tr·ªÖ", d:-2}]},
    {h: "N·ªÅ n·∫øp", ds: [{n:"N√≥i t·ª•c", d:-10}, {n:"ƒÇn qu√† v·∫∑t", d:-10}, {n:"B·ªè r√°c sai n∆°i", d:-20}, {n:"Chui r√†o", d:-30}, {n:"ƒê√°nh nhau", d:-50}]}
];
const LOI_GV = [
    {h: "H·ªçc t·∫≠p", ds: [{n:"Ti·∫øt A", d:10}, {n:"Ti·∫øt B", d:5}, {n:"Ti·∫øt C", d:-5}, {n:"Ti·∫øt D", d:-10}, {n:"ƒêi·ªÉm 10", d:10}, {n:"ƒêi·ªÉm 0,1,2,3", d:-10}]}
];

let role="", user="", currentLop="", lsTemp=[], dbScore={};
// Kh·ªüi t·∫°o ƒëi·ªÉm m·∫∑c ƒë·ªãnh cho c√°c l·ªõp l√† 100
LOP.forEach(l => dbScore[l] = 100);

function init(r){
    role=r;
    if(r==='BXH') { showBXH(); return; }
    show('auth-screen');
    document.getElementById('pin-input').style.display = (r==='SD'?'block':'none');
    let h=""; (r==='GV'?DS_GV:DS_SD).forEach(n => h+=`<div style="padding:15px; border-bottom:1px solid #eee; cursor:pointer" onclick="selU(this)">${n}</div>`);
    document.getElementById('user-list').innerHTML=h;
}

function selU(el){
    document.querySelectorAll('#user-list div').forEach(i=>i.style.background='white');
    el.style.background='#e8f0fe'; user=el.innerText;
}

function verify(){
    if(!user && role!=='BXH') return alert("Ch·ªçn t√™n!");
    show('score-screen');
    document.getElementById('info-header').innerText = "Ng∆∞·ªùi ch·∫•m: " + user;
    let h=""; LOP.forEach(l => h+=`<button class="btn-cl" onclick="selLop('${l}',this)">${l}</button>`);
    document.getElementById('class-btns').innerHTML=h;
}

function selLop(l, b){
    currentLop=l; document.querySelectorAll('.btn-cl').forEach(i=>i.classList.remove('active'));
    b.classList.add('active'); document.getElementById('main-content').style.display='block';
    renderCriteria();
}

function renderCriteria(){
    let h="", data=(role==='GV'?LOI_GV:LOI_SD);
    data.forEach((g,gi)=>{
        h+=`<h4 style="margin:15px 0 5px">${g.h}</h4>`;
        g.ds.forEach((i,ii)=>{
            h+=`<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; background:#fff" onclick="addLoi('${i.n}', ${i.d})">
                <span>${i.n}</span> <b style="color:red">${i.d}</b>
            </div>`;
        });
    });
    document.getElementById('criteria-list').innerHTML=h;
}

function addLoi(name, score){
    let hs = prompt("T√™n HS vi ph·∫°m (ƒê·ªÉ tr·ªëng n·∫øu t√≠nh c·∫£ l·ªõp):") || "C·∫£ l·ªõp";
    lsTemp.push({lop: currentLop, loi: name, info: hs, diem: score});
    renderLS();
}

function renderLS(){
    let h=""; lsTemp.forEach((item, idx)=>{
        h+=`<tr><td>${item.lop}</td><td>${item.loi}</td><td>${item.info}</td><td>${item.diem}</td><td onclick="lsTemp.splice(${idx},1);renderLS()" style="color:red">X</td></tr>`;
    });
    document.getElementById('ls-body').innerHTML=h;
}

function saveToDatabase(){
    // C·ªông ƒëi·ªÉm v√†o b·ªô nh·ªõ (Trong th·ª±c t·∫ø s·∫Ω g·ª≠i l√™n Google Sheets)
    lsTemp.forEach(item => {
        dbScore[item.lop] += item.diem;
    });
    localStorage.setItem('PhuocAn_Scores', JSON.stringify(dbScore));
    alert("ƒê√£ ƒë·ªìng b·ªô l√™n TV th√†nh c√¥ng!");
    lsTemp = []; renderLS();
}

function showBXH(){
    show('bxh-screen');
    document.getElementById('bxh-date').innerText = "Ng√†y: " + new Date().toLocaleDateString();
    let saved = JSON.parse(localStorage.getItem('PhuocAn_Scores')) || dbScore;
    
    // Chuy·ªÉn object sang m·∫£ng ƒë·ªÉ s·∫Øp x·∫øp
    let sortable = [];
    for (var l in saved) { sortable.push([l, saved[l]]); }
    sortable.sort((a, b) => b[1] - a[1]);

    let h = "";
    sortable.forEach((item, idx) => {
        h += `<tr class="rank-item ${idx===0?'top1':''}">
            <td>${idx + 1}</td>
            <td style="text-align:left">L·ªõp ${item[0]}</td>
            <td>${item[1]} ƒë</td>
        </tr>`;
    });
    document.getElementById('rank-table-body').innerHTML = h;
}

function show(id){
    document.querySelectorAll('.screen').forEach(s=>s.style.display='none');
    document.getElementById(id).style.display='block';
}
</script>
</body>
</html>
