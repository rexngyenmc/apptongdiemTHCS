<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LI√äN ƒê·ªòI PH∆Ø·ªöC AN - 2026</title>
    <style>
        :root { --p: #6200ee; --s: #03dac6; --a: #b00020; --gold: #ffd700; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        
        /* ƒêƒÉng nh·∫≠p trang tr√≠ */
        #login-screen { position: fixed; inset: 0; background: linear-gradient(135deg, var(--p), #3700b3); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; text-align: center; }
        .logo { font-size: 3rem; margin-bottom: 10px; }
        .pin-input { width: 150px; padding: 15px; border-radius: 15px; border: 2px solid rgba(255,255,255,0.3); font-size: 1.5rem; text-align: center; background: rgba(255,255,255,0.1); color: white; outline: none; }

        /* Header chuy√™n nghi·ªáp */
        .header { background: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; border-bottom: 5px solid var(--p); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .header h2 { margin: 0; color: var(--p); font-size: 1.2rem; }
        .header p { margin: 5px 0 0 0; font-size: 0.8rem; font-weight: bold; color: #666; }

        /* B·∫£ng x·∫øp h·∫°ng (XH) */
        .grid-xh { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .lop-card { background: white; padding: 15px 5px; border-radius: 15px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; border: 2px solid transparent; position: relative; }
        .lop-card.active { border-color: var(--p); background: #f3e5f5; }
        .lop-card b { display: block; font-size: 1.1rem; }
        .lop-card span { font-size: 0.9rem; color: var(--p); font-weight: bold; }
        .rank-1::after { content: 'ü•á'; position: absolute; top: -5px; right: -5px; font-size: 1.2rem; }

        /* Form Ch·∫•m ƒêi·ªÉm */
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 4px 25px rgba(0,0,0,0.1); display: none; margin-bottom: 20px; }
        .name-input { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #eee; font-size: 1rem; box-sizing: border-box; margin-bottom: 15px; outline: none; font-weight: bold; }

        /* Danh s√°ch l·ªói theo bi·ªÉu ƒëi·ªÉm Ph∆∞·ªõc An */
        .scroll-loi { max-height: 400px; overflow-y: auto; border: 1px solid #f0f0f0; border-radius: 12px; padding: 5px; }
        .group-title { background: #fdf2f2; color: var(--a); padding: 8px; font-weight: bold; margin-top: 15px; font-size: 0.75rem; border-radius: 5px; border-left: 4px solid var(--a); }
        .group-plus { background: #f2fdf2; color: #2e7d32; border-left-color: #2e7d32; }
        .loi-item { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #fafafa; }
        .loi-item span { flex: 1; font-size: 0.85rem; padding: 0 10px; }
        .loi-score { font-weight: bold; width: 50px; text-align: right; }
        .minus { color: var(--a); } .plus { color: #2e7d32; }

        /* N√∫t ch·ª©c nƒÉng */
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .btn { padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-ls { background: #ff9800; color: white; }
        .btn-save { background: var(--p); color: white; }
        .btn-zalo { background: #0068ff; color: white; width: 100%; margin-top: 10px; }
        .btn-reset { background: #666; color: white; width: 100%; margin-top: 20px; font-size: 0.7rem; padding: 8px; }

        /* B√°o c√°o (LS) */
        #report-screen { display: none; position: fixed; inset: 0; background: white; z-index: 8000; padding: 15px; overflow-y: auto; }
        .report-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.75rem; }
        .report-table th, .report-table td { border: 1px solid #333; padding: 8px 4px; text-align: left; }
        .report-table th { background: #f2f2f2; text-align: center; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="logo">üáªüá≥</div>
    <h2 style="margin:0">LI√äN ƒê·ªòI PH∆Ø·ªöC AN</h2>
    <p style="font-size:0.8rem; opacity:0.8">H·ªá Th·ªëng Ch·∫•m ƒêi·ªÉm 2025-2026</p>
    <input type="password" id="pin" class="pin-input" placeholder="PIN" maxlength="4" oninput="checkPin(this.value)">
</div>

<div id="main-ui" style="display:none">
    <div class="header">
        <p>ƒê·ªòI TNTP H·ªí CH√ç MINH</p>
        <h2>LI√äN ƒê·ªòI TH & THCS PH∆Ø·ªöC AN</h2>
        <p style="color:var(--p)">B·∫¢NG X·∫æP H·∫†NG TU·∫¶N</p>
    </div>

    <div class="grid-xh" id="grid-xh"></div>

    <div class="card" id="form-cham">
        <h3 id="label-lop" style="margin-top:0; color:var(--p)">ƒêang ch·ªçn: --</h3>
        
        <label style="font-size:0.75rem; font-weight:bold; color:#666">H·ªåC SINH (VD: ANX2, B√åNH):</label>
        <input type="text" id="input-names" class="name-input" placeholder="T√™n k√®m x h·ªá s·ªë...">

        <div class="scroll-loi" id="ds-loi">
            <div class="group-title">1. T√ÅC PHONG & ƒê·ªíNG PH·ª§C (-5ƒë)</div>
            <div class="loi-item" onclick="toggle('m1')"><input type="checkbox" id="m1" data-d="-5" data-n="KhƒÉn qu√†ng/Huy hi·ªáu"> <span>Kh√¥ng KhƒÉn qu√†ng/Huy hi·ªáu</span> <b class="loi-score minus">-5</b></div>
            <div class="loi-item" onclick="toggle('m2')"><input type="checkbox" id="m2" data-d="-5" data-n="T√°c phong √°o"> <span>Kh√¥ng b·ªè √°o v√†o qu·∫ßn</span> <b class="loi-score minus">-5</b></div>
            <div class="loi-item" onclick="toggle('m3')"><input type="checkbox" id="m3" data-d="-5" data-n="√Åo kho√°c"> <span>M·∫∑c √°o kho√°c sai quy ƒë·ªãnh</span> <b class="loi-score minus">-5</b></div>
            <div class="loi-item" onclick="toggle('m4')"><input type="checkbox" id="m4" data-d="-5" data-n="ƒê·ªìng ph·ª•c"> <span>ƒê·ªìng ph·ª•c sai quy ƒë·ªãnh</span> <b class="loi-score minus">-5</b></div>

            <div class="group-title">2. ƒê·∫†O ƒê·ª®C & K·ª∂ LU·∫¨T</div>
            <div class="loi-item" onclick="toggle('m5')"><input type="checkbox" id="m5" data-d="-10" data-n="T√≥c/Son/Ph·∫•n"> <span>Nhu·ªôm t√≥c/Son/Ph·∫•n/M√≥ng</span> <b class="loi-score minus">-10</b></div>
            <div class="loi-item" onclick="toggle('m6')"><input type="checkbox" id="m6" data-d="-10" data-n="N√≥i t·ª•c"> <span>N√≥i t·ª•c, ch·ª≠i th·ªÅ</span> <b class="loi-score minus">-10</b></div>
            <div class="loi-item" onclick="toggle('m7')"><input type="checkbox" id="m7" data-d="-10" data-n="ƒê√°nh nhau"> <span>ƒê√°nh nhau</span> <b class="loi-score minus">-10</b></div>
            <div class="loi-item" onclick="toggle('m8')"><input type="checkbox" id="m8" data-d="-20" data-n="B·ªè r√°c b·∫≠y"> <span>B·ªè r√°c b·∫≠y (-20ƒë HS, -100ƒë L·ªõp)</span> <b class="loi-score minus">-20</b></div>

            <div class="group-title">3. CHUY√äN C·∫¶N & T·∫¨P TH·ªÇ</div>
            <div class="loi-item" onclick="toggle('m9')"><input type="checkbox" id="m9" data-d="-2" data-n="ƒêi tr·ªÖ"> <span>ƒêi h·ªçc tr·ªÖ</span> <b class="loi-score minus">-2</b></div>
            <div class="loi-item" onclick="toggle('m10')"><input type="checkbox" id="m10" data-d="-5" data-n="N√≥i chuy·ªán"> <span>N√≥i chuy·ªán ri√™ng</span> <b class="loi-score minus">-5</b></div>
            <div class="loi-item" onclick="toggle('m11')"><input type="checkbox" id="m11" data-d="-50" data-n="SH 15 ph√∫t" data-tp="L"> <span>Kh√¥ng SH 15 ph√∫t (L·ªõp)</span> <b class="loi-score minus">-50</b></div>
            <div class="loi-item" onclick="toggle('m12')"><input type="checkbox" id="m12" data-d="-50" data-n="Th·ªÉ d·ª•c" data-tp="L"> <span>Kh√¥ng t·∫≠p TD gi·ªØa gi·ªù (L·ªõp)</span> <b class="loi-score minus">-50</b></div>

            <div class="group-title group-plus">4. ƒêI·ªÇM TH∆Ø·ªûNG (C·ªòNG)</div>
            <div class="loi-item" onclick="toggle('m13')"><input type="checkbox" id="m13" data-d="10" data-n="ƒêi·ªÉm 10"> <span>ƒê·∫°t ƒëi·ªÉm 10</span> <b class="loi-score plus">+10</b></div>
            <div class="loi-item" onclick="toggle('m14')"><input type="checkbox" id="m14" data-d="5" data-n="Vi·ªác t·ªët"> <span>Nh·∫∑t c·ªßa r∆°i tr·∫£ l·∫°i</span> <b class="loi-score plus">+5</b></div>
            <div class="loi-item" onclick="toggle('m15')"><input type="checkbox" id="m15" data-d="10" data-n="Ti·∫øt A" data-tp="L"> <span>Ti·∫øt h·ªçc lo·∫°i A (L·ªõp)</span> <b class="loi-score plus">+10</b></div>
        </div>

        <div class="btn-group">
            <button class="btn btn-ls" onclick="openReport()">üìã B√ÅO C√ÅO LS</button>
            <button class="btn btn-save" onclick="saveData()">‚úÖ L∆ØU ƒêI·ªÇM</button>
        </div>
        <button class="btn btn-zalo" onclick="exportZalo()">üì± XU·∫§T B√ÅO C√ÅO ZALO</button>
        <button class="btn btn-reset" onclick="resetWeek()">üîÑ RESET TU·∫¶N M·ªöI</button>
    </div>
</div>

<div id="report-screen">
    <button class="btn" style="background:#666; color:white; margin-bottom:10px" onclick="closeReport()">‚¨Ö QUAY L·∫†I</button>
    <h3 style="text-align:center; margin-bottom:0">CHI TI·∫æT ƒêI·ªÇM L·ªöP <span id="report-lop-name">--</span></h3>
    <table class="report-table">
        <thead>
            <tr>
                <th>N·ªôi dung</th>
                <th>Bi·ªÉu ƒëi·ªÉm</th>
                <th>C√° nh√¢n/L·ªõp</th>
                <th>S·ªë l·∫ßn</th>
                <th>ƒêi·ªÉm</th>
            </tr>
        </thead>
        <tbody id="report-body"></tbody>
    </table>
</div>

<script>
    const dsLops = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
    let db = JSON.parse(localStorage.getItem('saodo_pa_2026_final')) || {};
    let currentLop = "";

    function checkPin(val) {
        if(val === "1234") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
            renderXH();
        }
    }

    function renderXH() {
        let sortedLops = [...dsLops].sort((a,b) => (db[b]?.total || 100) - (db[a]?.total || 100));
        let html = "";
        sortedLops.forEach((l, index) => {
            let score = db[l] ? db[l].total : 100;
            let rankClass = index === 0 ? "rank-1" : "";
            html += `<div class="lop-card ${currentLop === l ? 'active' : ''} ${rankClass}" onclick="selectLop('${l}')">
                        <b>${l}</b>
                        <span>${score}ƒë</span>
                    </div>`;
        });
        document.getElementById('grid-xh').innerHTML = html;
    }

    function selectLop(l) {
        currentLop = l;
        renderXH();
        document.getElementById('form-cham').style.display = 'block';
        document.getElementById('label-lop').innerText = "Ch·∫•m ƒëi·ªÉm: L·ªõp " + l;
        window.scrollTo({ top: document.getElementById('form-cham').offsetTop, behavior: 'smooth' });
    }

    function toggle(id) {
        document.getElementById(id).checked = !document.getElementById(id).checked;
    }

    function saveData() {
        if(!currentLop) return;
        const nameStr = document.getElementById('input-names').value.trim();
        const checks = Array.from(document.querySelectorAll("#ds-loi input[type='checkbox']:checked"));

        if(checks.length === 0) return alert("Vui l√≤ng t√≠ch l·ªói!");
        if(!db[currentLop]) db[currentLop] = { total: 100, logs: [] };

        // Logic x2, x3...
        let items = nameStr.split(',').filter(x => x.trim().length > 0);
        let count = 0;
        if(items.length === 0) {
            count = 1;
        } else {
            items.forEach(it => {
                let m = it.toLowerCase().match(/(.+)x\s*(\d+)/);
                count += m ? parseInt(m[2]) : 1;
            });
        }

        checks.forEach(c => {
            let bieu = Number(c.dataset.d);
            let soLan = c.dataset.tp === "L" ? 1 : count; 
            let tong = bieu * soLan;

            db[currentLop].total += tong;
            db[currentLop].logs.push({
                n: c.dataset.n,
                b: bieu,
                hs: nameStr || "C·∫£ l·ªõp",
                l: soLan,
                t: tong,
                d: new Date().toLocaleTimeString('vi-VN', {hour: '2-digit', minute:'2-digit'})
            });
        });

        localStorage.setItem('saodo_pa_2026_final', JSON.stringify(db));
        document.getElementById('input-names').value = "";
        checks.forEach(c => c.checked = false);
        renderXH();
        alert("ƒê√£ l∆∞u ƒëi·ªÉm th√†nh c√¥ng!");
    }

    function openReport() {
        if(!currentLop || !db[currentLop]) return;
        let html = "";
        let tong = 0;
        db[currentLop].logs.forEach(log => {
            tong += log.t;
            html += `<tr>
                <td>${log.n}</td>
                <td style="text-align:center">${log.b > 0 ? '+' : ''}${log.b}</td>
                <td>${log.hs}</td>
                <td style="text-align:center">${log.l}</td>
                <td style="text-align:center; font-weight:bold">${log.t > 0 ? '+' : ''}${log.t}</td>
            </tr>`;
        });
        html += `<tr style="background:#eee; font-weight:bold"><td colspan="4" style="text-align:right">T·ªïng c·ªông:</td><td style="text-align:center">${tong > 0 ? '+' : ''}${tong}</td></tr>`;
        document.getElementById('report-lop-name').innerText = currentLop;
        document.getElementById('report-body').innerHTML = html;
        document.getElementById('report-screen').style.display = 'block';
    }

    function closeReport() { document.getElementById('report-screen').style.display = 'none'; }

    function exportZalo() {
        if(!currentLop || !db[currentLop]) return;
        let text = `--- B√ÅO C√ÅO SAO ƒê·ªé PH∆Ø·ªöC AN ---\nL·ªõp: ${currentLop}\nT·ªïng ƒëi·ªÉm hi·ªán t·∫°i: ${db[currentLop].total}ƒë\n\nChi ti·∫øt vi ph·∫°m:\n`;
        db[currentLop].logs.forEach(log => {
            text += `- ${log.n}: ${log.hs} (${log.t > 0 ? '+' : ''}${log.t}ƒë)\n`;
        });
        navigator.clipboard.writeText(text).then(() => {
            alert("ƒê√£ sao ch√©p n·ªôi dung b√°o c√°o! B√¢y gi·ªù h√£y m·ªü Zalo v√† d√°n v√†o nh√≥m.");
        });
    }

    function resetWeek() {
        if(confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën RESET to√†n b·ªô d·ªØ li·ªáu ƒë·ªÉ sang tu·∫ßn m·ªõi kh√¥ng? (ƒêi·ªÉm s·∫Ω quay v·ªÅ 100)")) {
            localStorage.removeItem('saodo_pa_2026_final');
            db = {};
            currentLop = "";
            document.getElementById('form-cham').style.display = 'none';
            renderXH();
            alert("ƒê√£ l√†m m·ªõi h·ªá th·ªëng!");
        }
    }
</script>
</body>
</html>
