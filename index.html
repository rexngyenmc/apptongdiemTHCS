<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Sổ Tính Điểm</title>

<style>
body{
background:#0f172a;
color:white;
font-family:Arial;
padding:20px;
}

h3{
margin-bottom:10px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
background:#1e293b;
}

th,td{
border:1px solid #334155;
padding:10px;
text-align:center;
}

input{
padding:6px;
border-radius:6px;
border:none;
}

button{
margin-top:15px;
padding:10px 20px;
border:none;
border-radius:8px;
background:#2563eb;
color:white;
cursor:pointer;
}

.total-box{
margin-top:15px;
font-size:20px;
font-weight:bold;
}

.history-box{
margin-top:30px;
background:#1e293b;
padding:15px;
border-radius:10px;
}
</style>
</head>

<body>

<div id="main"></div>

<script>

const LOPS = ["6A","6B","7A","7B"];

const LOIS = [
{ten:"Không đeo khăn quàng hoặc huy hiệu",diem:-5},
{ten:"Không bỏ áo vào quần",diem:-5},
{ten:"Đi trễ",diem:-2},
{ten:"Vắng không phép",diem:-5},
{ten:"Nói tục",diem:-10},
{ten:"Đánh nhau",diem:-50},
{ten:"Xả rác",diem:-20},
{ten:"Không trực nhật",diem:-10}
];

let lichSu = JSON.parse(localStorage.getItem("lichSu")) || [];
let lichSuTuan = JSON.parse(localStorage.getItem("lichSuTuan")) || [];

function renderScore(){

let html = `
<h3>SỔ TÍNH ĐIỂM</h3>

<select id="lopSelect">
${LOPS.map(l=>`<option value="${l}">${l}</option>`).join("")}
</select>

<table>

<tr>
<th colspan="4" style="text-align:left">
Tên người ghi điểm:
<input type="text" id="tenNguoi" style="margin-top:6px;width:100%">
</th>
</tr>

<tr>
<th>Nội dung</th>
<th>Biểu điểm</th>
<th>Số lần</th>
<th>Điểm</th>
</tr>
`;

LOIS.forEach((l,i)=>{
html+=`
<tr>
<td>${l.ten}</td>
<td style="color:${l.diem<0?'#ff5252':'#00e676'}">${l.diem}</td>
<td><input type="number" min="0" value="0" id="sl${i}" oninput="updateRow(${i})"></td>
<td id="row${i}">0</td>
</tr>
`;
});

html+=`
</table>

<div class="total-box">
TỔNG ĐIỂM: <span id="tongDiem">0</span>
</div>

<button onclick="luuDiem()">LƯU ĐIỂM</button>

<div class="history-box">
<h3>Lịch sử chấm điểm</h3>
<div id="lichSuBox"></div>
</div>

<div class="history-box">
<h3>Lịch sử tuần</h3>
<div id="lichSuTuanBox"></div>
</div>
`;

document.getElementById("main").innerHTML = html;

renderHistory();
renderWeekHistory();
}

function updateRow(i){
let sl = parseInt(document.getElementById("sl"+i).value) || 0;
let diem = sl * LOIS[i].diem;
document.getElementById("row"+i).innerText = diem;
updateTotal();
}

function updateTotal(){
let tong=0;
LOIS.forEach((l,i)=>{
tong+=parseInt(document.getElementById("row"+i).innerText)||0;
});
document.getElementById("tongDiem").innerText=tong;
}

function luuDiem(){

let lop=document.getElementById("lopSelect").value;
let ten=document.getElementById("tenNguoi").value.trim();
let tong=parseInt(document.getElementById("tongDiem").innerText);

if(ten===""){
alert("Nhập tên người ghi điểm!");
return;
}

let now=new Date().toLocaleString();

let entry={
lop,
ten,
tong,
time:now
};

lichSu.unshift(entry);
if(lichSu.length>20) lichSu.pop();

lichSuTuan.unshift(entry);

localStorage.setItem("lichSu",JSON.stringify(lichSu));
localStorage.setItem("lichSuTuan",JSON.stringify(lichSuTuan));

renderHistory();
renderWeekHistory();
alert("Đã lưu!");
}

function renderHistory(){
let box=document.getElementById("lichSuBox");
if(!box) return;

box.innerHTML=lichSu.map(e=>
`<div>${e.lop} - ${e.ten} (${e.tong}) - ${e.time}</div>`
).join("");
}

function renderWeekHistory(){
let box=document.getElementById("lichSuTuanBox");
if(!box) return;

box.innerHTML=lichSuTuan.map(e=>
`<div>${e.lop} - ${e.ten} (${e.tong}) - ${e.time}</div>`
).join("");
}

renderScore();

</script>

</body>
</html>
