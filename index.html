<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAO ƒê·ªé PH∆Ø·ªöC AN - 2026</title>
    <style>
        :root { --p: #6200ee; --s: #03dac6; --a: #b00020; --bg: #f5f5f5; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        
        /* PIN Screen */
        #pin-screen { position: fixed; inset: 0; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; }
        .pin-input { width: 120px; padding: 10px; border-radius: 10px; border: none; font-size: 2rem; text-align: center; font-weight: bold; }

        /* Header gi·ªëng h√¨nh 1 */
        .header { background: linear-gradient(90deg, #4b00e0, #8e2de2); color: white; padding: 15px; text-align: center; border-radius: 15px; margin-bottom: 15px; }
        
        /* Grid L·ªõp gi·ªëng h√¨nh 1 */
        .grid-lops { display: grid; grid-template-columns: repeat(auto-fill, minmax(75px, 1fr)); gap: 8px; margin-bottom: 15px; }
        .lop-card { background: white; padding: 12px 5px; border-radius: 12px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; border: 2px solid transparent; }
        .lop-card.active { border-color: var(--p); background: #f3e5f5; }
        .lop-card b { display: block; font-size: 1rem; }
        .lop-card span { font-size: 0.8rem; color: var(--p); font-weight: bold; }

        /* Form ch√≠nh */
        .main-card { background: white; padding: 15px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: none; }
        .input-names { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #ddd; font-size: 0.9rem; box-sizing: border-box; margin-bottom: 10px; }
        
        /* B·∫£ng l·ªói */
        .loi-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .loi-item input { width: 20px; height: 20px; margin-right: 10px; }
        .loi-item span { flex: 1; font-size: 0.85rem; }
        
        /* Modal B·∫£ng T√≠nh gi·ªëng h√¨nh 2 */
        #modal-bangtinh { display: none; position: fixed; inset: 0; background: white; z-index: 2000; padding: 15px; overflow-y: auto; }
        .table-bt { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        .table-bt th, .table-bt td { border: 1px solid #333; padding: 8px; text-align: left; }
        .table-bt th { background: #f0f0f0; }
        
        .group-btn { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .btn { padding: 15px; border: none; border-radius: 12px; font-weight: bold; color: white; cursor: pointer; }
        .btn-p { background: var(--p); }
        .btn-s { background: var(--s); color: #333; }
        .btn-close { background: #666; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>

<div id="pin-screen">
    <h3>üîë M·∫¨T M√É SAO ƒê·ªé</h3>
    <input type="password" maxlength="4" class="pin-input" oninput="if(this.value==='1234'){document.getElementById('pin-screen').style.display='none';renderLops();}">
</div>

<div class="header"><h2>üåü SAO ƒê·ªé PH∆Ø·ªöC AN</h2></div>

<div class="grid-lops" id="ds-lop"></div>

<div class="main-card" id="form-cham">
    <h3 id="label-lop" style="color:var(--p); margin-top:0;">L·ªõp --</h3>
    <input type="text" id="ten-hs" class="input-names" placeholder="Nh·∫≠p t√™n HS (v√≠ d·ª•: Ho√†ng, H√†, √Çn)...">
    
    <div style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 10px;" id="danh-sach-loi">
        <div class="loi-item" onclick="toggle('l1')"><input type="checkbox" id="l1" data-d="-5" data-n="Kh√¥ng khƒÉn qu√†ng/Huy hi·ªáu"> <span>KhƒÉn qu√†ng/Huy hi·ªáu</span> <b>-5</b></div>
        <div class="loi-item" onclick="toggle('l2')"><input type="checkbox" id="l2" data-d="-10" data-n="N√≥i t·ª•c, ch·ª≠i th·ªÅ"> <span>N√≥i t·ª•c, ch·ª≠i th·ªÅ</span> <b>-10</b></div>
        <div class="loi-item" onclick="toggle('l3')"><input type="checkbox" id="l3" data-d="10" data-n="ƒêi·ªÉm 10"> <span>H·ªçc sinh ƒëi·ªÉm 10</span> <b style="color:green">+10</b></div>
    </div>

    <div class="group-btn">
        <button class="btn btn-s" onclick="xemBangTinh()">üìä B·∫¢NG T√çNH</button>
        <button class="btn btn-p" onclick="luuDiem()">‚úÖ X√ÅC NH·∫¨N</button>
    </div>
</div>

<div id="modal-bangtinh">
    <h3 style="text-align:center">CHI TI·∫æT B·∫¢NG T√çNH</h3>
    <p id="bt-lop-name" style="font-weight:bold"></p>
    <table class="table-bt">
        <thead>
            <tr>
                <th>N·ªôi dung</th>
                <th>Bi·ªÉu ƒëi·ªÉm</th>
                <th>H·ªçc sinh</th>
                <th>S·ªë l·∫ßn</th>
                <th>ƒêi·ªÉm</th>
            </tr>
        </thead>
        <tbody id="bt-body"></tbody>
        <tfoot>
            <tr>
                <td colspan="4" style="text-align:right; font-weight:bold">T·ªïng ƒëi·ªÉm ƒë·ª£t n√†y:</td>
                <td id="bt-tong" style="font-weight:bold; color:red">0</td>
            </tr>
        </tfoot>
    </table>
    <button class="btn btn-close" onclick="document.getElementById('modal-bangtinh').style.display='none'">ƒê√ìNG B·∫¢NG T√çNH</button>
</div>

<script>
    const lops = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
    let db = JSON.parse(localStorage.getItem('saodo_pa_2026')) || {};
    let cur = "";

    function renderLops() {
        let h = "";
        lops.forEach(l => {
            let s = db[l] ? db[l].total : 100;
            h += `<div class="lop-card ${cur==l?'active':''}" onclick="chonLop('${l}')"><b>${l}</b><span>${s}ƒë</span></div>`;
        });
        document.getElementById('ds-lop').innerHTML = h;
    }

    function chonLop(l) {
        cur = l;
        renderLops();
        document.getElementById('form-cham').style.display = 'block';
        document.getElementById('label-lop').innerText = "ƒêang ch·∫•m: L·ªõp " + l;
    }

    function toggle(id) { document.getElementById(id).checked = !document.getElementById(id).checked; }

    // Logic t√≠nh to√°n b·∫£ng t√≠nh gi·ªëng h√¨nh 2
    function xemBangTinh() {
        const hsText = document.getElementById('ten-hs').value.trim();
        const dsTen = hsText.split(/[,.;]+/).filter(x => x.trim().length > 0);
        const checks = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'));
        
        if(checks.length === 0) return alert("Ch∆∞a ch·ªçn l·ªói n√†o!");

        let html = "";
        let tong = 0;

        checks.forEach(c => {
            let bieuDiem = parseInt(c.dataset.d);
            let soLan = dsTen.length || 1; // N·∫øu kh√¥ng nh·∫≠p t√™n th√¨ t√≠nh 1 l·∫ßn
            let thanhTien = bieuDiem * soLan;
            tong += thanhTien;

            html += `<tr>
                <td>${c.dataset.n}</td>
                <td>${bieuDiem}</td>
                <td>${hsText || 'C·∫£ l·ªõp'}</td>
                <td>${soLan}</td>
                <td>${thanhTien > 0 ? '+' + thanhTien : thanhTien}</td>
            </tr>`;
        });

        document.getElementById('bt-lop-name').innerText = "L·ªõp: " + cur;
        document.getElementById('bt-body').innerHTML = html;
        document.getElementById('bt-tong').innerText = (tong > 0 ? '+' : '') + tong;
        document.getElementById('modal-bangtinh').style.display = 'block';
    }

    function luuDiem() {
        const hsText = document.getElementById('ten-hs').value.trim();
        const dsTen = hsText.split(/[,.;]+/).filter(x => x.trim().length > 0);
        const checks = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'));

        if(checks.length === 0) return alert("Ch∆∞a ch·ªçn l·ªói!");

        if(!db[cur]) db[cur] = { total: 100 };
        
        let hieuSo = 0;
        checks.forEach(c => {
            let soLan = dsTen.length || 1;
            hieuSo += (parseInt(c.dataset.d) * soLan);
        });

        db[cur].total += hieuSo;
        
        // Reset sau khi l∆∞u
        document.getElementById('ten-hs').value = "";
        checks.forEach(c => c.checked = false);
        
        localStorage.setItem('saodo_pa_2026', JSON.stringify(db));
        renderLops();
        alert("ƒê√£ c·ªông d·ªìn ƒëi·ªÉm th√†nh c√¥ng!");
    }
</script>
</body>
</html>
