<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WEB SAO ƒê·ªé PH∆Ø·ªöC AN </title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #f8f9fa; --gold: #ffd700; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; }
        .pin-input { width: 160px; padding: 15px; border-radius: 15px; border: none; font-size: 2rem; text-align: center; letter-spacing: 5px; font-weight: bold; margin: 20px 0; color: var(--p); outline: none; }

        .header { background: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-top: 5px solid var(--p); }
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f1f1f1; font-size: 0.7rem; padding: 8px; border: 1px solid #ddd; }
        td { padding: 10px 5px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 0.8rem; }
        .rank { width: 25px; height: 25px; line-height: 25px; display: inline-block; border-radius: 50%; background: #eee; font-size: 0.7rem; }
        .rank-1 { background: var(--gold); }

        .input-group { margin-bottom: 15px; }
        .input-label { font-size: 0.8rem; font-weight: bold; color: var(--p); display: block; margin-bottom: 5px; }
        .input-box { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; outline: none; }
        .input-box:focus { border-color: var(--p); }

        .scroll-form { max-height: 350px; overflow-y: auto; border: 1px solid #eee; border-radius: 10px; padding: 5px; background: #fff; }
        .group-title { background: #e9ecef; padding: 6px; font-weight: bold; font-size: 0.75rem; margin: 10px 0 5px 0; border-left: 4px solid var(--p); }
        .loi-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #f1f1f1; cursor: pointer; }
        .loi-item:active { background: #f0f0f0; }
        .score-tag { font-weight: bold; font-size: 0.85rem; width: 50px; text-align: right; }
        .minus { color: var(--a); } .plus { color: var(--s); }

        .ls-table th { font-size: 0.65rem; padding: 5px; }
        .ls-table td { font-size: 0.7rem; font-weight: normal; padding: 5px; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 1rem; }
        .btn-apply { background: var(--p); color: white; }
        .btn-zalo { background: #0068ff; color: white; }
        .btn-reset { background: #fff; color: var(--a); border: 1px solid var(--a); margin-top: 20px; font-size: 0.7rem; }
        .btn-del { color: red; border: none; background: none; font-weight: bold; cursor: pointer; }

        .lop-row { cursor: pointer; }
        .active-lop { background: #e3f2fd !important; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2 style="margin:0">üîë M·∫¨T M√É SAO ƒê·ªé</h2>
    <input type="password" id="pin-input" class="pin-input" placeholder="****" maxlength="4" oninput="checkPin()">
</div>

<div id="main-content">
    <div class="header">
        <h1 style="font-size: 1rem; margin:0; color:var(--p)">LI√äN ƒê·ªòI TH & THCS PH∆Ø·ªöC AN</h1>
    </div>

    <div class="container">
        <div class="card">
            <h3 style="margin-top:0; font-size:0.9rem">üèÜ B·∫¢NG X·∫æP H·∫†NG</h3>
            <table>
                <thead><tr><th>H·∫°ng</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody id="bxh-body"></tbody>
            </table>
            <button class="btn btn-zalo" onclick="xuatZalo()">üîµ Copy b√°o c√°o Zalo</button>
        </div>

        <div class="card" id="input-area" style="display:none;">
            <h3 id="current-lop-label" style="color:var(--p); text-align:center; margin-top:0"></h3>
            
            <div class="input-group">
                <span class="input-label">üë§ C√Å NH√ÇN/T·∫¨P TH·ªÇ (VD:Nguy√™nx2,b·∫£o,...):</span>
                <input type="text" id="hs-names" class="input-box" placeholder="V√≠ d·ª•: Ho√†ng x3, H√†, √Çn...">
            </div>

            <div class="input-group">
                <span class="input-label">üîç T√åM KI·∫æM L·ªñI:</span>
                <input type="text" id="search-loi" class="input-box" placeholder="G√µ t√™n l·ªói..." onkeyup="filterLoi()">
            </div>

            <div class="scroll-form" id="error-list">
<div class="scroll-form" id="error-list">
    <div class="group-title">T√ÅC PHONG - ƒê·ªíNG PH·ª§C (-5ƒë)</div>
    <div class="loi-item" onclick="toggleLoi('l1')"><input type="checkbox" id="l1" data-d="-5" data-n="Kh√¥ng ƒëeo KhƒÉn qu√†ng/Huy hi·ªáu"> <span>Kh√¥ng ƒëeo KhƒÉn qu√†ng/Huy hi·ªáu</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l2')"><input type="checkbox" id="l2" data-d="-5" data-n="Kh√¥ng b·ªè √°o v√†o qu·∫ßn"> <span>Kh√¥ng b·ªè √°o v√†o qu·∫ßn</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l3')"><input type="checkbox" id="l3" data-d="-5" data-n="M·∫∑c √°o kho√°c trong tr∆∞·ªùng"> <span>M·∫∑c √°o kho√°c trong tr∆∞·ªùng</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l4')"><input type="checkbox" id="l4" data-d="-5" data-n="ƒê·ªìng ph·ª•c sai quy ƒë·ªãnh"> <span>ƒê·ªìng ph·ª•c sai quy ƒë·ªãnh</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l5')"><input type="checkbox" id="l5" data-d="-5" data-n="ƒêi ch√¢n tr·∫ßn"> <span>ƒêi ch√¢n tr·∫ßn ra s√¢n/WC</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l6')"><input type="checkbox" id="l6" data-d="-5" data-n="ƒê·ªÉ xe kh√¥ng ngay h√†ng"> <span>ƒê·ªÉ xe kh√¥ng ngay h√†ng</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l7')"><input type="checkbox" id="l7" data-d="-5" data-n="Kh√¥ng ƒë·ªôi m≈© b·∫£o hi·ªÉm"> <span>Kh√¥ng ƒë·ªôi m≈© b·∫£o hi·ªÉm</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l8')"><input type="checkbox" id="l8" data-d="-5" data-n="ƒê·ªÉ t√≥c d√†i (Nam)"> <span>ƒê·ªÉ t√≥c d√†i (Nam)</span> <div class="score-tag minus">-5</div></div>

    <div class="group-title">K·ª∂ LU·∫¨T & ƒê·∫†O ƒê·ª®C</div>
    <div class="loi-item" onclick="toggleLoi('l9')"><input type="checkbox" id="l9" data-d="-10" data-n="Nhu·ªôm t√≥c/Son ph·∫•n"> <span>Nhu·ªôm t√≥c, son ph·∫•n, s∆°n m√≥ng</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l10')"><input type="checkbox" id="l10" data-d="-10" data-n="N√≥i t·ª•c, ch·ª≠i th·ªÅ"> <span>N√≥i t·ª•c, ch·ª≠i th·ªÅ</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l11')"><input type="checkbox" id="l11" data-d="-10" data-n="ƒê√°nh nhau"> <span>ƒê√°nh nhau</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l12')"><input type="checkbox" id="l12" data-d="-10" data-n="Ch·ªëng ƒë·ªëi Sao ƒë·ªè"> <span>Ch·ªëng ƒë·ªëi Sao ƒë·ªè</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l13')"><input type="checkbox" id="l13" data-d="-20" data-n="B·ªè r√°c sai quy ƒë·ªãnh"> <span>B·ªè r√°c sai quy ƒë·ªãnh</span> <div class="score-tag minus">-20</div></div>
    <div class="loi-item" onclick="toggleLoi('l14')"><input type="checkbox" id="l14" data-d="-30" data-n="Chui r√†o/Ph√° h√†ng r√†o"> <span>Chui r√†o, ph√° h√†ng r√†o</span> <div class="score-tag minus">-30</div></div>
    <div class="loi-item" onclick="toggleLoi('l15')"><input type="checkbox" id="l15" data-d="-10" data-n="Vi·∫øt v·∫Ω b·∫≠y l√™n t∆∞·ªùng/b√†n"> <span>Vi·∫øt v·∫Ω b·∫≠y l√™n t∆∞·ªùng/b√†n</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l16')"><input type="checkbox" id="l16" data-d="-5" data-n="Ra c·ªïng kh√¥ng ph√©p"> <span>Ra kh·ªèi c·ªïng kh√¥ng ph√©p</span> <div class="score-tag minus">-5</div></div>

    <div class="group-title">CHUY√äN C·∫¶N & N·ªÄN N·∫æP</div>
    <div class="loi-item" onclick="toggleLoi('l17')"><input type="checkbox" id="l17" data-d="-2" data-n="ƒêi tr·ªÖ"> <span>ƒêi tr·ªÖ</span> <div class="score-tag minus">-2</div></div>
    <div class="loi-item" onclick="toggleLoi('l18')"><input type="checkbox" id="l18" data-d="-5" data-n="V·∫Øng kh√¥ng ph√©p"> <span>V·∫Øng kh√¥ng ph√©p</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l19')"><input type="checkbox" id="l19" data-d="-10" data-n="Tr·ªën ti·∫øt"> <span>Tr·ªën ti·∫øt</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l20')"><input type="checkbox" id="l20" data-d="-5" data-n="N√≥i chuy·ªán ri√™ng"> <span>N√≥i chuy·ªán ri√™ng</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l21')"><input type="checkbox" id="l21" data-d="-5" data-n="Kh√¥ng sinh ho·∫°t 15p"> <span>Kh√¥ng sinh ho·∫°t 15p ƒë·∫ßu gi·ªù</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l22')"><input type="checkbox" id="l22" data-d="-5" data-n="T·∫≠p TD gi·ªØa gi·ªù kh√¥ng t·ªët"> <span>T·∫≠p TD gi·ªØa gi·ªù (v·∫Øng/ko nghi√™m t√∫c)</span> <div class="score-tag minus">-5</div></div>

    <div class="group-title">H·ªåC T·∫¨P & TI·∫æT H·ªåC</div>
    <div class="loi-item" onclick="toggleLoi('l23')"><input type="checkbox" id="l23" data-d="-10" data-n="Kh√¥ng thu·ªôc b√†i/L√†m BT"> <span>Kh√¥ng thu·ªôc b√†i/Kh√¥ng l√†m BT</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l24')"><input type="checkbox" id="l24" data-d="-10" data-n="ƒêi·ªÉm: 0,1,2,3"> <span>ƒêi·ªÉm k√©m (0,1,2,3)</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l25')"><input type="checkbox" id="l25" data-d="-5" data-n="ƒêi·ªÉm: 4"> <span>ƒêi·ªÉm y·∫øu (4)</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l26')"><input type="checkbox" id="l26" data-d="5" data-n="ƒêi·ªÉm: 7"> <span>ƒê·∫°t ƒëi·ªÉm 7</span> <div class="score-tag plus">+5</div></div>
    <div class="loi-item" onclick="toggleLoi('l27')"><input type="checkbox" id="l27" data-d="9" data-n="ƒêi·ªÉm: 8,9"> <span>ƒê·∫°t ƒëi·ªÉm 8, 9</span> <div class="score-tag plus">+9</div></div>
    <div class="loi-item" onclick="toggleLoi('l28')"><input type="checkbox" id="l28" data-d="10" data-n="ƒêi·ªÉm: 10"> <span>ƒê·∫°t ƒëi·ªÉm 10</span> <div class="score-tag plus">+10</div></div>
    <div class="loi-item" onclick="toggleLoi('l29')"><input type="checkbox" id="l29" data-d="10" data-n="Ti·∫øt h·ªçc lo·∫°i A"> <span>1 ti·∫øt h·ªçc lo·∫°i A</span> <div class="score-tag plus">+10</div></div>
    <div class="loi-item" onclick="toggleLoi('l30')"><input type="checkbox" id="l30" data-d="5" data-n="Ti·∫øt h·ªçc lo·∫°i B"> <span>1 ti·∫øt h·ªçc lo·∫°i B</span> <div class="score-tag plus">+5</div></div>
    <div class="loi-item" onclick="toggleLoi('l31')"><input type="checkbox" id="l31" data-d="-5" data-n="Ti·∫øt h·ªçc lo·∫°i C"> <span>1 ti·∫øt h·ªçc lo·∫°i C</span> <div class="score-tag minus">-5</div></div>
    <div class="loi-item" onclick="toggleLoi('l32')"><input type="checkbox" id="l32" data-d="-10" data-n="Ti·∫øt h·ªçc lo·∫°i D"> <span>1 ti·∫øt h·ªçc lo·∫°i D</span> <div class="score-tag minus">-10</div></div>
    <div class="loi-item" onclick="toggleLoi('l33')"><input type="checkbox" id="l33" data-d="5" data-n="Tr·∫£ l·∫°i c·ªßa r∆°i"> <span>Tr·∫£ l·∫°i c·ªßa r∆°i</span> <div class="score-tag plus">+5</div></div>
</div>
            <button class="btn btn-apply" onclick="luuDuLieu()">L∆ØU V√ÄO L·ªäCH S·ª¨</button>

            <h3 style="font-size:0.8rem; margin-top:20px;">üìú L·ªäCH S·ª¨ CH·∫§M (L·ªöP ƒêANG CH·ªåN)</h3>
            <table class="ls-table">
                <thead>
                    <tr>
                        <th>Vi·ªác l√†m t·ªët/kh√¥ng t·ªët</th>
                        <th>Bi·ªÉu ƒëi·ªÉm</th>
                        <th>C√° nh√¢n/T·∫≠p th·ªÉ</th>
                        <th>S·ªë l·∫ßn</th>
                        <th>ƒêi·ªÉm</th>
                        <th>X√≥a</th>
                    </tr>
                </thead>
                <tbody id="ls-body"></tbody>
            </table>
        </div>

        <button class="btn btn-reset" onclick="resetTuan()">üîÑ RESET TU·∫¶N M·ªöI</button>
    </div>
</div>

<script>
    const PIN = "1234";
    const LOP_LIST = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
    let db = JSON.parse(localStorage.getItem('PHUOC_AN_DB')) || {};

    LOP_LIST.forEach(l => { if(!db[l]) db[l] = { total: 100, logs: [] }; });

    function checkPin() {
        if(document.getElementById('pin-input').value === PIN) {
            document.getElementById('login-screen').style.display = 'none';
            renderBXH();
        }
    }

    function renderBXH() {
        const sorted = [...LOP_LIST].sort((a,b) => db[b].total - db[a].total);
        const body = document.getElementById('bxh-body');
        body.innerHTML = '';
        sorted.forEach((l, i) => {
            body.innerHTML += `
                <tr class="lop-row" id="row-${l}" onclick="chonLop('${l}')">
                    <td><span class="rank ${i<3?'rank-1':''}">${i+1}</span></td>
                    <td>L·ªõp ${l}</td>
                    <td style="color:${db[l].total<100?'red':'green'}">${db[l].total}</td>
                </tr>
            `;
        });
        localStorage.setItem('PHUOC_AN_DB', JSON.stringify(db));
    }

    let curLop = "";
    function chonLop(l) {
        curLop = l;
        document.querySelectorAll('.lop-row').forEach(r => r.classList.remove('active-lop'));
        document.getElementById(`row-${l}`).classList.add('active-lop');
        document.getElementById('input-area').style.display = 'block';
        document.getElementById('current-lop-label').innerText = `ƒêANG CH·∫§M: L·ªöP ${l}`;
        renderLS();
    }

    function toggleLoi(id) {
        const ck = document.getElementById(id);
        ck.checked = !ck.checked;
    }

    function filterLoi() {
        let key = document.getElementById('search-loi').value.toLowerCase();
        document.querySelectorAll('.loi-item').forEach(it => {
            it.style.display = it.innerText.toLowerCase().includes(key) ? 'flex' : 'none';
        });
    }

    function luuDuLieu() {
        if(!curLop) return;
        const nameInput = document.getElementById('hs-names').value.trim() || "T·∫≠p th·ªÉ";
        const selected = document.querySelectorAll('#error-list input:checked');
        
        if(selected.length === 0) return alert("Ch∆∞a ch·ªçn m·ª•c n√†o!");

        // Logic x·ª≠ l√Ω "Ho√†ng x3, H√†..."
        const namesArray = nameInput.split(',').filter(n => n.trim() !== "");
        let soLan = 0;
        
        if (namesArray.length === 0) {
            soLan = 1;
        } else {
            namesArray.forEach(item => {
                let match = item.toLowerCase().match(/x\s*(\d+)/);
                soLan += match ? parseInt(match[1]) : 1;
            });
        }

        selected.forEach(s => {
            let diemGoc = parseInt(s.dataset.d);
            let tongDiemRow = diemGoc * soLan;
            
            db[curLop].logs.unshift({
                id: Date.now() + Math.random(),
                name: nameInput,
                vi·ªác: s.dataset.n,
                bi·ªÉu: diemGoc,
                l·∫ßn: soLan,
                t·ªïng: tongDiemRow
            });
            db[curLop].total += tongDiemRow;
            s.checked = false;
        });

        document.getElementById('hs-names').value = "";
        renderBXH();
        renderLS();
    }

    function renderLS() {
        const body = document.getElementById('ls-body');
        body.innerHTML = '';
        db[curLop].logs.forEach(log => {
            body.innerHTML += `
                <tr>
                    <td>${log.vi·ªác}</td>
                    <td class="${log.bi·ªÉu<0?'minus':'plus'}">${log.bi·ªÉu}</td>
                    <td>${log.name}</td>
                    <td>${log.l·∫ßn}</td>
                    <td class="${log.t·ªïng<0?'minus':'plus'}">${log.t·ªïng}</td>
                    <td><button class="btn-del" onclick="xoaLog('${log.id}')">‚úï</button></td>
                </tr>
            `;
        });
    }

    function xoaLog(id) {
        if(!confirm("X√≥a d√≤ng n√†y?")) return;
        const index = db[curLop].logs.findIndex(x => x.id == id);
        if(index > -1) {
            db[curLop].total -= db[curLop].logs[index].t·ªïng;
            db[curLop].logs.splice(index, 1);
            renderBXH();
            renderLS();
        }
    }

    function xuatZalo() {
        let txt = "B√ÅO C√ÅO THI ƒêUA PH∆Ø·ªöC AN\n";
        [...LOP_LIST].sort((a,b) => db[b].total - db[a].total).forEach((l, i) => {
            txt += `${i+1}. L·ªõp ${l}: ${db[l].total}ƒë\n`;
        });
        navigator.clipboard.writeText(txt).then(() => alert("ƒê√£ copy b√°o c√°o!"));
    }

    function resetTuan() {
        if(confirm("X√≥a h·∫øt d·ªØ li·ªáu tu·∫ßn c≈©?")) {
            localStorage.clear();
            location.reload();
        }
    }
</script>
</body>
</html>
