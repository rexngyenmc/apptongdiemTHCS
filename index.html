<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAO ƒê·ªé PH∆Ø·ªöC AN - 2026</title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; }
        
        /* ƒêƒÉng nh·∫≠p */
        #login-screen { position: fixed; inset: 0; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; }
        .pin-input { width: 150px; padding: 15px; border-radius: 12px; border: none; font-size: 2rem; text-align: center; font-weight: bold; margin-top: 20px; color: var(--p); }

        /* Giao di·ªán ch√≠nh */
        .header { background: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-bottom: 4px solid var(--p); }
        .school-title { font-size: 1.1rem; font-weight: bold; color: var(--p); text-transform: uppercase; }

        /* Danh s√°ch l·ªõp */
        .grid-lops { display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 10px; margin-bottom: 15px; }
        .lop-card { background: white; padding: 12px 5px; border-radius: 12px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; border: 2px solid transparent; }
        .lop-card.active { border-color: var(--p); background: #e3f2fd; }
        .lop-card b { display: block; font-size: 1rem; }
        .lop-card span { font-size: 0.8rem; color: var(--p); font-weight: bold; }

        /* Form Ch·∫•m ƒêi·ªÉm */
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: none; }
        .name-input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ccc; box-sizing: border-box; font-weight: bold; margin-bottom: 10px; }

        /* Danh s√°ch l·ªói (Gi·ªØ nguy√™n t·ª´ b·∫£n g·ªëc) */
        .scroll-loi { max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .group-title { background: #f8f9fa; color: var(--p); padding: 8px; font-weight: bold; margin-top: 15px; font-size: 0.75rem; border-left: 4px solid var(--p); border-radius: 4px; }
        .loi-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f1f1f1; cursor: pointer; }
        .loi-item span { flex: 1; font-size: 0.85rem; }
        .score-tag { width: 45px; font-weight: bold; font-size: 0.8rem; text-align: right; }
        .minus { color: var(--a); } .plus { color: var(--s); }
        input[type=checkbox] { width: 20px; height: 20px; margin-right: 10px; }

        /* N√∫t b·∫•m */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; font-size: 0.9rem; }
        .btn-ls { background: #ff9800; color: white; }
        .btn-save { background: var(--p); color: white; }

        /* B·∫£ng b√°o c√°o 5 c·ªôt (H√¨nh 2) */
        #report-screen { display: none; position: fixed; inset: 0; background: white; z-index: 8000; padding: 15px; overflow-y: auto; }
        .report-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.75rem; }
        .report-table th, .report-table td { border: 1px solid #333; padding: 8px 4px; text-align: left; }
        .report-table th { background: #f2f2f2; text-align: center; }
        .total-row { font-weight: bold; background: #eee; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2>üîë SAO ƒê·ªé PH∆Ø·ªöC AN</h2>
    <input type="password" id="pin" class="pin-input" placeholder="****" maxlength="4" oninput="checkPin(this.value)">
</div>

<div id="main-ui" style="display:none">
    <div class="header">
        <div class="school-title">Tr∆∞·ªùng TH & THCS Ph∆∞·ªõc An</div>
        <p style="margin:5px 0 0 0; font-size:0.8rem; color:#555;">H·ªá Th·ªëng Ch·∫•m ƒêi·ªÉm - 2026</p>
    </div>

    <div class="grid-lops" id="grid-lops"></div>

    <div class="card" id="form-cham">
        <h3 id="label-lop" style="margin:0 0 10px 0; color: var(--p);">L·ªõp --</h3>
        
        <label style="font-size: 0.75rem; font-weight: bold; color: #d8a000;">üë§ NH·∫¨P T√äN (VD: HO√ÄNGX2, AN):</label>
        <input type="text" id="input-names" class="name-input" placeholder="T√™n h·ªçc sinh...">

        <div class="scroll-loi" id="ds-loi">
            <div class="group-title">1. T√°c phong & ƒê·ªìng ph·ª•c (-5ƒë)</div>
            <div class="loi-item" onclick="toggle('m1')"><input type="checkbox" id="m1" data-d="-5" data-n="KhƒÉn qu√†ng"> <span>Kh√¥ng KhƒÉn qu√†ng/Huy hi·ªáu</span> <b class="score-tag minus">-5</b></div>
            <div class="loi-item" onclick="toggle('m2')"><input type="checkbox" id="m2" data-d="-5" data-n="T√°c phong"> <span>Kh√¥ng b·ªè √°o v√†o qu·∫ßn</span> <b class="score-tag minus">-5</b></div>
            <div class="loi-item" onclick="toggle('m3')"><input type="checkbox" id="m3" data-d="-5" data-n="√Åo kho√°c"> <span>M·∫∑c √°o kho√°c sai quy ƒë·ªãnh</span> <b class="score-tag minus">-5</b></div>
            
            <div class="group-title">2. ƒê·∫°o ƒë·ª©c & K·ª∑ lu·∫≠t</div>
            <div class="loi-item" onclick="toggle('m7')"><input type="checkbox" id="m7" data-d="-10" data-n="Nhu·ªôm/Son"> <span>Nhu·ªôm t√≥c, t√¥ son, s∆°n m√≥ng</span> <b class="score-tag minus">-10</b></div>
            <div class="loi-item" onclick="toggle('m8')"><input type="checkbox" id="m8" data-d="-10" data-n="N√≥i t·ª•c"> <span>N√≥i t·ª•c, ch·ª≠i th·ªÅ</span> <b class="score-tag minus">-10</b></div>
            <div class="loi-item" onclick="toggle('m9')"><input type="checkbox" id="m9" data-d="-10" data-n="ƒê√°nh nhau"> <span>ƒê√°nh nhau</span> <b class="score-tag minus">-10</b></div>
            <div class="loi-item" onclick="toggle('m13')"><input type="checkbox" id="m13" data-d="-20" data-n="B·ªè r√°c b·∫≠y"> <span>B·ªè r√°c kh√¥ng ƒë√∫ng n∆°i quy ƒë·ªãnh</span> <b class="score-tag minus">-20</b></div>

            <div class="group-title">3. Chuy√™n c·∫ßn & T·∫≠p th·ªÉ</div>
            <div class="loi-item" onclick="toggle('m14')"><input type="checkbox" id="m14" data-d="-2" data-n="ƒêi tr·ªÖ"> <span>ƒêi h·ªçc tr·ªÖ</span> <b class="score-tag minus">-2</b></div>
            <div class="loi-item" onclick="toggle('m18')"><input type="checkbox" id="m18" data-d="-50" data-n="B·ªè SH15" data-tp="L"> <span>L·ªõp kh√¥ng SH 15 ph√∫t</span> <b class="score-tag minus">-50</b></div>

            <div class="group-title">4. H·ªçc t·∫≠p (C·ªông & Tr·ª´)</div>
            <div class="loi-item" onclick="toggle('m21')"><input type="checkbox" id="m21" data-d="-10" data-n="ƒêi·ªÉm y·∫øu"> <span>ƒêi·ªÉm 0, 1, 2, 3</span> <b class="score-tag minus">-10</b></div>
            <div class="loi-item" onclick="toggle('m24')"><input type="checkbox" id="m24" data-d="10" data-n="ƒêi·ªÉm 10"> <span>ƒê·∫°t ƒëi·ªÉm 10</span> <b class="score-tag plus">+10</b></div>
            <div class="loi-item" onclick="toggle('m25')"><input type="checkbox" id="m25" data-d="10" data-n="Ti·∫øt A" data-tp="L"> <span>1 ti·∫øt h·ªçc lo·∫°i A</span> <b class="score-tag plus">+10</b></div>
        </div>

        <button class="btn btn-save" onclick="saveData()">‚úÖ L∆ØU ƒêI·ªÇM ƒê·ª¢T N√ÄY</button>
        <button class="btn btn-ls" onclick="openReport()">üìã XEM B√ÅO C√ÅO (LS)</button>
    </div>
</div>

<div id="report-screen">
    <button class="btn" style="background:#666; color:white; margin-bottom:10px" onclick="closeReport()">‚¨Ö QUAY L·∫†I</button>
    <h3 style="text-align:center">B√ÅO C√ÅO L·ªöP <span id="report-lop-name">--</span></h3>
    <table class="report-table">
        <thead>
            <tr>
                <th>Vi·ªác l√†m t·ªët/ kh√¥ng t·ªët</th>
                <th>Bi·ªÉu ƒëi·ªÉm</th>
                <th>C√° nh√¢n/ t·∫≠p th·ªÉ</th>
                <th>S·ªë l·∫ßn</th>
                <th>ƒêi·ªÉm</th>
            </tr>
        </thead>
        <tbody id="report-body"></tbody>
    </table>
</div>

<script>
    const dsLops = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
    let db = JSON.parse(localStorage.getItem('saodo_pa_2026')) || {};
    let currentLop = "";

    function checkPin(val) {
        if(val === "1234") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-ui').style.display = 'block';
            renderGrid();
        }
    }

    function renderGrid() {
        let html = "";
        dsLops.forEach(l => {
            let score = db[l] ? db[l].total : 100;
            html += `<div class="lop-card ${currentLop === l ? 'active' : ''}" onclick="selectLop('${l}')">
                        <b>L·ªõp ${l}</b>
                        <span>${score}ƒë</span>
                    </div>`;
        });
        document.getElementById('grid-lops').innerHTML = html;
    }

    function selectLop(l) {
        currentLop = l;
        renderGrid();
        document.getElementById('form-cham').style.display = 'block';
        document.getElementById('label-lop').innerText = "ƒêang ch·∫•m: L·ªõp " + l;
    }

    function toggle(id) {
        let ck = document.getElementById(id);
        ck.checked = !ck.checked;
    }

    function saveData() {
        if(!currentLop) return;
        const nameStr = document.getElementById('input-names').value.trim();
        const checks = Array.from(document.querySelectorAll("#ds-loi input[type='checkbox']:checked"));

        if(checks.length === 0) return alert("B·∫°n ch∆∞a ch·ªçn l·ªói!");
        if(!db[currentLop]) db[currentLop] = { total: 100, logs: [] };

        // Logic nh√¢n h·ªá s·ªë x2, x3...
        let items = nameStr.split(',').filter(x => x.trim().length > 0);
        let count = 0;
        if(items.length === 0) {
            count = 1;
        } else {
            items.forEach(it => {
                let m = it.toLowerCase().match(/(.+)x\s*(\d+)/);
                count += m ? parseInt(m[2]) : 1;
            });
        }

        checks.forEach(c => {
            let bieu = Number(c.dataset.d);
            let soLan = c.dataset.tp === "L" ? 1 : count; // N·∫øu l·ªói l·ªõp th√¨ t√≠nh 1 l·∫ßn
            let tong = bieu * soLan;

            db[currentLop].total += tong;
            db[currentLop].logs.push({
                n: c.dataset.n,
                b: bieu,
                hs: nameStr || "C·∫£ l·ªõp",
                l: soLan,
                t: tong
            });
        });

        localStorage.setItem('saodo_pa_2026', JSON.stringify(db));
        document.getElementById('input-names').value = "";
        checks.forEach(c => c.checked = false);
        renderGrid();
        alert("ƒê√£ ghi nh·∫≠n th√†nh c√¥ng!");
    }

    function openReport() {
        if(!currentLop || !db[currentLop] || db[currentLop].logs.length === 0) return alert("Ch∆∞a c√≥ l·ªãch s·ª≠!");
        let html = "";
        let tong = 0;
        db[currentLop].logs.forEach(log => {
            tong += log.t;
            html += `<tr>
                <td>${log.n}</td>
                <td style="text-align:center">${log.b > 0 ? '+' : ''}${log.b}</td>
                <td>${log.hs}</td>
                <td style="text-align:center">${log.l}</td>
                <td style="font-weight:bold; text-align:center">${log.t > 0 ? '+' : ''}${log.t}</td>
            </tr>`;
        });
        html += `<tr class="total-row"><td colspan="4" style="text-align:right">T·ªïng ƒëi·ªÉm ƒë·ª£t n√†y:</td><td style="text-align:center">${tong > 0 ? '+' : ''}${tong}</td></tr>`;
        document.getElementById('report-lop-name').innerText = currentLop;
        document.getElementById('report-body').innerHTML = html;
        document.getElementById('report-screen').style.display = 'block';
    }

    function closeReport() { document.getElementById('report-screen').style.display = 'none'; }
</script>
</body>
</html>
