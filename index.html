<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Sá»” TÃNH ÄIá»‚M</title>

<style>
body{
    font-family: Arial;
    background:#0f172a;
    color:white;
    padding:20px;
}

table{
    width:100%;
    border-collapse: collapse;
    margin-top:15px;
}

th,td{
    border:1px solid #334155;
    padding:8px;
    text-align:center;
}

th{
    background:#1e293b;
}

input{
    padding:5px;
    border-radius:5px;
    border:none;
}

button{
    padding:8px 15px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    margin-top:10px;
}

.box{
    background:#1e293b;
    padding:15px;
    border-radius:10px;
    margin-top:20px;
    max-height:250px;
    overflow-y:auto;
}
</style>
</head>
<body>

<h2>ğŸ“˜ Sá»” TÃNH ÄIá»‚M</h2>

Chá»n lá»›p:
<select id="lop">
    <option>6A</option>
    <option>6B</option>
    <option>7A</option>
    <option>7B</option>
</select>

<table id="bangDiem">
<thead>
<tr>
    <th>Ná»™i dung</th>
    <th>Biá»ƒu Ä‘iá»ƒm</th>
    <th>TÃªn há»c sinh</th>
    <th>Sá»‘ láº§n</th>
    <th>Äiá»ƒm</th>
</tr>
</thead>

<tbody>

<tr>
<td>KhÃ´ng Ä‘eo khÄƒn quÃ ng</td>
<td data-diem="-5">-5</td>
<td><input type="text" class="tenHS"></td>
<td><input type="number" min="0" value="0" class="soLan"></td>
<td class="diem">0</td>
</tr>

<tr>
<td>Äi trá»…</td>
<td data-diem="-2">-2</td>
<td><input type="text" class="tenHS"></td>
<td><input type="number" min="0" value="0" class="soLan"></td>
<td class="diem">0</td>
</tr>

<tr>
<td>ÄÃ¡nh nhau</td>
<td data-diem="-50">-50</td>
<td><input type="text" class="tenHS"></td>
<td><input type="number" min="0" value="0" class="soLan"></td>
<td class="diem">0</td>
</tr>

</tbody>
</table>

<h3>Tá»•ng Ä‘iá»ƒm lá»›p: <span id="tongDiem">0</span></h3>

<button onclick="luuTuan()">ğŸ’¾ LÆ°u tuáº§n</button>

<!-- Lá»ŠCH Sá»¬ CHáº¤M ÄIá»‚M -->
<div class="box">
<h3>ğŸ“œ Lá»‹ch sá»­ cháº¥m Ä‘iá»ƒm</h3>
<div id="lichSuChamDiem"></div>
</div>

<!-- Báº¢NG Xáº¾P Háº NG -->
<div class="box">
<h3>ğŸ† Báº£ng xáº¿p háº¡ng lá»›p</h3>
<div id="bangXepHang"></div>
</div>

<!-- Lá»ŠCH Sá»¬ TUáº¦N -->
<div class="box">
<h3>ğŸ“… Lá»‹ch sá»­ cÃ¡c tuáº§n</h3>
<div id="lichSuTuan"></div>
</div>

<script>

let tuan = 1;

// TÃ­nh Ä‘iá»ƒm tá»± Ä‘á»™ng
document.querySelectorAll(".soLan").forEach(input=>{
    input.addEventListener("input", tinhDiem);
});

function tinhDiem(){

    let tong = 0;

    document.querySelectorAll("#bangDiem tbody tr").forEach(row=>{
        const diemGoc = parseInt(row.children[1].dataset.diem);
        const tenHS = row.querySelector(".tenHS").value;
        const soLan = parseInt(row.querySelector(".soLan").value) || 0;

        const diem = diemGoc * soLan;

        row.querySelector(".diem").innerText = diem;
        tong += diem;

        if(soLan > 0){
            luuLichSu(row.children[0].innerText, diem, tenHS);
        }
    });

    document.getElementById("tongDiem").innerText = tong;
}

// LÆ°u lá»‹ch sá»­ cháº¥m Ä‘iá»ƒm
function luuLichSu(noiDung, diem, tenHS){

    const lichSu = document.getElementById("lichSuChamDiem");
    const tg = new Date().toLocaleString();

    const div = document.createElement("div");
    div.innerHTML = `
        <b>${tg}</b> - ${tenHS || "KhÃ´ng ghi tÃªn"} 
        bá»‹ trá»« ${Math.abs(diem)} Ä‘iá»ƒm (${noiDung})
        <hr>
    `;

    lichSu.prepend(div);
}

// LÆ°u tuáº§n
function luuTuan(){

    const lop = document.getElementById("lop").value;
    const tong = document.getElementById("tongDiem").innerText;

    // LÆ°u lá»‹ch sá»­ tuáº§n
    const lichSuTuan = document.getElementById("lichSuTuan");
    const div = document.createElement("div");

    div.innerHTML = `
        <b>Tuáº§n ${tuan}</b> - Lá»›p ${lop} - Tá»•ng Ä‘iá»ƒm: ${tong}
        <hr>
    `;

    lichSuTuan.prepend(div);

    // Cáº­p nháº­t báº£ng xáº¿p háº¡ng
    capNhatXepHang(lop, tong);

    tuan++;
}

// Báº£ng xáº¿p háº¡ng
let xepHang = {};

function capNhatXepHang(lop, diem){

    if(!xepHang[lop]){
        xepHang[lop] = 0;
    }

    xepHang[lop] += parseInt(diem);

    let html = "";

    Object.entries(xepHang)
        .sort((a,b)=> b[1] - a[1])
        .forEach((item,index)=>{
            html += `${index+1}. Lá»›p ${item[0]} - ${item[1]} Ä‘iá»ƒm<br>`;
        });

    document.getElementById("bangXepHang").innerHTML = html;
}

</script>

</body>
</html>
