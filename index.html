<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sao ƒê·ªè TH&THCS Ph∆∞·ªõc An</title>
    <style>
        :root { --p: #0056b3; --s: #2e7d32; --a: #d32f2f; --bg: #f4f7f6; --gold: #ffd700; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 10px; padding-bottom: 100px; color: #333; }
        
        /* LOGIN */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; color: white; }
        .pin-input { width: 150px; padding: 15px; border-radius: 12px; border: none; font-size: 2rem; text-align: center; letter-spacing: 5px; font-weight: bold; margin: 20px 0; color: var(--p); }

        #main-content { display: none; max-width: 1200px; margin: 0 auto; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* HEADER */
        .header { background: white; padding: 15px; border-radius: 15px; text-align: center; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .header h4 { margin: 0; color: #555; font-size: 0.8rem; text-transform: uppercase; }
        .school-title { font-size: 1.1rem; font-weight: bold; color: var(--p); margin: 5px 0; }

        .container { display: flex; flex-wrap: wrap; gap: 15px; }

        /* B·∫¢NG X·∫æP H·∫†NG */
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); flex: 1; min-width: 300px; }
        table { width: 100%; border-collapse: collapse; }
        th { font-size: 0.7rem; color: #888; text-transform: uppercase; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        td { padding: 10px 5px; text-align: center; border-bottom: 1px solid #f9f9f9; font-weight: bold; font-size: 0.9rem; }
        
        .rank { width: 28px; height: 28px; line-height: 28px; display: inline-block; border-radius: 50%; background: #eee; font-size: 0.75rem; }
        .rank-1 { background: var(--gold); }
        .rank-2 { background: #e0e0e0; }
        .rank-3 { background: #f0d0b0; }

        .lop-row { cursor: pointer; transition: 0.2s; }
        .dang-chon { background: #e3f2fd !important; outline: 2px solid var(--p); }

        /* FORM CH·∫§M ƒêI·ªÇM */
        .ai-box { background: #eef7ff; padding: 10px; border-radius: 10px; margin-bottom: 10px; font-size: 0.8rem; border-left: 4px solid var(--p); }
        .scroll-form { max-height: 550px; overflow-y: auto; padding-right: 5px; }
        .group-title { background: #f8f9fa; color: var(--p); padding: 8px; font-weight: bold; margin-top: 15px; font-size: 0.75rem; border-radius: 5px; border: 1px solid #eee; }
        .loi-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f1f1f1; }
        .loi-item span { flex: 1; font-size: 0.8rem; color: #444; padding-right: 5px; }
        .score-tag { width: 45px; font-weight: bold; font-size: 0.75rem; text-align: center; }
        .minus { color: var(--a); }
        .plus { color: var(--s); }
        input[type=number] { width: 45px; padding: 6px; border-radius: 5px; border: 1px solid #ddd; text-align: center; font-weight: bold; }

        /* L·ªäCH S·ª¨ */
        .history-list { max-height: 150px; overflow-y: auto; background: #fafafa; border-radius: 10px; padding: 10px; margin-top: 10px; font-size: 0.75rem; }
        .history-item { padding: 4px 0; border-bottom: 1px dotted #ddd; }

        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 8px; }
        .btn-apply { background: var(--p); color: white; }
        .btn-zalo { background: #0068ff; color: white; }
        .btn-reset { background: #fff; color: var(--a); border: 1px solid var(--a); margin-top: 20px; font-size: 0.7rem; }

        .footer { text-align: center; padding: 20px; font-size: 0.8rem; color: #888; }
        .footer b { color: var(--p); }
    </style>
</head>
<body>

<div id="login-screen">
    <h2>H·ªá Th·ªëng Sao ƒê·ªè</h2>
    <input type="password" id="pin-input" class="pin-input" placeholder="****" maxlength="4" oninput="checkPin()">
    <p>Nh·∫≠p m√£ PIN ƒë·ªÉ truy c·∫≠p</p>
</div>

<div id="main-content">
    <div class="header">
        <h4>Li√™n ƒë·ªôi TH & THCS Ph∆∞·ªõc An</h4>
        <div class="school-title">BI·ªÇU ƒêI·ªÇM THI ƒêUA NƒÇM H·ªåC 2025 - 2026</div>
        <p style="margin:0; font-size:0.7rem; color:#888;">Qu·∫£n l√Ω b·ªüi Ban ch·ªâ huy Li√™n ƒë·ªôi</p>
    </div>

    <div class="container">
        <div class="card" style="flex: 1;">
            <h3 style="margin-top:0; font-size: 1rem;">üèÜ X·∫øp H·∫°ng</h3>
            <table>
                <thead><tr><th>XH</th><th>L·ªõp</th><th>ƒêi·ªÉm</th></tr></thead>
                <tbody id="body-bang">
                    <script>
                        const lops = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
                        lops.forEach(l => {
                            document.write(`<tr class="lop-row" data-lop="${l}" onclick="chonLop(this)"><td class="rank-cell"></td><td>${l}</td><td class="tong">100</td></tr>`);
                        });
                    </script>
                </tbody>
            </table>
            <button class="btn btn-zalo" onclick="xuatZalo()">üîµ Xu·∫•t b√°o c√°o Zalo</button>
            <button class="btn btn-reset" onclick="resetDuLieu()">üîÑ Reset tu·∫ßn m·ªõi</button>
        </div>

        <div id="panel" class="card" style="display:none; flex: 1.6;">
            <div class="ai-box"><b>ü§ñ AI:</b> <span id="ai-text">H√£y ch·ªçn l·ªõp ƒë·ªÉ nh·∫≠n x√©t.</span></div>
            <h3 id="tenlop" style="text-align:center; color: var(--p); margin: 0 0 10px 0;">L·ªõp</h3>
            
            <div class="scroll-form" id="form-nhap">
                <div class="group-title">1. T√ÅC PHONG & ƒê·∫†O ƒê·ª®C (1HS/L·∫¶N)</div>
                <div class="loi-item"><span>KhƒÉn qu√†ng/Huy hi·ªáu</span><b class="score-tag minus">-5</b><input type="number" id="m1" data-n="KhƒÉn qu√†ng" data-d="-5"></div>
                <div class="loi-item"><span>Kh√¥ng t√°c phong (b·ªè √°o ngo√†i)</span><b class="score-tag minus">-5</b><input type="number" id="m2" data-n="T√°c phong" data-d="-5"></div>
                <div class="loi-item"><span>M·∫∑c √°o kho√°c sai q.ƒë·ªãnh</span><b class="score-tag minus">-5</b><input type="number" id="m3" data-n="√Åo kho√°c" data-d="-5"></div>
                <div class="loi-item"><span>ƒê·ªìng ph·ª•c kh√¥ng ƒë√∫ng</span><b class="score-tag minus">-5</b><input type="number" id="m4" data-n="ƒê·ªìng ph·ª•c" data-d="-5"></div>
                <div class="loi-item"><span>ƒêi ch√¢n tr·∫ßn (s√¢n/WC)</span><b class="score-tag minus">-5</b><input type="number" id="m5" data-n="Ch√¢n tr·∫ßn" data-d="-5"></div>
                <div class="loi-item"><span>ƒê·ªÉ xe kh√¥ng ngay h√†ng</span><b class="score-tag minus">-5</b><input type="number" id="m6" data-n="ƒê·ªÉ xe" data-d="-5"></div>
                <div class="loi-item"><span>Kh√¥ng ƒë·ªôi m≈© b·∫£o hi·ªÉm</span><b class="score-tag minus">-5</b><input type="number" id="m7" data-n="M≈© b·∫£o hi·ªÉm" data-d="-5"></div>
                <div class="loi-item"><span>Ra c·ªïng kh√¥ng xin ph√©p</span><b class="score-tag minus">-5</b><input type="number" id="m8" data-n="Ra c·ªïng" data-d="-5"></div>
                <div class="loi-item"><span>S·ª≠ d·ª•ng ƒêT sai n∆°i q.ƒë·ªãnh</span><b class="score-tag minus">-5</b><input type="number" id="m9" data-n="ƒêi·ªán tho·∫°i" data-d="-5"></div>
                <div class="loi-item"><span>T√≥c d√†i (Nam)</span><b class="score-tag minus">-5</b><input type="number" id="m10" data-n="T√≥c d√†i" data-d="-5"></div>
                <div class="loi-item"><span>Nhu·ªôm t√≥c/Son ph·∫•n/M√≥ng tay</span><b class="score-tag minus">-10</b><input type="number" id="m11" data-n="Nhu·ªôm t√≥c" data-d="-10"></div>
                <div class="loi-item"><span>N√≥i t·ª•c, ch·ª≠i th·ªÅ</span><b class="score-tag minus">-10</b><input type="number" id="m12" data-n="N√≥i t·ª•c" data-d="-10"></div>
                <div class="loi-item"><span>ƒê√°nh nhau</span><b class="score-tag minus">-10</b><input type="number" id="m13" data-n="ƒê√°nh nhau" data-d="-10"></div>
                <div class="loi-item"><span>Ch·ªëng ƒë·ªëi sao ƒë·ªè</span><b class="score-tag minus">-10</b><input type="number" id="m14" data-n="Ch·ªëng ƒë·ªëi" data-d="-10"></div>

                <div class="group-title">2. CHUY√äN C·∫¶N & TR·∫¨T T·ª∞</div>
                <div class="loi-item"><span>ƒêi tr·ªÖ</span><b class="score-tag minus">-2</b><input type="number" id="m15" data-n="ƒêi tr·ªÖ" data-d="-2"></div>
                <div class="loi-item"><span>V·∫Øng kh√¥ng ph√©p</span><b class="score-tag minus">-5</b><input type="number" id="m16" data-n="V·∫Øng" data-d="-5"></div>
                <div class="loi-item"><span>Tr·ªën ti·∫øt</span><b class="score-tag minus">-10</b><input type="number" id="m17" data-n="Tr·ªën ti·∫øt" data-d="-10"></div>
                <div class="loi-item"><span>N√≥i chuy·ªán ri√™ng</span><b class="score-tag minus">-5</b><input type="number" id="m18" data-n="N√≥i chuy·ªán" data-d="-5"></div>
                <div class="loi-item"><span>Kh√¥ng SH 15' (C√° nh√¢n)</span><b class="score-tag minus">-5</b><input type="number" id="m19" data-n="B·ªè SH 15'" data-d="-5"></div>
                <div class="loi-item"><span>Kh√¥ng SH 15' (C·∫£ L·ªõp)</span><b class="score-tag minus">-50</b><input type="number" id="m20" data-n="L·ªõp b·ªè SH" data-d="-50"></div>
                <div class="loi-item"><span>Kh√¥ng TD gi·ªØa gi·ªù (C√° nh√¢n)</span><b class="score-tag minus">-5</b><input type="number" id="m21" data-n="B·ªè TD" data-d="-5"></div>
                <div class="loi-item"><span>Kh√¥ng TD gi·ªØa gi·ªù (C·∫£ L·ªõp)</span><b class="score-tag minus">-50</b><input type="number" id="m22" data-n="L·ªõp b·ªè TD" data-d="-50"></div>
                <div class="loi-item"><span>TD gi·ªØa gi·ªù ko nghi√™m t√∫c</span><b class="score-tag minus">-5</b><input type="number" id="m23" data-n="TD ko nghi√™m t√∫c" data-d="-5"></div>
                <div class="loi-item"><span>Ch√†o c·ªù ko ƒë√∫ng gi·ªù (L·ªõp)</span><b class="score-tag minus">-20</b><input type="number" id="m24" data-n="Ch√†o c·ªù tr·ªÖ" data-d="-20"></div>
                <div class="loi-item"><span>M·∫•t tr·∫≠t t·ª± ch√†o c·ªù</span><b class="score-tag minus">-5</b><input type="number" id="m25" data-n="·ªín ch√†o c·ªù" data-d="-5"></div>
                <div class="loi-item"><span>L·ªõp ko h√°t Qu·ªëc/ƒê·ªôi ca</span><b class="score-tag minus">-20</b><input type="number" id="m26" data-n="Ko h√°t ca" data-d="-20"></div>
                <div class="loi-item"><span>Ko ƒë√°p kh·∫©u hi·ªáu ƒê·ªôi</span><b class="score-tag minus">-20</b><input type="number" id="m27" data-n="Ko ƒë√°p k.hi·ªáu" data-d="-20"></div>

                <div class="group-title">3. V·ªÜ SINH & T√ÄI S·∫¢N</div>
                <div class="loi-item"><span>ƒÇn u·ªëng sai n∆°i q.ƒë·ªãnh</span><b class="score-tag minus">-10</b><input type="number" id="m28" data-n="ƒÇn qu√†" data-d="-10"></div>
                <div class="loi-item"><span>X·∫£ r√°c (C√° nh√¢n)</span><b class="score-tag minus">-20</b><input type="number" id="m29" data-n="X·∫£ r√°c" data-d="-20"></div>
                <div class="loi-item"><span>X·∫£ r√°c (C·∫£ l·ªõp)</span><b class="score-tag minus">-100</b><input type="number" id="m30" data-n="L·ªõp x·∫£ r√°c" data-d="-100"></div>
                <div class="loi-item"><span>V·∫Ω t∆∞·ªùng, b√†n gh·∫ø</span><b class="score-tag minus">-10</b><input type="number" id="m31" data-n="V·∫Ω b·∫≠y" data-d="-10"></div>
                <div class="loi-item"><span>L√†m h∆∞ h·ªèng t√†i s·∫£n tr∆∞·ªùng</span><b class="score-tag minus">-30</b><input type="number" id="m32" data-n="H∆∞ t√†i s·∫£n" data-d="-30"></div>
                <div class="loi-item"><span>Chui r√†o, ph√° h√†ng r√†o</span><b class="score-tag minus">-30</b><input type="number" id="m33" data-n="Chui r√†o" data-d="-30"></div>

                <div class="group-title">4. H·ªåC T·∫¨P & PHONG TR√ÄO</div>
                <div class="loi-item"><span>Kh√¥ng thu·ªôc b√†i/L√†m BT</span><b class="score-tag minus">-10</b><input type="number" id="m34" data-n="L∆∞·ªùi h·ªçc" data-d="-10"></div>
                <div class="loi-item"><span>Kh√¥ng chu·∫©n b·ªã b√†i/D·ª•ng c·ª•</span><b class="score-tag minus">-10</b><input type="number" id="m35" data-n="Thi·∫øu d·ª•ng c·ª•" data-d="-10"></div>
                <div class="loi-item"><span>L√†m m·∫•t/X√© b√†i ki·ªÉm tra</span><b class="score-tag minus">-20</b><input type="number" id="m36" data-n="X√© b√†i KT" data-d="-20"></div>
                <div class="loi-item"><span>ƒêi·ªÉm: 0, 1, 2, 3</span><b class="score-tag minus">-10</b><input type="number" id="m37" data-n="ƒêi·ªÉm k√©m" data-d="-10"></div>
                <div class="loi-item"><span>ƒêi·ªÉm: 4</span><b class="score-tag minus">-5</b><input type="number" id="m38" data-n="ƒêi·ªÉm y·∫øu" data-d="-5"></div>
                <div class="loi-item"><span>ƒêi·ªÉm: 7</span><b class="score-tag plus">+5</b><input type="number" id="m39" data-n="ƒêi·ªÉm kh√°" data-d="5"></div>
                <div class="loi-item"><span>ƒêi·ªÉm: 8, 9</span><b class="score-tag plus">+9</b><input type="number" id="m40" data-n="ƒêi·ªÉm gi·ªèi" data-d="9"></div>
                <div class="loi-item"><span>ƒêi·ªÉm: 10</span><b class="score-tag plus">+10</b><input type="number" id="m41" data-n="ƒêi·ªÉm 10" data-d="10"></div>
                <div class="loi-item"><span>Ti·∫øt h·ªçc lo·∫°i A</span><b class="score-tag plus">+10</b><input type="number" id="m42" data-n="Ti·∫øt A" data-d="10"></div>
                <div class="loi-item"><span>Ti·∫øt h·ªçc lo·∫°i B</span><b class="score-tag plus">+5</b><input type="number" id="m43" data-n="Ti·∫øt B" data-d="5"></div>
                <div class="loi-item"><span>Ti·∫øt h·ªçc lo·∫°i C</span><b class="score-tag minus">-5</b><input type="number" id="m44" data-n="Ti·∫øt C" data-d="-5"></div>
                <div class="loi-item"><span>Ti·∫øt h·ªçc lo·∫°i D</span><b class="score-tag minus">-10</b><input type="number" id="m45" data-n="Ti·∫øt D" data-d="-10"></div>
                <div class="loi-item"><span>L√†m m·∫•t s·ªï ƒë·∫ßu b√†i</span><b class="score-tag minus">-50</b><input type="number" id="m46" data-n="M·∫•t SƒêB" data-d="-50"></div>
                <div class="loi-item"><span>Nh·∫∑t ƒë∆∞·ª£c c·ªßa r∆°i</span><b class="score-tag plus">+5</b><input type="number" id="m47" data-n="C·ªßa r∆°i" data-d="5"></div>
                <div class="loi-item"><span>P.tr√†o: Nh·∫•t/Nh√¨/Ba</span><b class="score-tag plus">C·ªông</b><input type="number" id="m48" placeholder="50,40.."></div>
                <div class="loi-item"><span>Ko ho√†n th√†nh p.tr√†o/ch·ªâ ti√™u</span><b class="score-tag minus">-30</b><input type="number" id="m49" data-n="Ko h.th√†nh PT" data-d="-30"></div>
                <div class="loi-item"><span>Ko ho√†n th√†nh ch√†o c·ªù ƒë·∫ßu tu·∫ßn</span><b class="score-tag minus">-50</b><input type="number" id="m50" data-n="Ko ch√†o c·ªù" data-d="-50"></div>

                <div class="group-title">5. ƒê·ªêI V·ªöI SAO ƒê·ªé</div>
                <div class="loi-item"><span>Ko ƒëeo bƒÉng sao ƒë·ªè</span><b class="score-tag minus">-10</b><input type="number" id="m51" data-n="Ko bƒÉng Sƒê" data-d="-10"></div>
                <div class="loi-item"><span>Sƒê tr·ª±c tr·ªÖ</span><b class="score-tag minus">-10</b><input type="number" id="m52" data-n="Sƒê tr·ªÖ" data-d="-10"></div>
                <div class="loi-item"><span>Sƒê ko tr·ª±c</span><b class="score-tag minus">-20</b><input type="number" id="m53" data-n="Sƒê b·ªè tr·ª±c" data-d="-20"></div>
                <div class="loi-item"><span>Sƒê ko t·ªïng k·∫øt cu·ªëi tu·∫ßn</span><b class="score-tag minus">-50</b><input type="number" id="m54" data-n="Sƒê ko t.k·∫øt" data-d="-50"></div>
            </div>
            <button class="btn btn-apply" onclick="apDung()">L∆ØU K·∫æT QU·∫¢ CH·∫§M</button>
            <div class="history-list" id="history-box">Ch∆∞a c√≥ l·ªãch s·ª≠ ch·∫•m cho l·ªõp n√†y.</div>
        </div>
    </div>

    <div class="footer">
        By <b>truongkycaonguyen</b><br>
        H·ªá th·ªëng Sao ƒê·ªè Ph∆∞·ªõc An 2026
    </div>
</div>

<script>
const PIN = "1234";
let dataLoi = {};
let nhatKy = [];

function checkPin() {
    if (document.getElementById("pin-input").value === PIN) {
        document.getElementById("login-screen").style.display = "none";
        document.getElementById("main-content").style.display = "block";
        loadData(); xepHang();
    }
}

function chonLop(row) {
    document.querySelectorAll(".lop-row").forEach(r => r.classList.remove("dang-chon"));
    row.classList.add("dang-chon");
    document.getElementById("panel").style.display = "block";
    const tenLop = row.dataset.lop;
    document.getElementById("tenlop").innerText = "L·ªõp " + tenLop;
    
    const saved = dataLoi[tenLop] || {};
    document.querySelectorAll("#form-nhap input").forEach(i => i.value = saved[i.id] || 0);
    renderLog(tenLop);
    capNhatAI(tenLop);
    if(window.innerWidth < 800) document.getElementById("panel").scrollIntoView({behavior: "smooth"});
}

function apDung() {
    const row = document.querySelector(".lop-row.dang-chon");
    if(!row) return;
    const tenLop = row.dataset.lop;
    let tongBienDong = 0;
    let details = [];

    document.querySelectorAll("#form-nhap input").forEach(i => {
        let val = Number(i.value) || 0;
        let diemGoc = Number(i.dataset.d) || 0;
        
        // Ri√™ng cho m·ª•c phong tr√†o nh·∫≠p ƒëi·ªÉm t·ª± do
        if(i.id === "m48") {
            tongBienDong += val;
        } else {
            tongBienDong += (val * diemGoc);
        }

        dataLoi[tenLop] = dataLoi[tenLop] || {};
        dataLoi[tenLop][i.id] = val;
        
        if(val > 0) details.push(`${i.dataset.n || "Phong tr√†o"}(${val})`);
    });

    let finalScore = 100 + tongBienDong;
    row.querySelector(".tong").innerText = finalScore;
    row.dataset.tong = finalScore;

    const gio = new Date().toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'});
    nhatKy.unshift({lop: tenLop, time: gio, text: details.join(", ") || "C·∫≠p nh·∫≠t"});
    if(nhatKy.length > 50) nhatKy.pop();

    saveData(); xepHang(); renderLog(tenLop); capNhatAI(tenLop);
    alert("ƒê√£ l∆∞u ƒëi·ªÉm th√†nh c√¥ng!");
}

function xepHang() {
    let rows = Array.from(document.querySelectorAll(".lop-row"));
    rows.sort((a,b) => (Number(b.dataset.tong) || 100) - (Number(a.dataset.tong) || 100));
    let container = document.getElementById("body-bang");
    rows.forEach((r, i) => {
        let h = i + 1;
        let cls = h === 1 ? 'rank-1' : h === 2 ? 'rank-2' : h === 3 ? 'rank-3' : '';
        let icon = h === 1 ? 'ü•á' : h === 2 ? 'ü•à' : h === 3 ? 'ü•â' : h;
        r.querySelector(".rank-cell").innerHTML = `<span class="rank ${cls}">${icon}</span>`;
        container.appendChild(r);
    });
}

function renderLog(tenLop) {
    const list = nhatKy.filter(n => n.lop === tenLop);
    document.getElementById("history-box").innerHTML = list.length ? 
        list.map(n => `<div class="history-item">üïí ${n.time}: ${n.text}</div>`).join("") : "Ch∆∞a c√≥ l·ªãch s·ª≠ ch·∫•m.";
}

function capNhatAI(tenLop) {
    const row = document.querySelector(`.lop-row[data-lop="${tenLop}"]`);
    const diem = Number(row.dataset.tong) || 100;
    let ai = diem >= 100 ? "L·ªõp xu·∫•t s·∫Øc, duy tr√¨ phong ƒë·ªô nh√©!" : 
             diem >= 80 ? "Kh√° t·ªët, c·∫ßn nh·∫Øc nh·ªü c√°c b·∫°n gi·∫£m l·ªói nh·ªè." : "Vi ph·∫°m qu√° nhi·ªÅu, c·∫ßn GVCN ch·∫•n ch·ªânh k·ª∑ lu·∫≠t!";
    document.getElementById("ai-text").innerText = `L·ªõp ${tenLop}: ${ai}`;
}

function xuatZalo() {
    let msg = "üìä B√ÅO C√ÅO THI ƒêUA PH∆Ø·ªöC AN\n";
    document.querySelectorAll(".lop-row").forEach((r, i) => {
        msg += `${i+1}. L·ªõp ${r.dataset.lop}: ${r.querySelector(".tong").innerText}ƒë\n`;
    });
    navigator.clipboard.writeText(msg + "\n---\nBy truongkycaonguyen").then(() => alert("ƒê√£ copy b√°o c√°o!"));
}

function resetDuLieu() {
    if(confirm("X√≥a to√†n b·ªô d·ªØ li·ªáu tu·∫ßn n√†y?")) {
        localStorage.clear(); location.reload();
    }
}

function saveData() {
    localStorage.setItem('pa_final_v5', JSON.stringify({
        scores: Array.from(document.querySelectorAll(".lop-row")).map(r => ({l: r.dataset.lop, d: r.dataset.tong})),
        details: dataLoi,
        history: nhatKy
    }));
}

function loadData() {
    const raw = JSON.parse(localStorage.getItem('pa_final_v5'));
    if (raw) {
        if (raw.scores) raw.scores.forEach(item => {
            let r = document.querySelector(`.lop-row[data-lop="${item.l}"]`);
            if(r) { r.querySelector(".tong").innerText = item.d; r.dataset.tong = item.d; }
        });
        dataLoi = raw.details || {};
        nhatKy = raw.history || [];
    }
}
</script>
</body>
</html>
