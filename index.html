<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SAO ƒê·ªé PH∆Ø·ªöC AN 2026</title>
    <style>
        :root { --p: #4361ee; --s: #2ec4b6; --a: #e71d36; --bg: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 15px; }
        
        /* M√†n h√¨nh kh√≥a PIN */
        #lock-screen { position: fixed; inset: 0; background: var(--p); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; color: white; }
        .pin-box { background: white; padding: 20px; border-radius: 20px; display: flex; gap: 10px; }
        .pin-box input { width: 50px; height: 60px; text-align: center; font-size: 2rem; border-radius: 10px; border: 2px solid #ddd; color: var(--p); font-weight: bold; }

        .header { text-align: center; padding: 15px; background: linear-gradient(135deg, var(--p), #7209b7); color: white; border-radius: 15px; margin-bottom: 15px; }
        
        /* Grid l·ªõp nh∆∞ h√¨nh b·∫°n g·ª≠i */
        .grid-lops { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; margin-bottom: 15px; }
        .lop-card { background: white; padding: 10px 5px; border-radius: 12px; text-align: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 2px solid transparent; transition: 0.2s; }
        .lop-card.active { border-color: var(--p); background: #edf2ff; transform: scale(1.05); }
        .lop-card b { display: block; font-size: 1rem; color: #333; }
        .lop-card span { font-size: 0.8rem; color: var(--p); font-weight: bold; }

        /* V√πng ch·∫•m ƒëi·ªÉm */
        .main-card { background: white; padding: 15px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: none; }
        .sticky-input { position: sticky; top: 0; background: white; z-index: 100; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        input[type="text"] { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #ddd; font-size: 0.9rem; box-sizing: border-box; margin-top: 8px; }

        /* Danh s√°ch l·ªói */
        .scroll-loi { max-height: 350px; overflow-y: auto; margin: 10px 0; }
        .group-tag { font-size: 0.7rem; font-weight: bold; color: #999; text-transform: uppercase; margin: 15px 0 5px 0; }
        .loi-item { display: flex; align-items: center; padding: 10px; background: #f9f9f9; border-radius: 10px; margin-bottom: 5px; cursor: pointer; }
        .loi-item input { width: 20px; height: 20px; margin-right: 10px; pointer-events: none; }
        .loi-item span { flex: 1; font-size: 0.85rem; }
        .loi-item b { color: var(--a); font-size: 0.8rem; }
        .btn-save { width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--p); color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* Nh·∫≠t k√Ω & B·∫£ng x·∫øp h·∫°ng */
        .history-section { margin-top: 20px; background: #fffde7; padding: 15px; border-radius: 15px; border: 1px dashed #fbc02d; }
        .log-item { display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; padding: 8px 0; border-bottom: 1px solid #eee; }
        .btn-del { background: none; border: none; color: var(--a); cursor: pointer; font-weight: bold; padding: 5px; }

        .footer { display: flex; gap: 10px; margin-top: 20px; }
        .btn-foot { flex: 1; padding: 12px; border-radius: 10px; border: none; color: white; font-weight: bold; cursor: pointer; font-size: 0.8rem; }
    </style>
</head>
<body>

<div id="lock-screen">
    <h3>üîë NH·∫¨P PIN SAO ƒê·ªé</h3>
    <div class="pin-box">
        <input type="password" maxlength="4" id="pin-input" oninput="checkPin(this.value)">
    </div>
</div>

<div id="app" style="display:none">
    <div class="header">
        <h2 style="margin:0">üåü SAO ƒê·ªé PH∆Ø·ªöC AN</h2>
    </div>

    <div class="grid-lops" id="render-lops"></div>

    <div class="main-card" id="panel-cham">
        <div class="sticky-input">
            <h4 id="lbl-lop" style="margin:0; color:var(--p)">L·ªõp --</h4>
            <input type="text" id="txt-ten" placeholder="Nh·∫≠p t√™n HS (C√°ch nhau b·∫±ng d·∫•u ph·∫©y)...">
        </div>

        <div class="scroll-loi">
            <div class="group-tag">T√°c phong (-5ƒë)</div>
            <div class="loi-item" onclick="toggle('c1')"><input type="checkbox" id="c1" data-d="-5" data-n="KhƒÉn qu√†ng"> <span>Kh√¥ng khƒÉn qu√†ng/Huy hi·ªáu</span> <b>-5</b></div>
            <div class="loi-item" onclick="toggle('c2')"><input type="checkbox" id="c2" data-d="-5" data-n="T√°c phong"> <span>Kh√¥ng b·ªè √°o v√†o qu·∫ßn</span> <b>-5</b></div>
            
            <div class="group-tag">Chuy√™n c·∫ßn & K·ª∑ lu·∫≠t</div>
            <div class="loi-item" onclick="toggle('c3')"><input type="checkbox" id="c3" data-d="-2" data-n="ƒêi tr·ªÖ"> <span>ƒêi h·ªçc tr·ªÖ</span> <b>-2</b></div>
            <div class="loi-item" onclick="toggle('c4')"><input type="checkbox" id="c4" data-d="-10" data-n="N√≥i t·ª•c"> <span>N√≥i t·ª•c, ch·ª≠i th·ªÅ</span> <b>-10</b></div>
            <div class="loi-item" onclick="toggle('c5')"><input type="checkbox" id="c5" data-d="-50" data-n="SH 15p" data-type="L"> <span>L·ªõp kh√¥ng SH 15 ph√∫t</span> <b>-50</b></div>

            <div class="group-tag">Th∆∞·ªüng (+)</div>
            <div class="loi-item" onclick="toggle('c6')"><input type="checkbox" id="c6" data-d="10" data-n="ƒêi·ªÉm 10"> <span>H·ªçc sinh ƒë·∫°t ƒëi·ªÉm 10</span> <b style="color:var(--s)">+10</b></div>
        </div>

        <button class="btn-save" onclick="save()">L∆ØU V√Ä QUA ƒê·ª¢T M·ªöI</button>

        <div class="history-section" id="ls-vung">
            <b>Nh·∫≠t k√Ω l·ªõp:</b>
            <div id="list-logs"></div>
        </div>
    </div>

    <div class="footer">
        <button class="btn-foot" style="background:#0068ff" onclick="exportZalo()">üìã XU·∫§T ZALO</button>
        <button class="btn-foot" style="background:#6c757d" onclick="resetData()">üîÑ RESET TU·∫¶N</button>
    </div>
</div>

<script>
    const PIN = "1234";
    const lops = ['6A','6B','6C','7A','7B','7C','8A','8B','8C','9A','9B'];
    let db = JSON.parse(localStorage.getItem('pa_final_v1')) || {};
    let curLop = "";

    function checkPin(val) {
        if(val === PIN) {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            renderLops();
        }
    }

    function renderLops() {
        let html = "";
        lops.forEach(l => {
            let s = db[l] ? db[l].total : 100;
            html += `<div class="lop-card ${curLop==l?'active':''}" onclick="selectLop('${l}')">
                        <b>${l}</b><span>${s}ƒë</span>
                    </div>`;
        });
        document.getElementById('render-lops').innerHTML = html;
    }

    function selectLop(l) {
        curLop = l;
        renderLops();
        document.getElementById('panel-cham').style.display = 'block';
        document.getElementById('lbl-lop').innerText = "CH·∫§M L·ªöP " + l;
        renderLogs();
    }

    function toggle(id) { document.getElementById(id).checked = !document.getElementById(id).checked; }

    function save() {
        const txt = document.getElementById('txt-ten').value.trim();
        const names = txt.split(/[,.;]+/).filter(x => x.trim().length > 0);
        const cks = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'));

        if(cks.length === 0) return alert("Ch∆∞a ch·ªçn l·ªói!");
        if(cks.some(c => !c.dataset.type) && names.length === 0) return alert("H√£y nh·∫≠p t√™n HS!");

        if(!db[curLop]) db[curLop] = { total: 100, logs: [] };

        cks.forEach(c => {
            let d = parseInt(c.dataset.d);
            let count = c.dataset.type === "L" ? 1 : names.length;
            let sum = d * count;
            
            db[curLop].total += sum;
            db[curLop].logs.unshift({
                id: Date.now() + Math.random(),
                time: new Date().toLocaleTimeString('vi-VN', {hour:'2-digit', minute:'2-digit'}),
                content: `${names.join(', ') || 'C·∫£ l·ªõp'} - ${c.dataset.n}`,
                score: sum
            });
        });

        // T·ª± ƒë·ªông x√≥a s·∫°ch ƒë·ªÉ l√†m ƒë·ª£t m·ªõi
        document.getElementById('txt-ten').value = "";
        cks.forEach(c => c.checked = false);
        
        localStorage.setItem('pa_final_v1', JSON.stringify(db));
        renderLops();
        renderLogs();
    }

    function renderLogs() {
        const box = document.getElementById('list-logs');
        if(!db[curLop] || db[curLop].logs.length === 0) { box.innerHTML = "<small>Tr·ªëng</small>"; return; }
        box.innerHTML = db[curLop].logs.map(i => `
            <div class="log-item">
                <span>${i.time} | ${i.content} (<b>${i.score > 0 ? '+'+i.score : i.score}</b>)</span>
                <button class="btn-del" onclick="delLog(${i.id}, ${i.score})">‚úï</button>
            </div>
        `).join("");
    }

    function delLog(id, score) {
        if(!confirm("B·∫°n mu·ªën x√≥a v√† tr·∫£ l·∫°i ƒëi·ªÉm?")) return;
        db[curLop].total -= score;
        db[curLop].logs = db[curLop].logs.filter(i => i.id !== id);
        localStorage.setItem('pa_final_v1', JSON.stringify(db));
        renderLops(); renderLogs();
    }

    function exportZalo() {
        let msg = "üìä THI ƒêUA PH∆Ø·ªöC AN\n";
        lops.sort((a,b) => (db[b]?.total||100) - (db[a]?.total||100)).forEach((l, i) => {
            msg += `${i+1}. L·ªõp ${l}: ${db[l]?.total || 100}ƒë\n`;
        });
        navigator.clipboard.writeText(msg).then(() => alert("ƒê√£ copy b√°o c√°o!"));
    }

    function resetData() {
        if(confirm("X√≥a to√†n b·ªô d·ªØ li·ªáu tu·∫ßn n√†y?")) {
            localStorage.clear(); location.reload();
        }
    }
</script>
</body>
</html>
